generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                                 String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                              String                      @unique @db.VarChar(255)
  password                           String                      @db.VarChar(255)
  nombre                             String                      @db.VarChar(255)
  apellido                           String                      @db.VarChar(255)
  rol                                String                      @db.VarChar(50)
  telefono                           String?                     @db.VarChar(20)
  cedula                             String?                     @db.VarChar(50)
  activo                             Boolean                     @default(true)
  createdAt                          DateTime                    @default(now()) @map("created_at")
  updatedAt                          DateTime                    @default(now()) @map("updated_at")
  administracionesMedicamentos       AdministracionMedicamento[] @relation("AdministracionEnfermera")
  alertasReconocidas                 AlertaClinica[]             @relation("AlertaReconocedor")
  asignacionesEnfermeria             AsignacionEnfermeria[]      @relation("EnfermeraAsignaciones")
  urgenciasEnfermera                 AtencionUrgencia[]          @relation("UrgenciaEnfermera")
  urgenciasMedico                    AtencionUrgencia[]          @relation("UrgenciaMedico")
  auditLogs                          AuditLog[]
  auditoriaHCE                       AuditoriaHCE[]              @relation("AuditoriaHCEUsuario")
  citasComoDoctor                    Cita[]                      @relation("CitasDoctor")
  departamentosResponsable           Departamento[]              @relation("DepartamentoResponsable")
  diagnosticosHCE                    DiagnosticoHCE[]            @relation("DiagnosticoHCEDoctor")
  doctor                             Doctor?
  evolucionesClinicas                EvolucionClinica[]          @relation("EvolucionDoctor")
  facturasCreadas                    Factura[]
  interconsultasRespondidas          Interconsulta[]             @relation("InterconsultasRespondidas")
  interconsultasSolicitadas          Interconsulta[]             @relation("InterconsultasSolicitadas")
  notasEnfermeria                    NotaEnfermeria[]            @relation("NotasEnfermera")
  ordenesMedicamentosComoDespachador OrdenMedicamento[]          @relation("OrdenMedicamentoDespachador")
  ordenesMedicamentosComoDoctor      OrdenMedicamento[]          @relation("OrdenMedicamentoDoctor")
  ordenesMedicasComoDoctor           OrdenMedica[]               @relation("OrdenMedicaDoctor")
  ordenesMedicasComoEjecutor         OrdenMedica[]               @relation("OrdenMedicaEjecutor")
  pagosRegistrados                   Pago[]
  pqrsRespondidas                    PQRS[]                      @relation("PQRSRespondedor")
  pqrsResponsable                    PQRS[]                      @relation("PQRSResponsable")
  prescripcionesFirmadas             Prescripcion[]              @relation("PrescripcionFirma")
  prescripcionesMedico               Prescripcion[]              @relation("PrescripcionMedico")
  procedimientosAnestesia            Procedimiento[]             @relation("ProcedimientoAnestesiologo")
  procedimientosFirmados             Procedimiento[]             @relation("ProcedimientoFirma")
  procedimientosResponsable          Procedimiento[]             @relation("ProcedimientoResponsable")
  publicaciones                      Publicacion[]
  seguimientosPQRS                   SeguimientoPQRS[]           @relation("SeguimientosPQRS")
  signosVitalesRegistrados           SignoVital[]                @relation("SignoVitalRegistrador")
  ticketsAsignados                   TicketSoporte[]             @relation("TicketAsignado")
  ticketsReportados                  TicketSoporte[]             @relation("TicketReportador")
  assignedRoles                      UserRole[]                  @relation("RoleAssigner")
  userRoles                          UserRole[]
  workflowApprovals                  WorkflowApproval[]          @relation("WorkflowApprover")
  workflowRequests                   WorkflowApproval[]          @relation("WorkflowRequester")
  glucometriasRegistradas            Glucometria[]               @relation("GlucometriaRegistrador")
  balanceLiquidosRegistrados         BalanceLiquidos[]           @relation("BalanceRegistrador")
  transfusionesRegistradas           Transfusion[]               @relation("TransfusionRegistrador")
  transfusionesVerificadas           Transfusion[]               @relation("TransfusionVerificador")
  plantillasNotasCreadas             PlantillaNotaEnfermeria[]   @relation("PlantillaCreador")

  // Calidad Relations
  autoevaluacionesHabilitacion AutoevaluacionHabilitacion[]
  equipoPAMEC                  EquipoPAMEC[]
  medicionesIndicador          MedicionIndicador[]
  reportesEventosAdversos      EventoAdverso[]
  integrantesComite            IntegranteComite[]
  compromisosComite            CompromisoComite[]
  documentosCalidadElaborados  DocumentoCalidad[]
  planesAccionResponsable      PlanAccionCalidad[]
  evaluacionesAcreditacion     EvaluacionAcreditacion[]
  notificacionesSIVIGILA       NotificacionSIVIGILA[]
  reportesFarmacovigilancia    ReporteFarmacovigilancia[]
  reportesTecnovigilancia      ReporteTecnovigilancia[]

  refreshTokens       RefreshToken[]
  lastLogin           DateTime?      @map("last_login")
  failedLoginAttempts Int            @default(0) @map("failed_login_attempts")
  lockedUntil         DateTime?      @map("locked_until")

  // Imagenologia Relations
  estudiosImagenologiaSolicitados EstudioImagenologia[] @relation("MedicoSolicitante")
  estudiosImagenologiaInformados  EstudioImagenologia[] @relation("RadiologoInformante")

  // Calidad 2.0 Relations
  documentosCalidad2        DocumentoCalidad2[] @relation("DocumentoCalidad2Uploader")
  personalVinculado         Personal?           @relation("PersonalUsuario")
  capacitacionesResponsable Capacitacion[]      @relation("CapacitacionResponsable")

  // Incapacidades, Certificados y Seguimientos
  incapacidadesEmitidas IncapacidadMedica[]  @relation("IncapacidadesDoctor")
  certificadosEmitidos  CertificadoMedico[]  @relation("CertificadosDoctor")
  seguimientosCreados   SeguimientoControl[] @relation("SeguimientosDoctor")

  // AI Assistant
  aiConversations AiConversationLog[] @relation("AiConversationUser")

  // HCE Analyzer - Documentos externos subidos por el doctor
  documentosHCESubidos DocumentoHCEExterno[] @relation("DocumentoHCEDoctor")

  // Infraestructura - Calidad 2.0
  documentosLegalesInfraestructura DocumentoLegalInfraestructura[] @relation("DocumentoLegalCreador")
  conceptosSanitariosEvaluados     ConceptoSanitario[]             @relation("ConceptoSanitarioEvaluador")
  documentosConceptoSanitario      DocumentoConceptoSanitario[]    @relation("DocumentoConceptoCreador")
  solicitudesVisitaCreadas         SolicitudVisitaInspeccion[]     @relation("SolicitudVisitaCreador")
  documentosSolicitudVisita        DocumentoSolicitudVisita[]      @relation("DocumentoSolicitudVisitaCreador")
  auditoriasInfraestructuraCreadas AuditoriaInfraestructura[]      @relation("AuditoriaInfraestructuraCreador")
  documentosAuditoriaInfraestructura DocumentoAuditoriaInfraestructura[] @relation("DocumentoAuditoriaInfraestructuraCreador")
  residuosRH1Registrados           ResiduoRH1[]                    @relation("ResiduoRH1Registrador")
  residuosRH1Modificados           ResiduoRH1[]                    @relation("ResiduoRH1Modificador")
  manifestosRecoleccionCreados     ManifiestoRecoleccion[]         @relation("ManifiestoRecoleccionCreador")
  actasDesactivacionCreadas        ActaDesactivacion[]             @relation("ActaDesactivacionCreador")

  // Talento Humano Relations
  thVacantesCreadas              THVacante[]           @relation("THVacanteCreador")
  thCandidatosResponsable        THCandidatoVacante[]  @relation("THCandidatoResponsable")
  thEntrevistasComoEntrevistador THEntrevista[]        @relation("THEntrevistador")
  thEmpleadoVinculado            THEmpleado?           @relation("THEmpleadoUsuario")
  thMovimientosSolicitados       THMovimiento[]        @relation("THMovimientoSolicitante")
  thMovimientosAprobados         THMovimiento[]        @relation("THMovimientoAprobador")
  thDocumentosVerificados        THDocumentoEmpleado[] @relation("THDocumentoVerificador")
  thNominasProcesadas            THPeriodoNomina[]     @relation("THNominaProcesador")
  thNovedadesAprobadas           THNovedadNomina[]     @relation("THNovedadAprobador")
  thAsistenciasRegistradas       THAsistencia[]        @relation("THAsistenciaRegistrador")
  thVacacionesAprobadas          THVacacion[]          @relation("THVacacionAprobador")
  thPermisosAprobados            THPermiso[]           @relation("THPermisoAprobador")
  thReconocimientosOtorgados     THReconocimiento[]    @relation("THReconocimientoOtorgante")
  thConversacionesIA             THConversacionIA[]    @relation("THConversacionUsuario")

  @@map("usuarios")
}

model Paciente {
  id                           String                      @id @default(uuid())
  nombre                       String
  apellido                     String
  tipoDocumento                String?                     @map("tipo_documento")
  cedula                       String                      @unique
  fechaNacimiento              DateTime?                   @map("fecha_nacimiento") @db.Date
  genero                       String?
  paisNacimiento               String?                     @map("pais_nacimiento")
  departamento                 String?
  municipio                    String?
  barrio                       String?
  direccion                    String?
  telefono                     String?
  email                        String?
  contactosEmergencia          Json?                       @map("contactos_emergencia")
  eps                          String?
  regimen                      String?
  tipoAfiliacion               String?                     @map("tipo_afiliacion")
  nivelSisben                  String?                     @map("nivel_sisben")
  numeroAutorizacion           String?                     @map("numero_autorizacion")
  fechaAfiliacion              DateTime?                   @map("fecha_afiliacion") @db.Date
  tipoSangre                   String?                     @map("tipo_sangre")
  peso                         Float?
  altura                       Float?
  alergias                     String?
  enfermedadesCronicas         String?                     @map("enfermedades_cronicas")
  medicamentosActuales         String?                     @map("medicamentos_actuales")
  antecedentesQuirurgicos      String?                     @map("antecedentes_quirurgicos")
  estado                       String                      @default("Activo")
  ultimaConsulta               DateTime?                   @map("ultima_consulta") @db.Date
  activo                       Boolean                     @default(true)
  createdAt                    DateTime                    @default(now()) @map("created_at")
  updatedAt                    DateTime                    @updatedAt @map("updated_at")
  arl                          String?
  carnetPoliza                 String?                     @map("carnet_poliza")
  categoria                    String?
  convenio                     String?
  empleadorActual              String?                     @map("empleador_actual")
  estadoCivil                  String?                     @map("estado_civil")
  nivelEducacion               String?                     @map("nivel_educacion")
  nombreRefiere                String?                     @map("nombre_refiere")
  ocupacion                    String?
  referidoPor                  String?                     @map("referido_por")
  tipoPaciente                 String?                     @map("tipo_paciente")
  tipoUsuario                  String?                     @map("tipo_usuario")
  administracionesMedicamentos AdministracionMedicamento[]
  admisiones                   Admision[]
  alertasClinicas              AlertaClinica[]
  atencionesUrgencias          AtencionUrgencia[]
  citas                        Cita[]
  diagnosticosHCE              DiagnosticoHCE[]
  documentos                   DocumentoPaciente[]
  evolucionesClinicas          EvolucionClinica[]
  facturas                     Factura[]
  interconsultas               Interconsulta[]
  notasEnfermeria              NotaEnfermeria[]
  ordenesMedicamentos          OrdenMedicamento[]
  ordenesMedicas               OrdenMedica[]
  pqrs                         PQRS[]                      @relation("PQRSPaciente")
  prescripciones               Prescripcion[]
  procedimientos               Procedimiento[]
  signosVitales                SignoVital[]
  ticketsSoporte               TicketSoporte[]
  glucometrias                 Glucometria[]
  balanceLiquidos              BalanceLiquidos[]
  transfusiones                Transfusion[]

  // Calidad Relations
  eventosAdversos           EventoAdverso[]
  notificacionesSIVIGILA    NotificacionSIVIGILA[]
  reportesFarmacovigilancia ReporteFarmacovigilancia[]
  reportesTecnovigilancia   ReporteTecnovigilancia[]
  estudiosImagenologia      EstudioImagenologia[]

  // Tienda
  ordenesTienda OrdenTienda[]

  // Antecedentes MÃ©dicos Estructurados (nuevos modelos)
  patologicosEstructurados    AntecedentePatologico[]
  quirurgicosEstructurados    AntecedenteQuirurgico[]
  alergicosEstructurados      AntecedenteAlergico[]
  familiaresEstructurados     AntecedenteFamiliar[]
  farmacologicosEstructurados AntecedenteFarmacologico[]
  ginecoObstetrico            AntecedenteGinecoObstetrico?

  // Incapacidades, Certificados y Seguimientos
  incapacidades IncapacidadMedica[]
  certificados  CertificadoMedico[]
  seguimientos  SeguimientoControl[]

  // AI Assistant
  aiConversations AiConversationLog[] @relation("AiConversationPaciente")

  // HCE Analyzer - Documentos externos asociados al paciente
  documentosHCEExternos DocumentoHCEExterno[] @relation("DocumentoHCEPaciente")

  @@map("pacientes")
}

model Cita {
  id                    String               @id @default(uuid())
  pacienteId            String               @map("paciente_id")
  doctorId              String?              @map("doctor_id") @db.Uuid
  admisionId            String?              @map("admision_id")
  especialidadId        String?              @map("especialidad_id") @db.Uuid
  examenProcedimientoId String?              @map("examen_procedimiento_id") @db.Uuid
  tipoCita              String?              @default("Especialidad") @map("tipo_cita") @db.VarChar(50)
  fecha                 DateTime?            @db.Date
  hora                  DateTime?            @db.Time(6)
  duracionMinutos       Int?                 @default(30) @map("duracion_minutos")
  costo                 Decimal              @default(0) @db.Decimal(10, 2)
  motivo                String
  estado                EstadoCita           @default(PorAgendar)
  prioridad             String?              @default("Media") @db.VarChar(50)
  notas                 String?
  createdAt             DateTime             @default(now()) @map("created_at")
  updatedAt             DateTime             @updatedAt @map("updated_at")
  atencionesUrgencias   AtencionUrgencia[]
  admision              Admision?            @relation(fields: [admisionId], references: [id])
  doctor                Usuario?             @relation("CitasDoctor", fields: [doctorId], references: [id], onDelete: Cascade)
  especialidad          Especialidad?        @relation(fields: [especialidadId], references: [id])
  examenProcedimiento   ExamenProcedimiento? @relation(fields: [examenProcedimientoId], references: [id])
  paciente              Paciente             @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  evolucionesClinicas   EvolucionClinica[]
  itemsFactura          FacturaItem[]
  ordenesMedicamentos   OrdenMedicamento[]
  ordenesMedicas        OrdenMedica[]
  pqrs                  PQRS[]               @relation("PQRSCita")
  prescripciones        Prescripcion[]
  procedimientos        Procedimiento[]
  signosVitales         SignoVital[]
  ticketsSoporte        TicketSoporte[]
  paymentSession        PaymentSession?
  incapacidades         IncapacidadMedica[]
  certificados          CertificadoMedico[]
  aiConversations       AiConversationLog[]  @relation("AiConversationCita")

  @@map("citas")
}

model Departamento {
  id             String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nombre         String         @unique @db.VarChar(255)
  descripcion    String?
  responsableId  String?        @map("responsable_id") @db.Uuid
  estado         String         @default("Activo") @db.VarChar(20)
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @default(now()) @map("updated_at")
  responsable    Usuario?       @relation("DepartamentoResponsable", fields: [responsableId], references: [id])
  especialidades Especialidad[]

  @@map("departamentos")
}

model Especialidad {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  titulo             String               @db.VarChar(255)
  codigo             String?              @db.VarChar(50)
  departamentoId     String               @map("departamento_id") @db.Uuid
  costoCOP           Decimal              @map("costo_cop") @db.Decimal(10, 2)
  duracionMinutos    Int                  @map("duracion_minutos")
  duracionExternaMin Int?                 @map("duracion_externa_min")
  duracionInternaMin Int?                 @map("duracion_interna_min")
  descripcion        String?
  estado             String               @default("Activo") @db.VarChar(20)
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @default(now()) @map("updated_at")
  citas              Cita[]
  doctores           DoctorEspecialidad[]
  departamento       Departamento         @relation(fields: [departamentoId], references: [id], onDelete: Cascade)

  @@map("especialidades")
}

model Doctor {
  id               String               @id @default(uuid()) @db.Uuid
  usuarioId        String               @unique @map("usuario_id") @db.Uuid
  licenciaMedica   String               @map("licencia_medica")
  universidad      String?
  aniosExperiencia Int?                 @map("anios_experiencia")
  biografia        String?
  foto             String?              @db.VarChar(500)
  horarios         Json?
  createdAt        DateTime             @default(now()) @map("created_at")
  updatedAt        DateTime             @updatedAt @map("updated_at")
  usuario          Usuario              @relation(fields: [usuarioId], references: [id])
  especialidades   DoctorEspecialidad[]

  @@map("doctores")
}

model DoctorEspecialidad {
  id             String       @id @default(uuid()) @db.Uuid
  doctorId       String       @map("doctor_id") @db.Uuid
  especialidadId String       @map("especialidad_id") @db.Uuid
  createdAt      DateTime     @default(now()) @map("created_at")
  doctor         Doctor       @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  especialidad   Especialidad @relation(fields: [especialidadId], references: [id])

  @@unique([doctorId, especialidadId])
  @@map("doctores_especialidades")
}

model CategoriaExamen {
  id          String                @id @default(uuid()) @db.Uuid
  nombre      String                @db.VarChar(255)
  descripcion String
  colorHex    String                @map("color_hex") @db.VarChar(7)
  estado      String                @default("Activo") @db.VarChar(50)
  createdAt   DateTime              @default(now()) @map("created_at")
  updatedAt   DateTime              @updatedAt @map("updated_at")
  examenes    ExamenProcedimiento[]

  @@map("categorias_examenes")
}

model ExamenProcedimiento {
  id                  String           @id @default(uuid()) @db.Uuid
  tipo                String           @db.VarChar(50)
  nombre              String           @db.VarChar(255)
  descripcion         String?
  categoriaId         String?          @map("categoria_id") @db.Uuid
  duracionMinutos     Int              @map("duracion_minutos")
  costoBase           Decimal          @map("costo_base") @db.Decimal(10, 2)
  preparacionEspecial String?          @map("preparacion_especial")
  requiereAyuno       Boolean          @default(false) @map("requiere_ayuno")
  estado              String           @default("Activo") @db.VarChar(50)
  createdAt           DateTime         @default(now()) @map("created_at")
  updatedAt           DateTime         @updatedAt @map("updated_at")
  citas               Cita[]
  categoria           CategoriaExamen? @relation(fields: [categoriaId], references: [id])
  ordenesMedicas      OrdenMedica[]

  @@map("examenes_procedimientos")
}

model CategoriaProducto {
  id          String     @id @default(uuid())
  nombre      String
  descripcion String?
  color       String?
  activo      Boolean    @default(true)
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  productos   Producto[]

  @@map("categorias_productos")
}

model EtiquetaProducto {
  id        String             @id @default(uuid())
  nombre    String
  color     String?
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @updatedAt @map("updated_at")
  productos ProductoEtiqueta[]

  @@map("etiquetas_productos")
}

model Producto {
  id                         String                    @id @default(uuid())
  nombre                     String
  categoriaId                String                    @map("categoria_id")
  sku                        String                    @unique
  laboratorio                String?
  descripcion                String?
  principioActivo            String?                   @map("principio_activo")
  concentracion              String?
  viaAdministracion          String?                   @map("via_administracion")
  presentacion               String?
  registroSanitario          String?                   @map("registro_sanitario")
  temperaturaAlmacenamiento  String?                   @map("temperatura_almacenamiento")
  requiereReceta             Boolean                   @default(false) @map("requiere_receta")
  cantidadTotal              Int                       @map("cantidad_total")
  cantidadConsumida          Int                       @default(0) @map("cantidad_consumida")
  cantidadMinAlerta          Int                       @map("cantidad_min_alerta")
  lote                       String?
  fechaVencimiento           DateTime?                 @map("fecha_vencimiento")
  precioVenta                Float                     @map("precio_venta")
  precioCompra               Float?                    @map("precio_compra")
  activo                     Boolean                   @default(true)
  imagenUrl                  String?                   @map("imagen_url")
  createdAt                  DateTime                  @default(now()) @map("created_at")
  updatedAt                  DateTime                  @updatedAt @map("updated_at")
  ordenesItems               OrdenMedicamentoItem[]
  prescripcionesMedicamentos PrescripcionMedicamento[] @relation("PrescripcionProducto")
  categoria                  CategoriaProducto         @relation(fields: [categoriaId], references: [id])
  etiquetas                  ProductoEtiqueta[]
  ordenesTiendaItems         OrdenTiendaItem[]

  @@map("productos")
}

model ProductoEtiqueta {
  id         String           @id @default(uuid())
  productoId String           @map("producto_id")
  etiquetaId String           @map("etiqueta_id")
  createdAt  DateTime         @default(now()) @map("created_at")
  etiqueta   EtiquetaProducto @relation(fields: [etiquetaId], references: [id], onDelete: Cascade)
  producto   Producto         @relation(fields: [productoId], references: [id], onDelete: Cascade)

  @@unique([productoId, etiquetaId])
  @@map("productos_etiquetas")
}

model DocumentoPaciente {
  id             String   @id @default(uuid())
  pacienteId     String   @map("paciente_id")
  nombreArchivo  String   @map("nombre_archivo")
  nombreOriginal String   @map("nombre_original")
  tipoArchivo    String   @map("tipo_archivo")
  tamano         Int
  rutaArchivo    String   @map("ruta_archivo")
  descripcion    String?
  categoria      String?
  uploadedBy     String?  @map("uploaded_by") @db.Uuid
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  paciente       Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("documentos_paciente")
}

model Unidad {
  id                     String                 @id @default(uuid())
  nombre                 String                 @unique
  descripcion            String?
  tipo                   String
  capacidad              Int                    @default(0)
  activo                 Boolean                @default(true)
  createdAt              DateTime               @default(now()) @map("created_at")
  updatedAt              DateTime               @updatedAt @map("updated_at")
  admisiones             Admision[]
  asignacionesEnfermeria AsignacionEnfermeria[]
  habitaciones           Habitacion[]
  movimientosDestino     Movimiento[]           @relation("MovimientoUnidadDestino")
  movimientosOrigen      Movimiento[]           @relation("MovimientoUnidadOrigen")

  @@map("unidades")
}

model Habitacion {
  id             String   @id @default(uuid())
  numero         String
  unidadId       String   @map("unidad_id")
  piso           Int?
  capacidadCamas Int      @default(1) @map("capacidad_camas")
  activo         Boolean  @default(true)
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  camas          Cama[]
  unidad         Unidad   @relation(fields: [unidadId], references: [id], onDelete: Cascade)

  @@unique([numero, unidadId])
  @@map("habitaciones")
}

model Cama {
  id                 String       @id @default(uuid())
  numero             String
  habitacionId       String       @map("habitacion_id")
  estado             EstadoCama   @default(Disponible)
  observaciones      String?
  createdAt          DateTime     @default(now()) @map("created_at")
  updatedAt          DateTime     @updatedAt @map("updated_at")
  admisiones         Admision[]
  habitacion         Habitacion   @relation(fields: [habitacionId], references: [id], onDelete: Cascade)
  movimientosDestino Movimiento[] @relation("MovimientoCamaDestino")
  movimientosOrigen  Movimiento[] @relation("MovimientoCamaOrigen")

  @@unique([numero, habitacionId])
  @@map("camas")
}

model Admision {
  id                  String             @id @default(uuid())
  pacienteId          String             @map("paciente_id")
  unidadId            String             @map("unidad_id")
  camaId              String?            @map("cama_id")
  fechaIngreso        DateTime           @default(now()) @map("fecha_ingreso")
  fechaEgreso         DateTime?          @map("fecha_egreso")
  motivoIngreso       String             @map("motivo_ingreso")
  diagnosticoIngreso  String             @map("diagnostico_ingreso")
  diagnosticoEgreso   String?            @map("diagnostico_egreso")
  estado              EstadoAdmision     @default(Activa)
  observaciones       String?
  responsableIngreso  String?            @map("responsable_ingreso") @db.Uuid
  responsableEgreso   String?            @map("responsable_egreso") @db.Uuid
  createdAt           DateTime           @default(now()) @map("created_at")
  updatedAt           DateTime           @updatedAt @map("updated_at")
  cama                Cama?              @relation(fields: [camaId], references: [id])
  paciente            Paciente           @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  unidad              Unidad             @relation(fields: [unidadId], references: [id])
  atencionesUrgencias AtencionUrgencia[]
  citas               Cita[]
  diagnosticosHCE     DiagnosticoHCE[]
  egreso              Egreso?
  evolucionesClinicas EvolucionClinica[]
  itemsFactura        FacturaItem[]
  interconsultas      Interconsulta[]
  movimientos         Movimiento[]
  notasEnfermeria     NotaEnfermeria[]
  ordenesMedicamentos OrdenMedicamento[]
  ordenesMedicas      OrdenMedica[]
  pqrs                PQRS[]             @relation("PQRSAdmision")
  prescripciones      Prescripcion[]
  procedimientos      Procedimiento[]
  signosVitales       SignoVital[]
  ticketsSoporte      TicketSoporte[]
  glucometrias        Glucometria[]
  balanceLiquidos     BalanceLiquidos[]
  transfusiones       Transfusion[]

  @@map("admisiones")
}

model Movimiento {
  id              String         @id @default(uuid())
  admisionId      String         @map("admision_id")
  tipo            TipoMovimiento
  unidadOrigenId  String?        @map("unidad_origen_id")
  unidadDestinoId String?        @map("unidad_destino_id")
  camaOrigenId    String?        @map("cama_origen_id")
  camaDestinoId   String?        @map("cama_destino_id")
  motivo          String
  observaciones   String?
  responsable     String?        @db.Uuid
  fechaMovimiento DateTime       @default(now()) @map("fecha_movimiento")
  createdAt       DateTime       @default(now()) @map("created_at")
  nota            String?        @map("nota")
  admision        Admision       @relation(fields: [admisionId], references: [id], onDelete: Cascade)
  camaDestino     Cama?          @relation("MovimientoCamaDestino", fields: [camaDestinoId], references: [id])
  camaOrigen      Cama?          @relation("MovimientoCamaOrigen", fields: [camaOrigenId], references: [id])
  unidadDestino   Unidad?        @relation("MovimientoUnidadDestino", fields: [unidadDestinoId], references: [id])
  unidadOrigen    Unidad?        @relation("MovimientoUnidadOrigen", fields: [unidadOrigenId], references: [id])

  @@map("movimientos")
}

model Egreso {
  id                       String               @id @default(uuid())
  admisionId               String               @unique @map("admision_id")
  fechaEgreso              DateTime             @default(now()) @map("fecha_egreso")
  horaEgreso               DateTime             @default(now()) @map("hora_egreso")
  diagnosticoSalida        String               @map("diagnostico_salida")
  descripcionDiagnostico   String               @map("descripcion_diagnostico")
  resumenClinico           String               @map("resumen_clinico")
  tratamientoDomiciliario  String?              @map("tratamiento_domiciliario")
  recomendaciones          String?
  profesionalResponsableId String               @map("profesional_responsable_id") @db.Uuid
  tipoEgreso               TipoEgreso           @map("tipo_egreso")
  estadoPaciente           EstadoPacienteEgreso @map("estado_paciente")
  requiereControl          Boolean              @default(false) @map("requiere_control")
  fechaControl             DateTime?            @map("fecha_control") @db.Date
  observaciones            String?
  firmaDigital             String?              @map("firma_digital")
  createdAt                DateTime             @default(now()) @map("created_at")
  updatedAt                DateTime             @updatedAt @map("updated_at")
  admision                 Admision             @relation(fields: [admisionId], references: [id], onDelete: Cascade)

  @@map("egresos")
}

model PaqueteHospitalizacion {
  id          String   @id @default(uuid())
  nombre      String
  descripcion String?
  tipoUnidad  String
  precioDia   Decimal  @map("precio_dia") @db.Decimal(10, 2)
  incluye     String?
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("paquetes_hospitalizacion")
}

model OrdenMedica {
  id                    String              @id @default(uuid())
  pacienteId            String              @map("paciente_id")
  citaId                String?             @map("cita_id")
  admisionId            String?             @map("admision_id")
  examenProcedimientoId String              @map("examen_procedimiento_id") @db.Uuid
  doctorId              String              @map("doctor_id") @db.Uuid
  estado                EstadoOrdenMedica   @default(Pendiente)
  prioridad             PrioridadOrden      @default(Normal)
  observaciones         String?
  resultados            String?
  archivoResultado      String?             @map("archivo_resultado")
  precioAplicado        Decimal             @map("precio_aplicado") @db.Decimal(10, 2)
  fechaOrden            DateTime            @default(now()) @map("fecha_orden")
  fechaEjecucion        DateTime?           @map("fecha_ejecucion")
  ejecutadoPor          String?             @map("ejecutado_por") @db.Uuid
  createdAt             DateTime            @default(now()) @map("created_at")
  updatedAt             DateTime            @updatedAt @map("updated_at")
  itemsFactura          FacturaItem[]
  admision              Admision?           @relation(fields: [admisionId], references: [id])
  cita                  Cita?               @relation(fields: [citaId], references: [id])
  doctor                Usuario             @relation("OrdenMedicaDoctor", fields: [doctorId], references: [id])
  ejecutador            Usuario?            @relation("OrdenMedicaEjecutor", fields: [ejecutadoPor], references: [id])
  examenProcedimiento   ExamenProcedimiento @relation(fields: [examenProcedimientoId], references: [id])
  paciente              Paciente            @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("ordenes_medicas")
}

model OrdenMedicamento {
  id            String                 @id @default(uuid())
  pacienteId    String                 @map("paciente_id")
  citaId        String?                @map("cita_id")
  admisionId    String?                @map("admision_id")
  doctorId      String                 @map("doctor_id") @db.Uuid
  estado        EstadoOrdenMedicamento @default(Pendiente)
  observaciones String?
  recetaDigital String?                @map("receta_digital")
  archivoReceta String?                @map("archivo_receta")
  total         Decimal                @db.Decimal(10, 2)
  fechaOrden    DateTime               @default(now()) @map("fecha_orden")
  fechaDespacho DateTime?              @map("fecha_despacho")
  despachadoPor String?                @map("despachado_por") @db.Uuid
  createdAt     DateTime               @default(now()) @map("created_at")
  updatedAt     DateTime               @updatedAt @map("updated_at")
  itemsFactura  FacturaItem[]
  admision      Admision?              @relation(fields: [admisionId], references: [id])
  cita          Cita?                  @relation(fields: [citaId], references: [id])
  despachador   Usuario?               @relation("OrdenMedicamentoDespachador", fields: [despachadoPor], references: [id])
  doctor        Usuario                @relation("OrdenMedicamentoDoctor", fields: [doctorId], references: [id])
  paciente      Paciente               @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  items         OrdenMedicamentoItem[]

  @@map("ordenes_medicamentos")
}

model OrdenMedicamentoItem {
  id                 String           @id @default(uuid())
  ordenMedicamentoId String           @map("orden_medicamento_id")
  productoId         String           @map("producto_id")
  cantidad           Int
  precioUnitario     Decimal          @map("precio_unitario") @db.Decimal(10, 2)
  descuento          Decimal          @default(0) @db.Decimal(10, 2)
  subtotal           Decimal          @db.Decimal(10, 2)
  indicaciones       String?
  createdAt          DateTime         @default(now()) @map("created_at")
  ordenMedicamento   OrdenMedicamento @relation(fields: [ordenMedicamentoId], references: [id], onDelete: Cascade)
  producto           Producto         @relation(fields: [productoId], references: [id])

  @@map("ordenes_medicamentos_items")
}

model Factura {
  id               String        @id @default(uuid())
  numero           String        @unique
  pacienteId       String        @map("paciente_id")
  estado           EstadoFactura @default(Pendiente)
  subtotal         Decimal       @db.Decimal(10, 2)
  descuentos       Decimal       @default(0) @db.Decimal(10, 2)
  impuestos        Decimal       @default(0) @db.Decimal(10, 2)
  total            Decimal       @db.Decimal(10, 2)
  saldoPendiente   Decimal       @map("saldo_pendiente") @db.Decimal(10, 2)
  observaciones    String?
  cubiertoPorEPS   Boolean       @default(false) @map("cubierto_por_eps")
  epsAutorizacion  String?       @map("eps_autorizacion")
  montoEPS         Decimal?      @map("monto_eps") @db.Decimal(10, 2)
  montoPaciente    Decimal?      @map("monto_paciente") @db.Decimal(10, 2)
  fechaEmision     DateTime      @default(now()) @map("fecha_emision")
  fechaVencimiento DateTime?     @map("fecha_vencimiento")
  creadaPor        String?       @map("creada_por") @db.Uuid
  createdAt        DateTime      @default(now()) @map("created_at")
  updatedAt        DateTime      @updatedAt @map("updated_at")
  creador          Usuario?      @relation(fields: [creadaPor], references: [id])
  paciente         Paciente      @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  items            FacturaItem[]
  pagos            Pago[]

  @@map("facturas")
}

model FacturaItem {
  id                 String            @id @default(uuid())
  facturaId          String            @map("factura_id")
  tipo               TipoItemFactura
  descripcion        String
  cantidad           Int               @default(1)
  precioUnitario     Decimal           @map("precio_unitario") @db.Decimal(10, 2)
  descuento          Decimal           @default(0) @db.Decimal(10, 2)
  subtotal           Decimal           @db.Decimal(10, 2)
  citaId             String?           @map("cita_id")
  ordenMedicaId      String?           @map("orden_medica_id")
  ordenMedicamentoId String?           @map("orden_medicamento_id")
  admisionId         String?           @map("admision_id")
  createdAt          DateTime          @default(now()) @map("created_at")
  admision           Admision?         @relation(fields: [admisionId], references: [id])
  cita               Cita?             @relation(fields: [citaId], references: [id])
  factura            Factura           @relation(fields: [facturaId], references: [id], onDelete: Cascade)
  ordenMedica        OrdenMedica?      @relation(fields: [ordenMedicaId], references: [id])
  ordenMedicamento   OrdenMedicamento? @relation(fields: [ordenMedicamentoId], references: [id])

  @@map("facturas_items")
}

model Pago {
  id            String     @id @default(uuid())
  facturaId     String     @map("factura_id")
  monto         Decimal    @db.Decimal(10, 2)
  metodoPago    MetodoPago @map("metodo_pago")
  referencia    String?
  observaciones String?
  fechaPago     DateTime   @default(now()) @map("fecha_pago")
  registradoPor String?    @map("registrado_por") @db.Uuid
  createdAt     DateTime   @default(now()) @map("created_at")
  factura       Factura    @relation(fields: [facturaId], references: [id], onDelete: Cascade)
  registrador   Usuario?   @relation(fields: [registradoPor], references: [id])

  @@map("pagos")
}

model EvolucionClinica {
  id                  String           @id @default(uuid())
  pacienteId          String           @map("paciente_id")
  admisionId          String?          @map("admision_id")
  citaId              String?          @map("cita_id")
  doctorId            String           @map("doctor_id") @db.Uuid
  subjetivo           String
  objetivo            String
  analisis            String
  plan                String
  tipoEvolucion       TipoEvolucion
  fechaEvolucion      DateTime         @default(now()) @map("fecha_evolucion")
  turno               String?
  areaHospitalizacion String?          @map("area_hospitalizacion")
  firmada             Boolean          @default(false)
  firmaDigital        String?          @map("firma_digital")
  hashRegistro        String?          @map("hash_registro")
  fechaFirma          DateTime?        @map("fecha_firma")
  ipRegistro          String?          @map("ip_registro")
  createdAt           DateTime         @default(now()) @map("created_at")
  updatedAt           DateTime         @updatedAt @map("updated_at")
  diagnosticos        DiagnosticoHCE[]
  admision            Admision?        @relation(fields: [admisionId], references: [id])
  cita                Cita?            @relation(fields: [citaId], references: [id])
  doctor              Usuario          @relation("EvolucionDoctor", fields: [doctorId], references: [id])
  paciente            Paciente         @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("evoluciones_clinicas")
}

model SignoVital {
  id                     String    @id @default(uuid())
  pacienteId             String    @map("paciente_id")
  admisionId             String?   @map("admision_id")
  citaId                 String?   @map("cita_id")
  registradoPor          String    @map("registrado_por") @db.Uuid
  temperatura            Decimal?  @db.Decimal(4, 1)
  presionSistolica       Int?      @map("presion_sistolica")
  presionDiastolica      Int?      @map("presion_diastolica")
  frecuenciaCardiaca     Int?      @map("frecuencia_cardiaca")
  frecuenciaRespiratoria Int?      @map("frecuencia_respiratoria")
  saturacionOxigeno      Decimal?  @map("saturacion_oxigeno") @db.Decimal(5, 2)
  peso                   Decimal?  @db.Decimal(6, 2)
  talla                  Decimal?  @db.Decimal(5, 2)
  imc                    Decimal?  @db.Decimal(5, 2)
  perimetroCefalico      Decimal?  @map("perimetro_cefalico") @db.Decimal(5, 2)
  escalaDolor            Int?      @map("escala_dolor")
  turno                  String?
  fechaRegistro          DateTime  @default(now()) @map("fecha_registro")
  observaciones          String?
  alertaGenerada         Boolean   @default(false) @map("alerta_generada")
  createdAt              DateTime  @default(now()) @map("created_at")
  admision               Admision? @relation(fields: [admisionId], references: [id])
  cita                   Cita?     @relation(fields: [citaId], references: [id])
  paciente               Paciente  @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  registrador            Usuario   @relation("SignoVitalRegistrador", fields: [registradoPor], references: [id])

  @@map("signos_vitales")
}

model DiagnosticoHCE {
  id                String               @id @default(uuid())
  pacienteId        String               @map("paciente_id")
  evolucionId       String?              @map("evolucion_id")
  admisionId        String?              @map("admision_id")
  doctorId          String               @map("doctor_id") @db.Uuid
  codigoCIE11       String               @map("codigo_cie11")
  descripcionCIE11  String               @map("descripcion_cie11")
  tipoDiagnostico   TipoDiagnosticoHCE   @map("tipo_diagnostico")
  estadoDiagnostico EstadoDiagnosticoHCE @map("estado_diagnostico")
  esDiferencial     Boolean              @default(false) @map("es_diferencial")
  observaciones     String?
  fechaDiagnostico  DateTime             @default(now()) @map("fecha_diagnostico")
  fechaResolucion   DateTime?            @map("fecha_resolucion")
  severidad         SeveridadHCE?
  createdAt         DateTime             @default(now()) @map("created_at")
  updatedAt         DateTime             @updatedAt @map("updated_at")
  admision          Admision?            @relation(fields: [admisionId], references: [id])
  doctor            Usuario              @relation("DiagnosticoHCEDoctor", fields: [doctorId], references: [id])
  evolucion         EvolucionClinica?    @relation(fields: [evolucionId], references: [id])
  paciente          Paciente             @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("diagnosticos_hce")
}

model AlertaClinica {
  id                  String        @id @default(uuid())
  pacienteId          String        @map("paciente_id")
  tipoAlerta          TipoAlertaHCE
  severidad           SeveridadHCE
  titulo              String
  descripcion         String
  origen              String?
  valorReferencia     String?       @map("valor_referencia")
  visiblePara         String[]      @map("visible_para")
  colorAlerta         String        @default("red") @map("color_alerta")
  iconoAlerta         String?       @map("icono_alerta")
  activa              Boolean       @default(true)
  reconocidaPor       String?       @map("reconocida_por") @db.Uuid
  fechaReconocimiento DateTime?     @map("fecha_reconocimiento")
  fechaAlerta         DateTime      @default(now()) @map("fecha_alerta")
  fechaExpiracion     DateTime?     @map("fecha_expiracion")
  createdAt           DateTime      @default(now()) @map("created_at")
  paciente            Paciente      @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  reconocedor         Usuario?      @relation("AlertaReconocedor", fields: [reconocidaPor], references: [id])

  @@map("alertas_clinicas")
}

model AuditoriaHCE {
  id                String             @id @default(uuid())
  entidad           String
  entidadId         String             @map("entidad_id")
  accion            AccionAuditoriaHCE
  usuarioId         String             @map("usuario_id") @db.Uuid
  nombreUsuario     String             @map("nombre_usuario")
  rol               String
  fechaAccion       DateTime           @default(now()) @map("fecha_accion")
  ipOrigen          String?            @map("ip_origen")
  navegador         String?
  dispositivo       String?
  valoresAnteriores Json?              @map("valores_anteriores")
  valoresNuevos     Json?              @map("valores_nuevos")
  hashRegistro      String             @map("hash_registro")
  createdAt         DateTime           @default(now()) @map("created_at")
  usuario           Usuario            @relation("AuditoriaHCEUsuario", fields: [usuarioId], references: [id])

  @@map("auditoria_hce")
}

model Interconsulta {
  id                      String                 @id @default(uuid())
  admisionId              String
  pacienteId              String
  especialidadSolicitada  String                 @db.VarChar(255)
  medicoSolicitanteId     String                 @db.Uuid
  medicoEspecialistaId    String?                @db.Uuid
  fechaSolicitud          DateTime               @default(now())
  fechaRespuesta          DateTime?
  motivoConsulta          String
  antecedentesRelevantes  String?
  examenesSolicitados     String?
  diagnosticoPresuntivo   String?
  prioridad               PrioridadInterconsulta @default(Media)
  estado                  EstadoInterconsulta    @default(Solicitada)
  evaluacionEspecialista  String?
  diagnosticoEspecialista String?
  recomendaciones         String?
  requiereSeguimiento     Boolean                @default(false)
  fechaSeguimiento        DateTime?
  observaciones           String?
  createdAt               DateTime               @default(now())
  updatedAt               DateTime               @updatedAt
  admision                Admision               @relation(fields: [admisionId], references: [id], onDelete: Cascade)
  medicoEspecialista      Usuario?               @relation("InterconsultasRespondidas", fields: [medicoEspecialistaId], references: [id])
  medicoSolicitante       Usuario                @relation("InterconsultasSolicitadas", fields: [medicoSolicitanteId], references: [id])
  paciente                Paciente               @relation(fields: [pacienteId], references: [id])

  @@index([admisionId])
  @@index([pacienteId])
  @@index([estado])
  @@index([fechaSolicitud])
  @@map("interconsultas")
}

model Quirofano {
  id             String          @id @default(uuid())
  nombre         String          @unique @db.VarChar(100)
  tipo           String          @db.VarChar(50)
  ubicacion      String?         @db.VarChar(100)
  estado         String          @default("Activo")
  capacidad      Int             @default(1)
  equipamiento   Json?
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")
  procedimientos Procedimiento[]

  @@map("quirofanos")
}

model Procedimiento {
  id                  String              @id @default(uuid())
  admisionId          String?
  citaId              String?
  pacienteId          String
  medicoResponsableId String              @db.Uuid
  nombre              String              @db.VarChar(255)
  tipo                TipoProcedimiento   @default(Terapeutico)
  tipoCirugia         String?             @db.VarChar(50)
  tipoAnestesia       String?             @db.VarChar(50)
  codigoCIE10         String?             @db.VarChar(20)
  codigoCUPS          String?             @db.VarChar(20)
  prioridad           String?             @default("Electivo") @db.VarChar(20)
  nivelComplejidad    String?             @default("Media") @db.VarChar(20)
  riesgosPotenciales  String?             @db.Text
  firmaPaciente       String?             @db.Text
  fechaConsentimiento DateTime?
  tiempoAyuno         Int?
  clasificacionASA    String?             @db.VarChar(10)
  ayudantes           Json?
  sangradoAproximado  Int?
  incapacidadDias     Int?
  epicrisis           String?             @db.Text
  descripcion         String
  indicacion          String
  fechaProgramada     DateTime?
  fechaRealizada      DateTime?
  horaInicioReal      DateTime?
  horaFinReal         DateTime?
  duracionEstimada    Int?
  duracionReal        Int?
  estado              EstadoProcedimiento @default(Programado)
  tecnicaUtilizada    String?
  hallazgos           String?
  complicaciones      String?
  resultados          String?
  insumosUtilizados   String?
  equipoMedico        String?
  personalAsistente   String?
  recomendacionesPost String?
  cuidadosEspeciales  String?
  observaciones       String?
  firmaMedicoId       String?             @db.Uuid
  fechaFirma          DateTime?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  anestesiologoId     String?             @db.Uuid
  quirofanoId         String?
  admision            Admision?           @relation(fields: [admisionId], references: [id], onDelete: Cascade)
  anestesiologo       Usuario?            @relation("ProcedimientoAnestesiologo", fields: [anestesiologoId], references: [id])
  cita                Cita?               @relation(fields: [citaId], references: [id])
  medicoFirma         Usuario?            @relation("ProcedimientoFirma", fields: [firmaMedicoId], references: [id])
  medicoResponsable   Usuario             @relation("ProcedimientoResponsable", fields: [medicoResponsableId], references: [id])
  paciente            Paciente            @relation(fields: [pacienteId], references: [id])
  quirofano           Quirofano?          @relation(fields: [quirofanoId], references: [id])

  @@index([admisionId])
  @@index([pacienteId])
  @@index([estado])
  @@index([fechaProgramada])
  @@index([fechaRealizada])
  @@map("procedimientos")
}

model Prescripcion {
  id                String                    @id @default(uuid())
  pacienteId        String
  admisionId        String?
  citaId            String?
  medicoId          String                    @db.Uuid
  fechaPrescripcion DateTime                  @default(now())
  fechaInicio       DateTime                  @default(now())
  fechaFin          DateTime?
  diagnostico       String?
  observaciones     String?
  estado            EstadoPrescripcion        @default(Activa)
  firmaMedicoId     String?                   @db.Uuid
  fechaFirma        DateTime?
  createdAt         DateTime                  @default(now())
  updatedAt         DateTime                  @updatedAt
  admision          Admision?                 @relation(fields: [admisionId], references: [id], onDelete: Cascade)
  cita              Cita?                     @relation(fields: [citaId], references: [id])
  medicoFirma       Usuario?                  @relation("PrescripcionFirma", fields: [firmaMedicoId], references: [id])
  medico            Usuario                   @relation("PrescripcionMedico", fields: [medicoId], references: [id])
  paciente          Paciente                  @relation(fields: [pacienteId], references: [id])
  medicamentos      PrescripcionMedicamento[]

  @@index([pacienteId])
  @@index([admisionId])
  @@index([estado])
  @@index([fechaPrescripcion])
  @@map("prescripciones")
}

model PrescripcionMedicamento {
  id                 String                      @id @default(uuid())
  prescripcionId     String
  productoId         String
  dosis              String                      @db.VarChar(100)
  via                ViaPrescripcion             @default(Oral)
  frecuencia         FrecuenciaPrescripcion      @default(Cada8Horas)
  frecuenciaDetalle  String?                     @db.VarChar(255)
  duracionDias       Int?
  cantidadTotal      String?                     @db.VarChar(50)
  instrucciones      String?
  indicacionEspecial String?
  prn                Boolean                     @default(false)
  suspendido         Boolean                     @default(false)
  fechaSuspension    DateTime?
  motivoSuspension   String?
  createdAt          DateTime                    @default(now())
  updatedAt          DateTime                    @updatedAt
  administraciones   AdministracionMedicamento[]
  prescripcion       Prescripcion                @relation(fields: [prescripcionId], references: [id], onDelete: Cascade)
  producto           Producto                    @relation("PrescripcionProducto", fields: [productoId], references: [id])

  @@index([prescripcionId])
  @@index([productoId])
  @@map("prescripciones_medicamentos")
}

model AdministracionMedicamento {
  id                        String                  @id @default(uuid())
  prescripcionMedicamentoId String
  pacienteId                String
  fechaProgramada           DateTime
  horaProgramada            String                  @db.VarChar(10)
  fechaAdministracion       DateTime?
  administradoPor           String?                 @db.Uuid
  estado                    EstadoAdministracion    @default(Programada)
  dosisAdministrada         String?                 @db.VarChar(100)
  viaAdministrada           String?                 @db.VarChar(50)
  observaciones             String?
  reaccionAdversa           Boolean                 @default(false)
  descripcionReaccion       String?
  motivoOmision             String?
  motivoRechazo             String?
  createdAt                 DateTime                @default(now())
  updatedAt                 DateTime                @updatedAt
  enfermera                 Usuario?                @relation("AdministracionEnfermera", fields: [administradoPor], references: [id])
  paciente                  Paciente                @relation(fields: [pacienteId], references: [id])
  prescripcionMedicamento   PrescripcionMedicamento @relation(fields: [prescripcionMedicamentoId], references: [id], onDelete: Cascade)

  @@index([prescripcionMedicamentoId])
  @@index([pacienteId])
  @@index([fechaProgramada])
  @@index([estado])
  @@map("administraciones_medicamentos")
}

model AsignacionEnfermeria {
  id          String          @id @default(uuid())
  enfermeraId String          @map("enfermera_id") @db.Uuid
  unidadId    String          @map("unidad_id")
  piso        Int?
  turno       TurnoEnfermeria
  fechaInicio DateTime        @default(now()) @map("fecha_inicio")
  fechaFin    DateTime?       @map("fecha_fin")
  activo      Boolean         @default(true)
  createdAt   DateTime        @default(now()) @map("created_at")
  enfermera   Usuario         @relation("EnfermeraAsignaciones", fields: [enfermeraId], references: [id], onDelete: Cascade)
  unidad      Unidad          @relation(fields: [unidadId], references: [id])

  @@index([enfermeraId])
  @@index([unidadId])
  @@index([activo])
  @@map("asignaciones_enfermeria")
}

model NotaEnfermeria {
  id                  String             @id @default(uuid())
  admisionId          String             @map("admision_id")
  pacienteId          String             @map("paciente_id")
  enfermeraId         String             @map("enfermera_id") @db.Uuid
  tipoNota            TipoNotaEnfermeria @map("tipo_nota")
  titulo              String?            @db.VarChar(255)
  contenido           String
  turno               TurnoEnfermeria
  fechaHora           DateTime           @default(now()) @map("fecha_hora")
  requiereSeguimiento Boolean            @default(false) @map("requiere_seguimiento")
  seguimientoPor      String?            @map("seguimiento_por")
  createdAt           DateTime           @default(now()) @map("created_at")
  updatedAt           DateTime           @updatedAt @map("updated_at")
  admision            Admision           @relation(fields: [admisionId], references: [id], onDelete: Cascade)
  enfermera           Usuario            @relation("NotasEnfermera", fields: [enfermeraId], references: [id])
  paciente            Paciente           @relation(fields: [pacienteId], references: [id])

  @@index([admisionId])
  @@index([pacienteId])
  @@index([enfermeraId])
  @@index([fechaHora])
  @@map("notas_enfermeria")
}

model RolePermiso {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rol       String   @db.VarChar(50)
  modulo    String   @db.VarChar(100)
  acceso    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @map("updated_at")

  @@unique([rol, modulo])
  @@map("role_permisos")
}

model AtencionUrgencia {
  id                     String               @id @default(uuid())
  pacienteId             String               @map("paciente_id")
  categoriaManchester    CategoriaManchester  @map("categoria_manchester")
  nivelUrgencia          String               @map("nivel_urgencia")
  prioridad              Int
  motivoConsulta         String               @map("motivo_consulta")
  horaLlegada            DateTime             @default(now()) @map("hora_llegada")
  horaTriaje             DateTime?            @map("hora_triaje")
  medioLlegada           String?              @map("medio_llegada")
  acompanante            String?
  presionSistolica       Int?                 @map("presion_sistolica")
  presionDiastolica      Int?                 @map("presion_diastolica")
  frecuenciaCardiaca     Int?                 @map("frecuencia_cardiaca")
  frecuenciaRespiratoria Int?                 @map("frecuencia_respiratoria")
  temperatura            Decimal?             @db.Decimal(4, 1)
  saturacionOxigeno      Decimal?             @map("saturacion_oxigeno") @db.Decimal(5, 2)
  escalaGlasgow          Int?                 @map("escala_glasgow")
  escalaDolor            Int?                 @map("escala_dolor")
  estado                 EstadoUrgencia       @default(Triaje)
  areaAsignada           String?              @map("area_asignada")
  medicoAsignadoId       String?              @map("medico_asignado_id") @db.Uuid
  enfermeraAsignadaId    String?              @map("enfermera_asignada_id") @db.Uuid
  horaInicioAtencion     DateTime?            @map("hora_inicio_atencion")
  horaFinAtencion        DateTime?            @map("hora_fin_atencion")
  diagnosticoInicial     String?              @map("diagnostico_inicial")
  tratamientoAplicado    String?              @map("tratamiento_aplicado")
  observaciones          String?
  disposicion            DisposicionUrgencia?
  indicacionesAlta       String?              @map("indicaciones_alta")
  citaId                 String?              @map("cita_id")
  admisionId             String?              @map("admision_id")
  createdAt              DateTime             @default(now()) @map("created_at")
  updatedAt              DateTime             @updatedAt @map("updated_at")
  admision               Admision?            @relation(fields: [admisionId], references: [id])
  cita                   Cita?                @relation(fields: [citaId], references: [id])
  enfermeraAsignada      Usuario?             @relation("UrgenciaEnfermera", fields: [enfermeraAsignadaId], references: [id])
  medicoAsignado         Usuario?             @relation("UrgenciaMedico", fields: [medicoAsignadoId], references: [id])
  paciente               Paciente             @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("atenciones_urgencias")
}

model Role {
  id          String           @id @default(uuid()) @db.Uuid
  name        String           @unique @db.VarChar(50)
  description String?
  isSystem    Boolean          @default(false) @map("is_system")
  parentId    String?          @map("parent_id") @db.Uuid
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  permissions RolePermission[]
  parent      Role?            @relation("RoleHierarchy", fields: [parentId], references: [id])
  children    Role[]           @relation("RoleHierarchy")
  users       UserRole[]

  @@map("roles")
}

model Permission {
  id          String           @id @default(uuid()) @db.Uuid
  name        String           @unique @db.VarChar(100)
  description String?
  module      String           @db.VarChar(50)
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  roles       RolePermission[]

  @@map("permissions")
}

model RolePermission {
  id           String     @id @default(uuid()) @db.Uuid
  roleId       String     @map("role_id") @db.Uuid
  permissionId String     @map("permission_id") @db.Uuid
  createdAt    DateTime   @default(now()) @map("created_at")
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

model UserRole {
  id         String    @id @default(uuid()) @db.Uuid
  usuarioId  String    @map("usuario_id") @db.Uuid
  roleId     String    @map("role_id") @db.Uuid
  assignedAt DateTime  @default(now()) @map("assigned_at")
  assignedBy String?   @map("assigned_by") @db.Uuid
  expiresAt  DateTime? @map("expires_at")
  assigner   Usuario?  @relation("RoleAssigner", fields: [assignedBy], references: [id])
  role       Role      @relation(fields: [roleId], references: [id], onDelete: Cascade)
  usuario    Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, roleId])
  @@map("user_roles")
}

model AuditLog {
  id         String   @id @default(uuid()) @db.Uuid
  userId     String?  @map("user_id") @db.Uuid
  action     String   @db.VarChar(100)
  resource   String   @db.VarChar(100)
  resourceId String?  @map("resource_id") @db.VarChar(100)
  details    Json?
  ipAddress  String?  @map("ip_address") @db.VarChar(45)
  userAgent  String?  @map("user_agent")
  createdAt  DateTime @default(now()) @map("created_at")
  user       Usuario? @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

model RoleTemplate {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique @db.VarChar(100)
  description String?
  permissions Json
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("role_templates")
}

model WorkflowApproval {
  id          String   @id @default(uuid()) @db.Uuid
  requesterId String   @map("requester_id") @db.Uuid
  type        String   @db.VarChar(50)
  data        Json
  status      String   @default("PENDING") @db.VarChar(20)
  approverId  String?  @map("approver_id") @db.Uuid
  reason      String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  approver    Usuario? @relation("WorkflowApprover", fields: [approverId], references: [id])
  requester   Usuario  @relation("WorkflowRequester", fields: [requesterId], references: [id])

  @@map("workflow_approvals")
}

model CatalogoCie11 {
  id          String   @id
  codigo      String   @unique @db.VarChar(20)
  descripcion String
  capitulo    String?
  titulo      String?
  estado      String   @default("Activo")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([codigo])
  @@index([descripcion])
  @@map("catalogo_cie11")
}

model CatalogoCie10 {
  id          String   @id @default(uuid())
  codigo      String   @unique @db.VarChar(10)
  descripcion String
  capitulo    String?
  grupo       String?
  estado      String   @default("Activo")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([codigo])
  @@index([descripcion])
  @@map("catalogo_cie10")
}

model CategoriaPublicacion {
  id            String        @id @default(uuid())
  nombre        String        @unique
  slug          String        @unique
  descripcion   String?
  activo        Boolean       @default(true)
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  publicaciones Publicacion[]

  @@map("categorias_publicaciones")
}

model Publicacion {
  id                       String                @id @default(uuid())
  titulo                   String
  slug                     String                @unique
  contenido                String
  extracto                 String?
  imagenPortada            String?               @map("imagen_portada")
  estado                   String                @default("Borrador")
  fechaPublicacion         DateTime?             @map("fecha_publicacion")
  autorId                  String                @map("autor_id") @db.Uuid
  categoriaId              String?               @map("categoria_id")
  diagnosticosRelacionados String[]              @map("diagnosticos_relacionados")
  createdAt                DateTime              @default(now()) @map("created_at")
  updatedAt                DateTime              @updatedAt @map("updated_at")
  autor                    Usuario               @relation(fields: [autorId], references: [id])
  categoria                CategoriaPublicacion? @relation(fields: [categoriaId], references: [id])

  @@map("publicaciones")
}

model PQRS {
  id                   String            @id @default(uuid())
  tipo                 TipoPQRS
  esAnonimo            Boolean           @default(false) @map("es_anonimo")
  pacienteId           String?           @map("paciente_id")
  asunto               String
  descripcion          String
  responsableId        String?           @map("responsable_id") @db.Uuid
  respondidoPor        String?           @map("respondido_por") @db.Uuid
  createdAt            DateTime          @default(now()) @map("created_at")
  updatedAt            DateTime          @updatedAt @map("updated_at")
  admisionId           String?           @map("admision_id")
  citaId               String?           @map("cita_id")
  datosContacto        Json?             @map("datos_contacto")
  fechaCierre          DateTime?         @map("fecha_cierre")
  fechaRecepcion       DateTime          @default(now()) @map("fecha_radicacion")
  fechaLimiteRespuesta DateTime?         @map("fecha_vencimiento")
  respuestaFinal       String?           @map("respuesta_final")
  areaAsignada         AreaHospital      @default(ATENCION_USUARIO) @map("area_asignada")
  prioridad            PrioridadPQRS     @default(MEDIA)
  estado               EstadoPQRS        @default(RADICADO)
  admision             Admision?         @relation("PQRSAdmision", fields: [admisionId], references: [id])
  cita                 Cita?             @relation("PQRSCita", fields: [citaId], references: [id])
  paciente             Paciente?         @relation("PQRSPaciente", fields: [pacienteId], references: [id])
  respondedor          Usuario?          @relation("PQRSRespondedor", fields: [respondidoPor], references: [id])
  responsable          Usuario?          @relation("PQRSResponsable", fields: [responsableId], references: [id])
  seguimientos         SeguimientoPQRS[]

  @@map("pqrs")
}

model SeguimientoPQRS {
  id            String      @id @default(uuid())
  pqrsId        String      @map("pqrs_id")
  accion        String      @map("accion")
  observaciones String      @map("observaciones")
  usuarioId     String      @map("usuario_id") @db.Uuid
  createdAt     DateTime    @default(now()) @map("created_at")
  esPrivado     Boolean     @default(false) @map("es_privado")
  nuevoEstado   EstadoPQRS? @map("nuevo_estado")
  pqrs          PQRS        @relation(fields: [pqrsId], references: [id])
  usuario       Usuario     @relation("SeguimientosPQRS", fields: [usuarioId], references: [id])

  @@map("seguimientos_pqrs")
}

model TicketSoporte {
  id                String          @id @default(uuid())
  codigo            String          @unique @default(dbgenerated("((('TKT-'::text || to_char(now(), 'YYYYMMDD'::text)) || '-'::text) || (floor((random() * (10000)::double precision)))::text)"))
  asunto            String
  descripcion       String
  categoria         CategoriaTicket
  prioridad         PrioridadTicket @default(MEDIA)
  estado            EstadoTicket    @default(ABIERTO)
  usuarioReportaId  String          @map("usuario_reporta_id") @db.Uuid
  usuarioAsignadoId String?         @map("usuario_asignado_id") @db.Uuid
  pacienteId        String?         @map("paciente_id")
  admisionId        String?         @map("admision_id")
  citaId            String?         @map("cita_id")
  solucion          String?
  fechaResolucion   DateTime?       @map("fecha_resolucion")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")
  admision          Admision?       @relation(fields: [admisionId], references: [id])
  cita              Cita?           @relation(fields: [citaId], references: [id])
  paciente          Paciente?       @relation(fields: [pacienteId], references: [id])
  asignado          Usuario?        @relation("TicketAsignado", fields: [usuarioAsignadoId], references: [id])
  reportador        Usuario         @relation("TicketReportador", fields: [usuarioReportaId], references: [id])

  @@map("tickets_soporte")
}

enum Rol {
  SUPER_ADMIN
  ADMIN
  DOCTOR
  NURSE
  RECEPTIONIST
  PATIENT
  PHARMACIST
  LAB_TECHNICIAN
}

enum Genero {
  Masculino
  Femenino
  Otro
}

enum EstadoCita {
  PorAgendar
  PendientePago
  Programada
  Confirmada
  EnEspera
  Atendiendo
  Completada
  Cancelada
  NoAsistio
}

enum Estado {
  Activo
  Inactivo
}

enum EstadoCama {
  Disponible
  Ocupada
  Mantenimiento
  Reservada
}

enum EstadoAdmision {
  Activa
  Egresada
  Cancelada
}

enum TipoMovimiento {
  Ingreso
  Traslado
  CambioCama
  CambioUnidad
  Egreso
}

enum TipoEgreso {
  AltaMedica
  Remision
  Voluntario
  Fallecimiento
  Fuga
}

enum EstadoPacienteEgreso {
  Mejorado
  Estable
  Complicado
  Fallecido
}

enum EstadoOrdenMedica {
  Pendiente
  EnProceso
  Completada
  Cancelada
}

enum PrioridadOrden {
  Normal
  Urgente
}

enum EstadoOrdenMedicamento {
  Pendiente
  Preparada
  Despachada
  Cancelada
}

enum EstadoFactura {
  Pendiente
  Parcial
  Pagada
  Cancelada
  Vencida
}

enum TipoItemFactura {
  Consulta
  OrdenMedica
  OrdenMedicamento
  Hospitalizacion
  Otro
}

enum MetodoPago {
  Efectivo
  Tarjeta
  Transferencia
  EPS
  ePayco
  Otro
}

enum TipoEvolucion {
  Ingreso
  Seguimiento
  Alta
  Urgencia
  Interconsulta
  Prequirurgico
  Postquirurgico
}

enum TipoDiagnosticoHCE {
  Principal
  Secundario
  Complicacion
  Comorbilidad
  Diferencial
}

enum EstadoDiagnosticoHCE {
  Activo
  EnControl
  Resuelto
  Descartado
}

enum SeveridadHCE {
  Leve
  Moderada
  Grave
  Critica
}

enum TipoAlertaHCE {
  AlergiaMedicamento
  Intolerancia
  RestriccionMovilidad
  Aislamiento
  RiesgoCaidas
  Recordatorio
  SignoVitalCritico
  ResultadoCritico
  InteraccionMedicamentosa
}

enum AccionAuditoriaHCE {
  Creacion
  Modificacion
  Eliminacion
  Visualizacion
  Firma
  Descarga
  Impresion
}

enum EstadoInterconsulta {
  Solicitada
  EnProceso
  Respondida
  Cancelada
}

enum PrioridadInterconsulta {
  Baja
  Media
  Alta
  Urgente
}

enum TipoProcedimiento {
  Diagnostico
  Terapeutico
  Quirurgico
  Intervencionista
  Rehabilitacion
  Otro
}

enum EstadoProcedimiento {
  Programado
  EnProceso
  Completado
  Cancelado
  Diferido
}

enum ViaPrescripcion {
  Oral
  Intravenosa
  Intramuscular
  Subcutanea
  Topica
  Inhalatoria
  Rectal
  Sublingual
  Oftaelmica
  Otica
  Nasal
  Otra
}

enum FrecuenciaPrescripcion {
  Unica
  Cada4Horas
  Cada6Horas
  Cada8Horas
  Cada12Horas
  Cada24Horas
  PRN
  Continua
  Otra
}

enum EstadoPrescripcion {
  Activa
  Suspendida
  Completada
  Cancelada
}

enum EstadoAdministracion {
  Programada
  Administrada
  Omitida
  Rechazada
}

enum TurnoEnfermeria {
  Manana
  Tarde
  Noche
}

enum TipoNotaEnfermeria {
  Evolucion
  Observacion
  Incidente
  CambioTurno
  Procedimiento
}

enum CategoriaManchester {
  Rojo
  Naranja
  Amarillo
  Verde
  Azul
}

enum EstadoUrgencia {
  Triaje
  Espera
  EnAtencion
  Completada
  Alta
  Hospitalizado
  Remitido
  Cancelado
}

enum DisposicionUrgencia {
  Alta
  Hospitalizar
  Remitir
  Fallecido
  Observacion
}

enum TipoPQRS {
  PETICION
  QUEJA
  RECLAMO
  SUGERENCIA
  FELICITACION
}

enum EstadoPQRS {
  RADICADO
  EN_TRAMITE
  ESPERANDO_INFORMACION
  RESUELTO
  CERRADO
}

enum PrioridadPQRS {
  BAJA
  MEDIA
  ALTA
  URGENTE
}

enum AreaHospital {
  ADMINISTRACION
  CONSULTA_EXTERNA
  URGENCIAS
  HOSPITALIZACION
  FARMACIA
  LABORATORIO
  IMAGENOLOGIA
  ATENCION_USUARIO
  SISTEMAS
  MANTENIMIENTO
  OTRO
}

enum CategoriaTicket {
  HARDWARE
  SOFTWARE
  REDES
  HCE
  MANTENIMIENTO
  OTRO
}

enum EstadoTicket {
  ABIERTO
  EN_PROGRESO
  RESUELTO
  CERRADO
}

enum PrioridadTicket {
  BAJA
  MEDIA
  ALTA
  CRITICA
}

model Glucometria {
  id                   String   @id @default(uuid())
  pacienteId           String   @map("paciente_id")
  admisionId           String?  @map("admision_id")
  valor                Int
  momento              String
  insulinaAdministrada Decimal? @map("insulina_administrada") @db.Decimal(5, 2)
  observaciones        String?
  registradoPor        String   @map("registrado_por") @db.Uuid
  fechaRegistro        DateTime @default(now()) @map("fecha_registro")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  paciente    Paciente  @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  admision    Admision? @relation(fields: [admisionId], references: [id])
  registrador Usuario   @relation("GlucometriaRegistrador", fields: [registradoPor], references: [id])

  @@map("glucometrias")
}

model BalanceLiquidos {
  id            String   @id @default(uuid())
  pacienteId    String   @map("paciente_id")
  admisionId    String   @map("admision_id")
  tipo          String
  via           String
  cantidad      Decimal  @db.Decimal(10, 2)
  fluido        String?
  observaciones String?
  registradoPor String   @map("registrado_por") @db.Uuid
  fechaRegistro DateTime @default(now()) @map("fecha_registro")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  paciente    Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  admision    Admision @relation(fields: [admisionId], references: [id])
  registrador Usuario  @relation("BalanceRegistrador", fields: [registradoPor], references: [id])

  @@map("balance_liquidos")
}

model Transfusion {
  id                String  @id @default(uuid())
  pacienteId        String  @map("paciente_id")
  admisionId        String  @map("admision_id")
  hemocomponente    String
  grupoSanguineo    String  @map("grupo_sanguineo")
  rh                String
  volumen           Decimal @db.Decimal(10, 2)
  velocidad         String?
  loteBolsa         String  @map("lote_bolsa")
  reaccionAdversa   Boolean @default(false) @map("reaccion_adversa")
  observaciones     String?
  signosVitalesPre  Json?   @map("signos_vitales_pre")
  signosVitalesPost Json?   @map("signos_vitales_post")

  registradoPor String  @map("registrado_por") @db.Uuid
  verificadoPor String? @map("verificado_por") @db.Uuid

  fechaInicio DateTime  @default(now()) @map("fecha_inicio")
  fechaFin    DateTime? @map("fecha_fin")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  paciente    Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  admision    Admision @relation(fields: [admisionId], references: [id])
  registrador Usuario  @relation("TransfusionRegistrador", fields: [registradoPor], references: [id])
  verificador Usuario? @relation("TransfusionVerificador", fields: [verificadoPor], references: [id])

  @@map("transfusiones")
}

model PlantillaNotaEnfermeria {
  id          String   @id @default(uuid())
  nombre      String   @unique
  descripcion String?
  tipoNota    String   @map("tipo_nota")
  contenido   String
  creadoPor   String?  @map("creado_por") @db.Uuid
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  creador Usuario? @relation("PlantillaCreador", fields: [creadoPor], references: [id])

  @@map("plantillas_notas_enfermeria")
}

model RefreshToken {
  id              String   @id @default(uuid())
  token           String   @unique
  userId          String   @map("user_id") @db.Uuid
  expiresAt       DateTime @map("expires_at")
  createdAt       DateTime @default(now()) @map("created_at")
  revoked         Boolean  @default(false)
  replacedByToken String?  @map("replaced_by_token")

  user Usuario @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("refresh_tokens")
}

// ==========================================
// MÃDULO DE CALIDAD
// ==========================================

model EstandarHabilitacion {
  id               String                       @id @default(uuid())
  tipo             String
  codigo           String                       @unique
  nombre           String
  descripcion      String
  normativaRef     String?
  servicioAplica   String[]
  criterios        CriterioHabilitacion[]
  autoevaluaciones AutoevaluacionHabilitacion[]
  createdAt        DateTime                     @default(now())
  updatedAt        DateTime                     @updatedAt

  @@map("estandares_habilitacion")
}

model CriterioHabilitacion {
  id               String               @id @default(uuid())
  estandarId       String
  codigo           String
  descripcion      String
  modoVerificacion String?
  estandar         EstandarHabilitacion @relation(fields: [estandarId], references: [id])
  evaluaciones     EvaluacionCriterio[]
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt

  @@map("criterios_habilitacion")
}

model AutoevaluacionHabilitacion {
  id                     String               @id @default(uuid())
  estandarId             String
  fechaEvaluacion        DateTime
  evaluadorId            String               @db.Uuid
  porcentajeCumplimiento Float
  observaciones          String?
  estado                 String
  fechaCierre            DateTime?
  estandar               EstandarHabilitacion @relation(fields: [estandarId], references: [id])
  evaluador              Usuario              @relation(fields: [evaluadorId], references: [id])
  criteriosEvaluados     EvaluacionCriterio[]
  planesAccion           PlanAccionCalidad[]
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt

  @@map("autoevaluaciones_habilitacion")
}

model EvaluacionCriterio {
  id               String                     @id @default(uuid())
  autoevaluacionId String
  criterioId       String
  cumplimiento     String
  observacion      String?
  fechaEvaluacion  DateTime
  autoevaluacion   AutoevaluacionHabilitacion @relation(fields: [autoevaluacionId], references: [id])
  criterio         CriterioHabilitacion       @relation(fields: [criterioId], references: [id])
  createdAt        DateTime                   @default(now())

  @@map("evaluaciones_criterios")
}

model VisitaVerificacion {
  id                 String              @id @default(uuid())
  tipoVisita         String
  entidadVisitadora  String
  fechaVisita        DateTime
  fechaNotificacion  DateTime?
  actaNumero         String?
  hallazgos          Json?
  requierePlanMejora Boolean             @default(false)
  fechaLimitePlan    DateTime?
  estado             String
  observaciones      String?
  planesAccion       PlanAccionCalidad[]
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  @@map("visitas_verificacion")
}

// PAMEC

model EquipoPAMEC {
  id           String   @id @default(uuid())
  usuarioId    String   @db.Uuid
  rol          String
  fechaIngreso DateTime
  activo       Boolean  @default(true)
  usuario      Usuario  @relation(fields: [usuarioId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("equipo_pamec")
}

model ProcesoPAMEC {
  id               String              @id @default(uuid())
  nombre           String
  descripcion      String?
  areaResponsable  String?
  responsableId    String?             @db.Uuid
  calidadObservada Float?
  calidadEsperada  Float?
  brecha           Float?
  prioridad        Int?
  estado           String
  indicadores      IndicadorPAMEC[]
  auditorias       AuditoriaPAMEC[]
  planesAccion     PlanAccionCalidad[]
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt

  @@map("procesos_pamec")
}

model IndicadorPAMEC {
  id                 String              @id @default(uuid())
  procesoId          String
  codigo             String              @unique
  nombre             String
  objetivo           String?
  formulaCalculo     String?
  fuenteDatos        String?
  frecuenciaMedicion String?
  metaInstitucional  Float?
  unidadMedida       String?
  tendenciaEsperada  String?
  proceso            ProcesoPAMEC        @relation(fields: [procesoId], references: [id])
  mediciones         MedicionIndicador[]
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  @@map("indicadores_pamec")
}

model MedicionIndicador {
  id              String         @id @default(uuid())
  indicadorId     String
  periodo         String
  numerador       Float?
  denominador     Float?
  resultado       Float
  meta            Float?
  cumpleMeta      Boolean
  analisis        String?
  accionesTomadas String?
  registradoPor   String         @db.Uuid
  fechaRegistro   DateTime       @default(now())
  indicador       IndicadorPAMEC @relation(fields: [indicadorId], references: [id])
  registrador     Usuario        @relation(fields: [registradoPor], references: [id])
  createdAt       DateTime       @default(now())

  @@map("mediciones_indicador")
}

model AuditoriaPAMEC {
  id              String              @id @default(uuid())
  procesoId       String
  tipoAuditoria   String
  objetivo        String?
  alcance         String?
  auditorId       String              @db.Uuid
  fechaProgramada DateTime?
  fechaEjecucion  DateTime?
  estado          String
  conclusiones    String?
  proceso         ProcesoPAMEC        @relation(fields: [procesoId], references: [id])
  hallazgos       HallazgoAuditoria[]
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@map("auditorias_pamec")
}

model HallazgoAuditoria {
  id                String              @id @default(uuid())
  auditoriaId       String
  tipo              String
  descripcion       String
  criterioAuditoria String?
  requiereAccion    Boolean             @default(false)
  fechaLimiteAccion DateTime?
  estado            String
  auditoria         AuditoriaPAMEC      @relation(fields: [auditoriaId], references: [id])
  planesAccion      PlanAccionCalidad[]
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  @@map("hallazgos_auditoria")
}

// SEGURIDAD DEL PACIENTE

model EventoAdverso {
  id                 String              @id @default(uuid())
  pacienteId         String
  tipoEvento         String
  severidad          String?
  fechaEvento        DateTime
  horaEvento         String?
  servicioOcurrencia String?
  descripcionEvento  String
  reportadoPor       String              @db.Uuid
  fechaReporte       DateTime            @default(now())
  estado             String
  requiereAnalisis   Boolean             @default(false)
  paciente           Paciente            @relation(fields: [pacienteId], references: [id])
  reportador         Usuario             @relation(fields: [reportadoPor], references: [id])
  analisis           AnalisisCausaRaiz?
  planesAccion       PlanAccionCalidad[]
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  @@map("eventos_adversos")
}

model AnalisisCausaRaiz {
  id                  String        @id @default(uuid())
  eventoId            String        @unique
  metodoAnalisis      String
  fechaAnalisis       DateTime
  analistaId          String        @db.Uuid
  fallasActivas       Json?
  condicionesLatentes Json?
  causaRaizFinal      String?
  estado              String
  leccionesAprendidas String?
  evento              EventoAdverso @relation(fields: [eventoId], references: [id])
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt

  @@map("analisis_causa_raiz")
}

model RondaSeguridad {
  id              String              @id @default(uuid())
  servicioId      String?
  fechaProgramada DateTime?
  fechaEjecucion  DateTime?
  ejecutorId      String              @db.Uuid
  hallazgos       Json?
  estado          String
  observaciones   String?
  planesAccion    PlanAccionCalidad[]
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@map("rondas_seguridad")
}

model PracticaSegura {
  id                  String                     @id @default(uuid())
  codigo              String                     @unique
  nombre              String
  descripcion         String?
  categoria           String?
  checklistItems      Json?
  frecuenciaMonitoreo String?
  adherencias         AdherenciaPracticaSegura[]
  createdAt           DateTime                   @default(now())
  updatedAt           DateTime                   @updatedAt

  @@map("practicas_seguras")
}

model AdherenciaPracticaSegura {
  id               String         @id @default(uuid())
  practicaId       String
  fechaEvaluacion  DateTime
  evaluadorId      String         @db.Uuid
  servicioEvaluado String?
  cumplimiento     Float
  observaciones    String?
  practica         PracticaSegura @relation(fields: [practicaId], references: [id])
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  @@map("adherencias_practicas_seguras")
}

// INDICADORES SIC

model IndicadorSIC {
  id                    String        @id @default(uuid())
  codigo                String        @unique
  nombre                String
  dominio               String
  definicionOperacional String?
  formulaNumerador      String?
  formulaDenominador    String?
  unidadMedida          String?
  metaNacional          Float?
  fuenteDatos           String?
  periodicidadReporte   String?
  serviciosAplica       String[]
  mediciones            MedicionSIC[]
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt

  @@map("indicadores_sic")
}

model MedicionSIC {
  id                 String       @id @default(uuid())
  indicadorId        String
  periodo            String
  numerador          Float?
  denominador        Float?
  resultado          Float
  metaVigente        Float?
  cumpleMeta         Boolean
  semaforoEstado     String?
  analisis           String?
  reportadoSISPRO    Boolean      @default(false)
  fechaReporteSISPRO DateTime?
  registradoPor      String       @db.Uuid
  fechaRegistro      DateTime     @default(now())
  indicador          IndicadorSIC @relation(fields: [indicadorId], references: [id])
  createdAt          DateTime     @default(now())

  @@map("mediciones_sic")
}

// COMITÃS

model ComiteInstitucional {
  id            String             @id @default(uuid())
  codigo        String             @unique
  nombre        String
  normativaBase String?
  objetivo      String?
  periodicidad  String?
  integrantes   IntegranteComite[]
  reuniones     ReunionComite[]
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  @@map("comites_institucionales")
}

model IntegranteComite {
  id           String              @id @default(uuid())
  comiteId     String
  usuarioId    String              @db.Uuid
  rol          String
  fechaIngreso DateTime
  activo       Boolean             @default(true)
  comite       ComiteInstitucional @relation(fields: [comiteId], references: [id])
  usuario      Usuario             @relation(fields: [usuarioId], references: [id])
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt

  @@map("integrantes_comite")
}

model ReunionComite {
  id               String              @id @default(uuid())
  comiteId         String
  numeroActa       String?
  fechaProgramada  DateTime?
  fechaRealizacion DateTime?
  lugar            String?
  ordenDelDia      String[]
  temasDiscutidos  Json?
  decisiones       Json?
  estado           String
  comite           ComiteInstitucional @relation(fields: [comiteId], references: [id])
  compromisos      CompromisoComite[]
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt

  @@map("reuniones_comite")
}

model CompromisoComite {
  id            String        @id @default(uuid())
  reunionId     String
  descripcion   String
  responsableId String        @db.Uuid
  fechaLimite   DateTime?
  estado        String
  reunion       ReunionComite @relation(fields: [reunionId], references: [id])
  responsable   Usuario       @relation(fields: [responsableId], references: [id])
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("compromisos_comite")
}

// GESTIÃN DOCUMENTAL

model DocumentoCalidad {
  id                 String                      @id @default(uuid())
  codigo             String                      @unique
  nombre             String
  tipo               String
  version            String
  fechaElaboracion   DateTime
  elaboradoPor       String                      @db.Uuid
  estado             String
  archivoUrl         String?
  procesoRelacionado String?
  elaborador         Usuario                     @relation(fields: [elaboradoPor], references: [id])
  historialVersiones HistorialVersionDocumento[]
  socializaciones    SocializacionDocumento[]
  createdAt          DateTime                    @default(now())
  updatedAt          DateTime                    @updatedAt

  @@map("documentos_calidad")
}

model HistorialVersionDocumento {
  id            String           @id @default(uuid())
  documentoId   String
  version       String
  fechaCambio   DateTime         @default(now())
  cambios       String?
  responsableId String           @db.Uuid
  documento     DocumentoCalidad @relation(fields: [documentoId], references: [id])
  createdAt     DateTime         @default(now())

  @@map("historial_versiones_documento")
}

model SocializacionDocumento {
  id                 String           @id @default(uuid())
  documentoId        String
  fechaSocializacion DateTime
  metodologia        String?
  participantes      Json?
  realizadoPor       String           @db.Uuid
  documento          DocumentoCalidad @relation(fields: [documentoId], references: [id])
  createdAt          DateTime         @default(now())

  @@map("socializaciones_documento")
}

// PLANES DE ACCIÃN

model PlanAccionCalidad {
  id                  String    @id @default(uuid())
  codigo              String    @unique
  origen              String
  descripcionProblema String
  accionPropuesta     String
  tipoAccion          String
  responsableId       String    @db.Uuid
  fechaInicio         DateTime
  fechaLimite         DateTime?
  estado              String
  avancePorcentaje    Float     @default(0)

  autoevaluacionId String?
  visitaId         String?
  procesoId        String?
  hallazgoId       String?
  eventoId         String?
  rondaId          String?

  autoevaluacion AutoevaluacionHabilitacion? @relation(fields: [autoevaluacionId], references: [id])
  visita         VisitaVerificacion?         @relation(fields: [visitaId], references: [id])
  proceso        ProcesoPAMEC?               @relation(fields: [procesoId], references: [id])
  hallazgo       HallazgoAuditoria?          @relation(fields: [hallazgoId], references: [id])
  evento         EventoAdverso?              @relation(fields: [eventoId], references: [id])
  ronda          RondaSeguridad?             @relation(fields: [rondaId], references: [id])
  responsable    Usuario                     @relation(fields: [responsableId], references: [id])
  seguimientos   SeguimientoPlanAccion[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("planes_accion_calidad")
}

model SeguimientoPlanAccion {
  id               String            @id @default(uuid())
  planAccionId     String
  fechaSeguimiento DateTime          @default(now())
  avance           Float
  observaciones    String?
  responsableId    String            @db.Uuid
  planAccion       PlanAccionCalidad @relation(fields: [planAccionId], references: [id])
  createdAt        DateTime          @default(now())

  @@map("seguimientos_plan_accion")
}

model EvidenciaCalidad {
  id          String   @id @default(uuid())
  entidadId   String
  entidadTipo String
  nombre      String
  url         String
  subidoPor   String   @db.Uuid
  fechaSubida DateTime @default(now())

  @@map("evidencias_calidad")
}

// ACREDITACIÃN

model EstandarAcreditacion {
  id           String                   @id @default(uuid())
  grupo        String
  codigo       String                   @unique
  nombre       String
  descripcion  String
  criterios    Json?
  evaluaciones EvaluacionAcreditacion[]
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt

  @@map("estandares_acreditacion")
}

model EvaluacionAcreditacion {
  id                  String               @id @default(uuid())
  estandarId          String
  calificacion        Int
  fortalezas          String?
  oportunidadesMejora String?
  evaluadorId         String               @db.Uuid
  fechaEvaluacion     DateTime
  estandar            EstandarAcreditacion @relation(fields: [estandarId], references: [id])
  evaluador           Usuario              @relation(fields: [evaluadorId], references: [id])
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt

  @@map("evaluaciones_acreditacion")
}

// VIGILANCIA

model NotificacionSIVIGILA {
  id                   String   @id @default(uuid())
  pacienteId           String
  codigoEvento         String
  nombreEvento         String
  tipoNotificacion     String
  semanaEpidemiologica Int
  anioEpidemiologico   Int
  fechaNotificacion    DateTime
  clasificacionInicial String
  notificadoPor        String   @db.Uuid
  paciente             Paciente @relation(fields: [pacienteId], references: [id])
  notificador          Usuario  @relation(fields: [notificadoPor], references: [id])
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("notificaciones_sivigila")
}

model ReporteFarmacovigilancia {
  id                  String   @id @default(uuid())
  pacienteId          String
  tipoReporte         String
  fechaEvento         DateTime
  descripcionReaccion String
  gravedadReaccion    String
  reportadoPor        String   @db.Uuid
  reportadoINVIMA     Boolean  @default(false)
  paciente            Paciente @relation(fields: [pacienteId], references: [id])
  reportador          Usuario  @relation(fields: [reportadoPor], references: [id])
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@map("reportes_farmacovigilancia")
}

model ReporteTecnovigilancia {
  id                String   @id @default(uuid())
  pacienteId        String
  dispositivoMedico String
  fechaEvento       DateTime
  descripcionEvento String
  clasificacion     String
  reportadoPor      String   @db.Uuid
  reportadoINVIMA   Boolean  @default(false)
  paciente          Paciente @relation(fields: [pacienteId], references: [id])
  reportador        Usuario  @relation(fields: [reportadoPor], references: [id])
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("reportes_tecnovigilancia")
}

model FactorContributivo {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("factores_contributivos")
}

model CatalogoCups {
  id          String   @id @default(uuid())
  codigo      String   @unique
  descripcion String
  seccion     String?
  grupo       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("catalogo_cups")
}

// ==========================================
// MÃDULO DE IMAGENOLOGÃA
// ==========================================

model EstudioImagenologia {
  id                  String  @id @default(uuid())
  codigo              String? @unique
  pacienteId          String  @map("paciente_id")
  medicoSolicitanteId String  @map("medico_solicitante_id") @db.Uuid
  radiologoId         String? @map("radiologo_id") @db.Uuid
  ordenMedicaId       String? @map("orden_medica_id")

  tipoEstudio String                @map("tipo_estudio")
  zonaCuerpo  String                @map("zona_cuerpo")
  prioridad   PrioridadImagenologia @default(Normal)
  estado      EstadoImagenologia    @default(Pendiente)

  indicacionClinica String  @map("indicacion_clinica")
  observaciones     String?

  // Informe radiolÃ³gico
  hallazgos       String?
  conclusion      String?
  recomendaciones String?
  imagenesUrl     String? @map("imagenes_url")

  // Fechas
  fechaSolicitud   DateTime  @default(now()) @map("fecha_solicitud")
  fechaProgramada  DateTime? @map("fecha_programada")
  fechaRealizacion DateTime? @map("fecha_realizacion")
  fechaInforme     DateTime? @map("fecha_informe")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  paciente          Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  medicoSolicitante Usuario  @relation("MedicoSolicitante", fields: [medicoSolicitanteId], references: [id])
  radiologo         Usuario? @relation("RadiologoInformante", fields: [radiologoId], references: [id])

  @@map("estudios_imagenologia")
}

enum EstadoImagenologia {
  Pendiente
  Programado
  EnProceso
  Completado
  Cancelado
}

enum PrioridadImagenologia {
  Urgente
  Alta
  Normal
  Baja
}

// ==========================================
// PAGOS ONLINE - EPAYCO
// ==========================================

model PaymentSession {
  id              String   @id @default(uuid())
  citaId          String   @unique @map("cita_id")
  sessionId       String   @unique @map("session_id")
  amount          Decimal  @db.Decimal(10, 2)
  currency        String   @default("COP") @db.VarChar(3)
  status          String   @default("pending") @db.VarChar(20)
  epaycoRef       String?  @map("epayco_ref")
  epaycoTxId      String?  @map("epayco_tx_id")
  responseCode    String?  @map("response_code")
  responseMessage String?  @map("response_message")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  cita Cita @relation(fields: [citaId], references: [id], onDelete: Cascade)

  @@map("payment_sessions")
}

// =====================
// TIENDA / E-COMMERCE
// =====================

enum EstadoOrdenTienda {
  PendientePago
  Pagada
  Procesando
  Enviada
  Entregada
  Cancelada
  Reembolsada
}

model OrdenTienda {
  id     String @id @default(uuid())
  numero String @unique

  // Cliente (puede ser paciente existente o datos nuevos)
  pacienteId      String? @map("paciente_id")
  nombreCliente   String  @map("nombre_cliente")
  apellidoCliente String  @map("apellido_cliente")
  emailCliente    String  @map("email_cliente")
  telefonoCliente String  @map("telefono_cliente")
  tipoDocumento   String? @map("tipo_documento")
  documento       String?

  // DirecciÃ³n de envÃ­o
  direccionEnvio    String? @map("direccion_envio")
  ciudadEnvio       String? @map("ciudad_envio")
  departamentoEnvio String? @map("departamento_envio")
  codigoPostal      String? @map("codigo_postal")
  notasEnvio        String? @map("notas_envio")

  // Totales
  subtotal   Decimal @db.Decimal(10, 2)
  descuento  Decimal @default(0) @db.Decimal(10, 2)
  costoEnvio Decimal @default(0) @map("costo_envio") @db.Decimal(10, 2)
  impuestos  Decimal @default(0) @db.Decimal(10, 2)
  total      Decimal @db.Decimal(10, 2)

  // Estado y pago
  estado     EstadoOrdenTienda @default(PendientePago)
  metodoPago MetodoPago?       @map("metodo_pago")

  // Tracking
  fechaPago      DateTime? @map("fecha_pago")
  fechaEnvio     DateTime? @map("fecha_envio")
  fechaEntrega   DateTime? @map("fecha_entrega")
  numeroGuia     String?   @map("numero_guia")
  transportadora String?

  // Notas
  notas         String?
  notasInternas String? @map("notas_internas")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relaciones
  paciente       Paciente?             @relation(fields: [pacienteId], references: [id])
  items          OrdenTiendaItem[]
  paymentSession PaymentSessionTienda?

  @@map("ordenes_tienda")
}

model OrdenTiendaItem {
  id         String @id @default(uuid())
  ordenId    String @map("orden_id")
  productoId String @map("producto_id")

  // Snapshot del producto al momento de la compra
  nombreProducto String  @map("nombre_producto")
  skuProducto    String  @map("sku_producto")
  imagenProducto String? @map("imagen_producto")

  cantidad       Int
  precioUnitario Decimal @map("precio_unitario") @db.Decimal(10, 2)
  descuento      Decimal @default(0) @db.Decimal(10, 2)
  subtotal       Decimal @db.Decimal(10, 2)

  createdAt DateTime @default(now()) @map("created_at")

  orden    OrdenTienda @relation(fields: [ordenId], references: [id], onDelete: Cascade)
  producto Producto    @relation(fields: [productoId], references: [id])

  @@map("ordenes_tienda_items")
}

model PaymentSessionTienda {
  id              String   @id @default(uuid())
  ordenId         String   @unique @map("orden_id")
  sessionId       String   @unique @map("session_id")
  amount          Decimal  @db.Decimal(10, 2)
  currency        String   @default("COP") @db.VarChar(3)
  status          String   @default("pending") @db.VarChar(20)
  epaycoRef       String?  @map("epayco_ref")
  epaycoTxId      String?  @map("epayco_tx_id")
  responseCode    String?  @map("response_code")
  responseMessage String?  @map("response_message")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  orden OrdenTienda @relation(fields: [ordenId], references: [id], onDelete: Cascade)

  @@map("payment_sessions_tienda")
}

// =====================
// MIA PASS - FORMULARIOS DE CONTACTO
// =====================

enum EstadoFormularioMiaPass {
  Pendiente
  Contactado
  EnProceso
  Completado
  Cancelado
}

model FormularioMiaPass {
  id                String                  @id @default(uuid())
  nombreCompleto    String                  @map("nombre_completo")
  numeroDocumento   String                  @map("numero_documento")
  correoElectronico String                  @map("correo_electronico")
  celular           String
  cantidadPersonas  Int                     @map("cantidad_personas")
  valorTotal        Decimal                 @map("valor_total") @db.Decimal(10, 2)
  estado            EstadoFormularioMiaPass @default(Pendiente)
  notas             String?
  createdAt         DateTime                @default(now()) @map("created_at")
  updatedAt         DateTime                @updatedAt @map("updated_at")

  @@map("formularios_mia_pass")
}

// =====================
// TRABAJA CON NOSOTROS - CANDIDATOS DE TALENTO HUMANO
// =====================

enum TipoDocumentoCandidato {
  CC // CÃ©dula de CiudadanÃ­a
  CE // CÃ©dula de ExtranjerÃ­a
  PA // Pasaporte
  TI // Tarjeta de Identidad
}

enum GeneroCandidato {
  male
  female
  other
  prefer_not_to_say
}

enum EstadoCivilCandidato {
  single
  married
  common_law
  divorced
  widowed
}

enum ModalidadTrabajo {
  on_site
  remote
  hybrid
  indifferent
}

enum TipoContrato {
  full_time
  part_time
  hourly
  service_contract
  indifferent
}

enum NivelIdioma {
  basic
  intermediate
  advanced
  native
}

enum TurnoDisponible {
  morning
  afternoon
  night
  weekend
}

enum EstadoCandidato {
  Pendiente
  EnRevision
  Entrevista
  Seleccionado
  Rechazado
  Contratado
  Archivado
}

model CandidatoTalento {
  id String @id @default(uuid())

  // InformaciÃ³n Personal
  firstName      String                 @map("first_name") @db.VarChar(100)
  lastName       String                 @map("last_name") @db.VarChar(100)
  documentType   TipoDocumentoCandidato @map("document_type")
  documentNumber String                 @unique @map("document_number") @db.VarChar(50)
  birthDate      DateTime               @map("birth_date") @db.Date
  gender         GeneroCandidato
  maritalStatus  EstadoCivilCandidato   @map("marital_status")
  nationality    String                 @db.VarChar(100)

  // InformaciÃ³n de Contacto
  mobilePhone      String  @map("mobile_phone") @db.VarChar(20)
  landlinePhone    String? @map("landline_phone") @db.VarChar(20)
  email            String  @db.VarChar(255)
  alternativeEmail String? @map("alternative_email") @db.VarChar(255)
  residenceAddress String  @map("residence_address")
  city             String  @db.VarChar(100)
  department       String  @db.VarChar(100)
  country          String  @db.VarChar(100)

  // InformaciÃ³n Profesional
  profession                String  @db.VarChar(150)
  specialty                 String? @db.VarChar(150)
  subspecialty              String? @db.VarChar(150)
  professionalLicenseNumber String? @map("professional_license_number") @db.VarChar(100)
  medicalRegistryNumber     String? @map("medical_registry_number") @db.VarChar(100)
  educationInstitution      String  @map("education_institution") @db.VarChar(200)
  educationCountry          String  @map("education_country") @db.VarChar(100)
  graduationYear            Int     @map("graduation_year")

  // Experiencia Laboral
  yearsOfExperience     Int      @map("years_of_experience")
  previousExperience    String?  @map("previous_experience") @db.Text
  previousInstitutions  String[] @map("previous_institutions")
  currentPosition       String?  @map("current_position") @db.VarChar(150)
  currentInstitution    String?  @map("current_institution") @db.VarChar(200)
  currentlyEmployed     Boolean  @default(false) @map("currently_employed")
  immediateAvailability Boolean  @default(false) @map("immediate_availability")

  // InformaciÃ³n Adicional
  areasOfInterest       String[]          @map("areas_of_interest")
  preferredModality     ModalidadTrabajo? @map("preferred_modality")
  preferredContractType TipoContrato?     @map("preferred_contract_type")
  salaryExpectation     Decimal?          @map("salary_expectation") @db.Decimal(12, 2)
  scheduleAvailability  String?           @map("schedule_availability") @db.VarChar(500)
  availableShifts       TurnoDisponible[] @map("available_shifts")

  // Idiomas (JSON array)
  languages Json? @default("[]")

  // Referencias Profesionales (JSON array)
  references Json? @default("[]")

  // Detalles de la AplicaciÃ³n
  howDidYouHear            String? @map("how_did_you_hear") @db.VarChar(500)
  motivation               String? @db.Text
  professionalExpectations String? @map("professional_expectations") @db.Text
  willingToTravel          Boolean @default(false) @map("willing_to_travel")
  willingToRelocate        Boolean @default(false) @map("willing_to_relocate")
  hasOwnVehicle            Boolean @default(false) @map("has_own_vehicle")
  driverLicense            String? @map("driver_license") @db.VarChar(50)

  // Documentos adjuntos (IDs de medios)
  documentIds String[] @map("document_ids")

  // Estado de la solicitud
  estado        EstadoCandidato @default(Pendiente)
  notasInternas String?         @map("notas_internas") @db.Text
  fechaRevision DateTime?       @map("fecha_revision")
  revisadoPor   String?         @map("revisado_por") @db.Uuid

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Calidad 2.0 - RelaciÃ³n con Personal
  personal Personal?

  @@map("candidatos_talento")
}

// ==========================================
// CALIDAD 2.0 - ENUMS
// ==========================================

enum TipoCarpetaCalidad2 {
  INSCRIPCION
  PROCESOS
  CAPACIDAD
  PERSONAL
  PROCESOS_INFRAESTRUCTURA
}

enum TipoPersonal {
  MEDICO
  ENFERMERIA
  ADMINISTRATIVO
  ASISTENCIAL
  TECNICO
  OTRO
}

enum TipoContratoPersonal {
  INDEFINIDO
  FIJO
  OBRA_LABOR
  PRESTACION_SERVICIOS
  APRENDIZAJE
  OTRO
}

enum EstadoPersonal {
  ACTIVO
  INACTIVO
  RETIRADO
  SUSPENDIDO
}

enum TipoEntidadChecklist {
  PERSONAL
  INSCRIPCION
  PROCESOS
  CAPACIDAD
}

enum TipoAlertaCalidad2 {
  DOCUMENTO_VENCIDO
  DOCUMENTO_POR_VENCER
  CHECKLIST_INCOMPLETO
  CAPACITACION_PENDIENTE
}

enum EstadoAlertaCalidad2 {
  PENDIENTE
  ATENDIDA
  DESCARTADA
}

// ==========================================
// CAPACITACIONES - ENUMS
// ==========================================

enum EstadoCapacitacion {
  PROGRAMADA
  EN_CURSO
  COMPLETADA
  CANCELADA
}

enum TipoReunion {
  COMITE
  AUDITORIA
  REUNION_INTERNA
  CAPACITACION
  REUNION_PERSONAL
  JUNTA_DIRECTIVA
  REUNION_CLIENTE_PROVEEDOR
  VISITA_ENTES_REGULADORES
  OTRO
}

enum TipoPregunta {
  OPCION_MULTIPLE
  VERDADERO_FALSO
  SELECCION_MULTIPLE
}

enum TipoEvaluacion {
  PRE_TEST
  POST_TEST
}

enum Periodicidad {
  UNICA
  SEMANAL
  QUINCENAL
  MENSUAL
  BIMESTRAL
  TRIMESTRAL
  SEMESTRAL
  ANUAL
}

// ==========================================
// CALIDAD 2.0 - MODELOS
// ==========================================

model CarpetaCalidad2 {
  id          String              @id @default(uuid())
  nombre      String
  descripcion String?
  tipo        TipoCarpetaCalidad2
  parentId    String?             @map("parent_id")
  orden       Int                 @default(0)
  activo      Boolean             @default(true)
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")

  parent         CarpetaCalidad2?    @relation("CarpetaHierarchy", fields: [parentId], references: [id])
  children       CarpetaCalidad2[]   @relation("CarpetaHierarchy")
  documentos     DocumentoCalidad2[]
  capacitaciones Capacitacion[]
  documentosLegalesInfraestructura DocumentoLegalInfraestructura[] @relation("CarpetaInfraestructuraDocumentos")

  @@map("carpetas_calidad2")
}

model DocumentoCalidad2 {
  id            String   @id @default(uuid())
  carpetaId     String?  @map("carpeta_id")
  nombre        String
  descripcion   String?
  archivoUrl    String   @map("archivo_url")
  archivoNombre String   @map("archivo_nombre")
  archivoTipo   String   @map("archivo_tipo")
  archivoTamano Int      @map("archivo_tamano")
  subidoPor     String   @map("subido_por") @db.Uuid
  activo        Boolean  @default(true)
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  carpeta CarpetaCalidad2? @relation(fields: [carpetaId], references: [id])
  usuario Usuario          @relation("DocumentoCalidad2Uploader", fields: [subidoPor], references: [id])

  @@map("documentos_calidad2")
}

model Personal {
  id                 String               @id @default(uuid())
  candidatoTalentoId String?              @unique @map("candidato_talento_id")
  usuarioId          String?              @unique @map("usuario_id") @db.Uuid
  tipoDocumento      String               @map("tipo_documento")
  numeroDocumento    String               @unique @map("numero_documento")
  nombreCompleto     String               @map("nombre_completo")
  cargo              String
  tipoPersonal       TipoPersonal         @map("tipo_personal")
  correo             String?
  telefono           String?
  tipoContrato       TipoContratoPersonal @map("tipo_contrato")
  estado             EstadoPersonal       @default(ACTIVO)
  fechaIngreso       DateTime?            @map("fecha_ingreso")
  fechaRetiro        DateTime?            @map("fecha_retiro")
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")

  // EspecializaciÃ³n profesional
  especialidad    String?
  subespecialidad String?

  // Licencias profesionales
  numeroProfesional  String?   @map("numero_profesional")
  rethusNumero       String?   @map("rethus_numero")
  rethusValidado     Boolean   @default(false) @map("rethus_validado")
  fechaRethus        DateTime? @map("fecha_rethus")
  tarjetaProfesional String?   @map("tarjeta_profesional")

  // Seguridad Social
  eps               String?
  arl               String?
  afp               String?
  fechaAfiliacionSS DateTime? @map("fecha_afiliacion_ss")

  // Contrato extendido
  salario          Decimal?  @db.Decimal(12, 2)
  jornada          String? // COMPLETA, MEDIA, PARCIAL
  horasSemana      Int?      @map("horas_semana")
  fechaFinContrato DateTime? @map("fecha_fin_contrato")

  // Vacunas
  carnetVacunasUrl        String?   @map("carnet_vacunas_url")
  fechaVencimientoVacunas DateTime? @map("fecha_vencimiento_vacunas")

  // PÃ³liza responsabilidad civil
  polizaRCUrl            String?   @map("poliza_rc_url")
  fechaVencimientoPoliza DateTime? @map("fecha_vencimiento_poliza")

  // Examen mÃ©dico ocupacional
  fechaExamenOcupacional DateTime? @map("fecha_examen_ocupacional")
  fechaVencimientoExamen DateTime? @map("fecha_vencimiento_examen")

  candidatoTalento    CandidatoTalento?         @relation(fields: [candidatoTalentoId], references: [id])
  usuario             Usuario?                  @relation("PersonalUsuario", fields: [usuarioId], references: [id])
  documentos          DocumentoPersonal[]
  checklistEstado     PersonalChecklistEstado[]
  asistenciasSesiones AsistenteSesion[]
  asistenciasActas    AsistenteActa[]
  alertas             AlertaTalentoHumano[]
  procesosInduccion   ProcesoInduccion[]

  // Formatos DinÃ¡micos
  formatosInstancias FormatoInstancia[]
  formatosAsistente  AsistenteFormato[]

  @@map("personal_calidad2")
}

model DocumentoPersonal {
  id               String    @id @default(uuid())
  personalId       String    @map("personal_id")
  checklistItemId  String?   @map("checklist_item_id")
  nombre           String
  archivoUrl       String    @map("archivo_url")
  archivoNombre    String    @map("archivo_nombre")
  archivoTipo      String    @map("archivo_tipo")
  archivoTamano    Int       @map("archivo_tamano")
  fechaEmision     DateTime? @map("fecha_emision")
  fechaVencimiento DateTime? @map("fecha_vencimiento")
  alertaGenerada   Boolean   @default(false) @map("alerta_generada")
  subidoPor        String    @map("subido_por") @db.Uuid
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")

  personal      Personal               @relation(fields: [personalId], references: [id], onDelete: Cascade)
  checklistItem ChecklistItemCalidad2? @relation(fields: [checklistItemId], references: [id])

  @@map("documentos_personal")
}

model ChecklistTemplateCalidad2 {
  id          String               @id @default(uuid())
  nombre      String
  descripcion String?
  tipoEntidad TipoEntidadChecklist
  categoria   String?
  activo      Boolean              @default(true)
  orden       Int                  @default(0)
  creadoPor   String?              @map("creado_por") @db.Uuid
  createdAt   DateTime             @default(now()) @map("created_at")
  updatedAt   DateTime             @updatedAt @map("updated_at")

  items ChecklistItemCalidad2[]

  @@map("checklist_templates_calidad2")
}

model ChecklistItemCalidad2 {
  id                       String   @id @default(uuid())
  templateId               String   @map("template_id")
  nombre                   String
  descripcion              String?
  categoria                String?
  esObligatorio            Boolean  @default(true) @map("es_obligatorio")
  requiereVencimiento      Boolean  @default(false) @map("requiere_vencimiento")
  diasAlertaVencimiento    Int?     @map("dias_alerta_vencimiento")
  permiteMultiplesArchivos Boolean  @default(false) @map("permite_multiples_archivos")
  orden                    Int      @default(0)
  activo                   Boolean  @default(true)
  createdAt                DateTime @default(now()) @map("created_at")
  updatedAt                DateTime @updatedAt @map("updated_at")

  template           ChecklistTemplateCalidad2 @relation(fields: [templateId], references: [id], onDelete: Cascade)
  documentosPersonal DocumentoPersonal[]
  estadosPersonal    PersonalChecklistEstado[]

  @@map("checklist_items_calidad2")
}

model PersonalChecklistEstado {
  id                String    @id @default(uuid())
  personalId        String    @map("personal_id")
  checklistItemId   String    @map("checklist_item_id")
  cumple            Boolean   @default(false)
  verificadoPor     String?   @map("verificado_por") @db.Uuid
  fechaVerificacion DateTime? @map("fecha_verificacion")
  observaciones     String?
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  personal      Personal              @relation(fields: [personalId], references: [id], onDelete: Cascade)
  checklistItem ChecklistItemCalidad2 @relation(fields: [checklistItemId], references: [id])

  @@unique([personalId, checklistItemId])
  @@map("personal_checklist_estado")
}

model CapacidadInstalada {
  id                      String   @id @default(uuid())
  servicio                String
  profesional             String
  ambientes               String?
  numeroEquiposAmbiente   Int      @map("numero_equipos_ambiente")
  duracionPromedioMinutos Int      @map("duracion_promedio_minutos")
  totalPacientesHora      Float?   @map("total_pacientes_hora")
  totalPacientesDia       Float?   @map("total_pacientes_dia")
  totalPacientesSemana    Float?   @map("total_pacientes_semana")
  totalPacientesMes       Float?   @map("total_pacientes_mes")
  activo                  Boolean  @default(true)
  creadoPor               String?  @map("creado_por") @db.Uuid
  createdAt               DateTime @default(now()) @map("created_at")
  updatedAt               DateTime @updatedAt @map("updated_at")

  @@map("capacidad_instalada")
}

model OfertaCapacidad {
  id                       String   @id @default(uuid())
  servicio                 String
  profesionalCargo         String   @map("profesional_cargo")
  numeroProfesionales      Int      @map("numero_profesionales")
  horasTrabajoSemana       Int      @map("horas_trabajo_semana")
  tiempoPorActividadMin    Int      @map("tiempo_por_actividad_min")
  pacientesAtendidosSemana Int?     @map("pacientes_atendidos_semana")
  pacientesHora            Float?   @map("pacientes_hora")
  totalPacientesMes        Float?   @map("total_pacientes_mes")
  activo                   Boolean  @default(true)
  creadoPor                String?  @map("creado_por") @db.Uuid
  createdAt                DateTime @default(now()) @map("created_at")
  updatedAt                DateTime @updatedAt @map("updated_at")

  @@map("oferta_capacidad")
}

model ResumenCapacidadMensual {
  id                                 String   @id @default(uuid())
  mes                                Int
  anio                               Int
  totalPacientesTalentoHumano        Int?     @map("total_pacientes_talento_humano")
  totalPacientesAtendidosMesAnterior Int?     @map("total_pacientes_atendidos_mes_anterior")
  observaciones                      String?
  createdAt                          DateTime @default(now()) @map("created_at")
  updatedAt                          DateTime @updatedAt @map("updated_at")

  @@unique([mes, anio])
  @@map("resumen_capacidad_mensual")
}

model AlertaCalidad2 {
  id               String               @id @default(uuid())
  tipo             TipoAlertaCalidad2
  entidadTipo      String               @map("entidad_tipo")
  entidadId        String               @map("entidad_id")
  titulo           String
  descripcion      String
  fechaVencimiento DateTime?            @map("fecha_vencimiento")
  estado           EstadoAlertaCalidad2 @default(PENDIENTE)
  atendidoPor      String?              @map("atendido_por") @db.Uuid
  fechaAtencion    DateTime?            @map("fecha_atencion")
  createdAt        DateTime             @default(now()) @map("created_at")
  updatedAt        DateTime             @updatedAt @map("updated_at")

  @@index([entidadTipo, entidadId])
  @@map("alertas_calidad2")
}

// ==========================================
// CAPACITACIONES - MODELOS
// ==========================================

model CategoriaCapacitacion {
  id          String   @id @default(uuid())
  nombre      String   @unique
  descripcion String?
  color       String?
  orden       Int      @default(0)
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  capacitaciones Capacitacion[]

  @@map("categorias_capacitacion")
}

model Capacitacion {
  id              String       @id @default(uuid())
  categoriaId     String       @map("categoria_id")
  tema            String
  actividad       String?
  responsableId   String?      @map("responsable_id") @db.Uuid
  orientadoA      String?      @map("orientado_a")
  duracionMinutos Int?         @map("duracion_minutos")
  periodicidad    Periodicidad @default(UNICA)
  anio            Int

  programadoEne Boolean @default(false) @map("programado_ene")
  programadoFeb Boolean @default(false) @map("programado_feb")
  programadoMar Boolean @default(false) @map("programado_mar")
  programadoAbr Boolean @default(false) @map("programado_abr")
  programadoMay Boolean @default(false) @map("programado_may")
  programadoJun Boolean @default(false) @map("programado_jun")
  programadoJul Boolean @default(false) @map("programado_jul")
  programadoAgo Boolean @default(false) @map("programado_ago")
  programadoSep Boolean @default(false) @map("programado_sep")
  programadoOct Boolean @default(false) @map("programado_oct")
  programadoNov Boolean @default(false) @map("programado_nov")
  programadoDic Boolean @default(false) @map("programado_dic")

  carpetaMaterialId String? @map("carpeta_material_id")

  estado    EstadoCapacitacion @default(PROGRAMADA)
  activo    Boolean            @default(true)
  creadoPor String?            @map("creado_por") @db.Uuid
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @updatedAt @map("updated_at")

  categoria       CategoriaCapacitacion @relation(fields: [categoriaId], references: [id])
  responsable     Usuario?              @relation("CapacitacionResponsable", fields: [responsableId], references: [id])
  carpetaMaterial CarpetaCalidad2?      @relation(fields: [carpetaMaterialId], references: [id])
  sesiones        SesionCapacitacion[]
  evaluaciones    EvaluacionTemplate[]

  @@map("capacitaciones")
}

model SesionCapacitacion {
  id              String             @id @default(uuid())
  capacitacionId  String             @map("capacitacion_id")
  fechaProgramada DateTime           @map("fecha_programada")
  fechaEjecutada  DateTime?          @map("fecha_ejecutada")
  horaInicio      String?            @map("hora_inicio")
  horaFin         String?            @map("hora_fin")
  lugar           String?
  convocados      Int                @default(0)
  estado          EstadoCapacitacion @default(PROGRAMADA)
  observaciones   String?

  actaId String? @unique @map("acta_id")

  creadoPor String?  @map("creado_por") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  capacitacion         Capacitacion          @relation(fields: [capacitacionId], references: [id], onDelete: Cascade)
  acta                 ActaReunion?          @relation(fields: [actaId], references: [id])
  asistentes           AsistenteSesion[]
  respuestasEvaluacion RespuestaEvaluacion[]

  @@map("sesiones_capacitacion")
}

model AsistenteSesion {
  id             String   @id @default(uuid())
  sesionId       String   @map("sesion_id")
  personalId     String?  @map("personal_id")
  nombreCompleto String   @map("nombre_completo")
  cargo          String?
  firmaUrl       String?  @map("firma_url")
  asistio        Boolean  @default(false)
  createdAt      DateTime @default(now()) @map("created_at")

  sesion   SesionCapacitacion @relation(fields: [sesionId], references: [id], onDelete: Cascade)
  personal Personal?          @relation(fields: [personalId], references: [id])

  @@unique([sesionId, personalId])
  @@map("asistentes_sesion")
}

// ==========================================
// EVALUACIONES TIPO KAHOOT
// ==========================================

model EvaluacionTemplate {
  id                 String         @id @default(uuid())
  capacitacionId     String         @map("capacitacion_id")
  tipo               TipoEvaluacion
  nombre             String
  descripcion        String?
  tiempoLimiteMin    Int?           @map("tiempo_limite_min")
  puntajePorPregunta Int            @default(1) @map("puntaje_por_pregunta")
  activo             Boolean        @default(true)
  creadoPor          String?        @map("creado_por") @db.Uuid
  createdAt          DateTime       @default(now()) @map("created_at")
  updatedAt          DateTime       @updatedAt @map("updated_at")

  capacitacion Capacitacion         @relation(fields: [capacitacionId], references: [id], onDelete: Cascade)
  preguntas    PreguntaEvaluacion[]

  @@map("evaluaciones_template")
}

model PreguntaEvaluacion {
  id             String       @id @default(uuid())
  evaluacionId   String       @map("evaluacion_id")
  texto          String
  tipo           TipoPregunta @default(OPCION_MULTIPLE)
  orden          Int          @default(0)
  tiempoSegundos Int?         @map("tiempo_segundos")
  imagenUrl      String?      @map("imagen_url")
  activo         Boolean      @default(true)
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")

  evaluacion EvaluacionTemplate    @relation(fields: [evaluacionId], references: [id], onDelete: Cascade)
  opciones   OpcionPregunta[]
  respuestas RespuestaEvaluacion[]

  @@map("preguntas_evaluacion")
}

model OpcionPregunta {
  id         String   @id @default(uuid())
  preguntaId String   @map("pregunta_id")
  texto      String
  esCorrecta Boolean  @default(false) @map("es_correcta")
  orden      Int      @default(0)
  createdAt  DateTime @default(now()) @map("created_at")

  pregunta PreguntaEvaluacion @relation(fields: [preguntaId], references: [id], onDelete: Cascade)

  @@map("opciones_pregunta")
}

model RespuestaEvaluacion {
  id                    String   @id @default(uuid())
  sesionId              String   @map("sesion_id")
  preguntaId            String   @map("pregunta_id")
  participanteId        String?  @map("participante_id")
  nombreParticipante    String   @map("nombre_participante")
  opcionesSeleccionadas String[] @map("opciones_seleccionadas")
  esCorrecta            Boolean  @default(false) @map("es_correcta")
  tiempoRespuestaMs     Int?     @map("tiempo_respuesta_ms")
  puntaje               Int      @default(0)
  createdAt             DateTime @default(now()) @map("created_at")

  sesion   SesionCapacitacion @relation(fields: [sesionId], references: [id], onDelete: Cascade)
  pregunta PreguntaEvaluacion @relation(fields: [preguntaId], references: [id])

  @@map("respuestas_evaluacion")
}

// ==========================================
// ACTAS DE REUNIÃN/CAPACITACIÃN
// ==========================================

model ActaReunion {
  id           String        @id @default(uuid())
  numero       Int           @unique
  tiposReunion TipoReunion[]
  tipoOtro     String?       @map("tipo_otro")
  objetivo     String
  fecha        DateTime
  horaInicio   String        @map("hora_inicio")
  horaFin      String        @map("hora_fin")
  lugar        String

  temasTratar           String[] @map("temas_tratar")
  compromisosAnteriores Json?    @map("compromisos_anteriores")
  desarrolloReunion     String?  @map("desarrollo_reunion") @db.Text
  analisisEvaluacion    Json?    @map("analisis_evaluacion")
  informeAdherencia     String?  @map("informe_adherencia") @db.Text
  compromisosSiguientes Json?    @map("compromisos_siguientes")

  creadoPor String?  @map("creado_por") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sesion     SesionCapacitacion?
  asistentes AsistenteActa[]

  @@map("actas_reunion")
}

model AsistenteActa {
  id             String   @id @default(uuid())
  actaId         String   @map("acta_id")
  personalId     String?  @map("personal_id")
  nombreCompleto String   @map("nombre_completo")
  cargo          String?
  firmaUrl       String?  @map("firma_url")
  createdAt      DateTime @default(now()) @map("created_at")

  acta     ActaReunion @relation(fields: [actaId], references: [id], onDelete: Cascade)
  personal Personal?   @relation(fields: [personalId], references: [id])

  @@map("asistentes_acta")
}

// ==========================================
// MANUALES DE FUNCIONES - CALIDAD 2.0
// ==========================================

enum NivelCargo {
  DIRECTIVO
  PROFESIONAL
  TECNICO
  OPERATIVO
}

enum EstadoManual {
  BORRADOR
  VIGENTE
  OBSOLETO
}

enum TipoConocimiento {
  CIENTIFICO
  TECNICO
  ADMINISTRATIVO
  LEGAL
}

enum TipoResponsabilidad {
  RESPONSABILIDAD
  AUTORIDAD
}

enum TipoCompetencia {
  COMUN
  COMPORTAMENTAL
}

enum NivelCompetencia {
  BASICO
  INTERMEDIO
  AVANZADO
}

model ManualFunciones {
  id     String @id @default(uuid())
  codigo String @unique // MF-END-001

  // I. IDENTIFICACIÃN
  denominacionCargo  String     @map("denominacion_cargo")
  dependencia        String?
  cargoJefeInmediato String?    @map("cargo_jefe_inmediato")
  area               String?
  supervisorDirecto  String?    @map("supervisor_directo")
  nivel              NivelCargo @default(PROFESIONAL)

  // II. PROPÃSITO PRINCIPAL
  propositoPrincipal String @map("proposito_principal") @db.Text

  // Estado y versiÃ³n
  version         Int          @default(1)
  estado          EstadoManual @default(BORRADOR)
  fechaAprobacion DateTime?    @map("fecha_aprobacion")
  aprobadoPor     String?      @map("aprobado_por") @db.Uuid

  creadoPor String?  @map("creado_por") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relaciones
  funciones            FuncionEsencial[]
  contribuciones       ContribucionIndividual[]
  conocimientos        ConocimientoBasico[]
  requisitos           RequisitosCargo?
  responsabilidadesSGC ResponsabilidadSGC[]
  competencias         CompetenciaCargo[]

  @@map("manuales_funciones")
}

model FuncionEsencial {
  id          String   @id @default(uuid())
  manualId    String   @map("manual_id")
  numero      Int
  descripcion String   @db.Text
  createdAt   DateTime @default(now()) @map("created_at")

  manual ManualFunciones @relation(fields: [manualId], references: [id], onDelete: Cascade)

  @@map("funciones_esenciales")
}

model ContribucionIndividual {
  id          String   @id @default(uuid())
  manualId    String   @map("manual_id")
  descripcion String   @db.Text
  orden       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")

  manual ManualFunciones @relation(fields: [manualId], references: [id], onDelete: Cascade)

  @@map("contribuciones_individuales")
}

model ConocimientoBasico {
  id          String           @id @default(uuid())
  manualId    String           @map("manual_id")
  tipo        TipoConocimiento
  descripcion String           @db.Text
  orden       Int              @default(0)
  createdAt   DateTime         @default(now()) @map("created_at")

  manual ManualFunciones @relation(fields: [manualId], references: [id], onDelete: Cascade)

  @@map("conocimientos_basicos")
}

model RequisitosCargo {
  id                 String   @id @default(uuid())
  manualId           String   @unique @map("manual_id")
  formacionAcademica String   @map("formacion_academica") @db.Text // TÃ­tulo + Postgrado
  experienciaAnios   Int      @map("experiencia_anios")
  experienciaTipo    String   @map("experiencia_tipo") @db.Text
  certificaciones    Json? // Array de certificaciones requeridas
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  manual ManualFunciones @relation(fields: [manualId], references: [id], onDelete: Cascade)

  @@map("requisitos_cargo")
}

model ResponsabilidadSGC {
  id          String              @id @default(uuid())
  manualId    String              @map("manual_id")
  tipo        TipoResponsabilidad
  descripcion String              @db.Text
  orden       Int                 @default(0)
  createdAt   DateTime            @default(now()) @map("created_at")

  manual ManualFunciones @relation(fields: [manualId], references: [id], onDelete: Cascade)

  @@map("responsabilidades_sgc")
}

model CompetenciaCargo {
  id        String            @id @default(uuid())
  manualId  String            @map("manual_id")
  tipo      TipoCompetencia
  nombre    String
  nivel     NivelCompetencia?
  orden     Int               @default(0)
  createdAt DateTime          @default(now()) @map("created_at")

  manual ManualFunciones @relation(fields: [manualId], references: [id], onDelete: Cascade)

  @@map("competencias_cargo")
}

// ==========================================
// ALERTAS TALENTO HUMANO
// ==========================================

enum TipoAlertaTH {
  VACUNAS
  POLIZA_RC
  RETHUS
  CONTRATO
  EXAMEN_OCUPACIONAL
  CAPACITACION
  DOCUMENTO
  INDUCCION
}

enum PrioridadAlerta {
  ALTA
  MEDIA
  BAJA
}

model AlertaTalentoHumano {
  id               String          @id @default(uuid())
  tipo             TipoAlertaTH
  personalId       String?         @map("personal_id")
  referencia       String? // ID del objeto relacionado
  mensaje          String
  fechaVence       DateTime        @map("fecha_vence")
  diasAnticipacion Int             @default(30) @map("dias_anticipacion")
  prioridad        PrioridadAlerta @default(MEDIA)
  atendida         Boolean         @default(false)
  fechaAtendida    DateTime?       @map("fecha_atendida")
  atendidaPor      String?         @map("atendida_por") @db.Uuid
  createdAt        DateTime        @default(now()) @map("created_at")

  personal Personal? @relation(fields: [personalId], references: [id], onDelete: Cascade)

  @@map("alertas_talento_humano")
}

// ==========================================
// PROCESOS DE INDUCCIÃN/REINDUCCIÃN
// ==========================================

enum TipoInduccion {
  INDUCCION
  REINDUCCION
}

enum EstadoInduccion {
  PROGRAMADO
  EN_PROCESO
  COMPLETADO
  CANCELADO
}

enum FaseInduccionTipo {
  GENERAL
  ESPECIFICA
  EVALUATIVA
}

model ProcesoInduccion {
  id            String          @id @default(uuid())
  personalId    String          @map("personal_id")
  tipo          TipoInduccion
  fechaInicio   DateTime        @map("fecha_inicio")
  fechaFin      DateTime?       @map("fecha_fin")
  estado        EstadoInduccion @default(PROGRAMADO)
  observaciones String?         @db.Text
  creadoPor     String?         @map("creado_por") @db.Uuid
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")

  personal   Personal             @relation(fields: [personalId], references: [id], onDelete: Cascade)
  fases      FaseInduccion[]
  evaluacion EvaluacionInduccion?

  @@map("procesos_induccion")
}

model FaseInduccion {
  id              String            @id @default(uuid())
  procesoId       String            @map("proceso_id")
  fase            FaseInduccionTipo
  tema            String
  descripcion     String?           @db.Text
  responsable     String?
  fechaProgramada DateTime?         @map("fecha_programada")
  fechaCompletado DateTime?         @map("fecha_completado")
  completado      Boolean           @default(false)
  observaciones   String?
  orden           Int               @default(0)
  createdAt       DateTime          @default(now()) @map("created_at")

  proceso ProcesoInduccion @relation(fields: [procesoId], references: [id], onDelete: Cascade)

  @@map("fases_induccion")
}

model EvaluacionInduccion {
  id              String    @id @default(uuid())
  procesoId       String    @unique @map("proceso_id")
  fechaEvaluacion DateTime? @map("fecha_evaluacion")
  aprobado        Boolean?
  puntaje         Int?
  comentarios     String?   @db.Text
  respuestas      Json? // Array de respuestas del cuestionario
  evaluadoPor     String?   @map("evaluado_por") @db.Uuid
  createdAt       DateTime  @default(now()) @map("created_at")

  proceso ProcesoInduccion @relation(fields: [procesoId], references: [id], onDelete: Cascade)

  @@map("evaluaciones_induccion")
}

// ==========================================
// CERTIFICADOS DE CAPACITACIÃN
// ==========================================

model CertificadoCapacitacion {
  id                 String   @id @default(uuid())
  numero             String   @unique // CERT-2025-0001
  sesionId           String   @map("sesion_id")
  personalId         String   @map("personal_id")
  nombreParticipante String   @map("nombre_participante")
  cedulaParticipante String   @map("cedula_participante")
  temaCapacitacion   String   @map("tema_capacitacion")
  fechaCapacitacion  DateTime @map("fecha_capacitacion")
  duracionHoras      Int      @map("duracion_horas")
  instructor         String?
  puntajeEvaluacion  Int?     @map("puntaje_evaluacion")
  codigoVerificacion String   @unique @map("codigo_verificacion") // Para QR
  fechaEmision       DateTime @default(now()) @map("fecha_emision")
  emitidoPor         String?  @map("emitido_por") @db.Uuid
  createdAt          DateTime @default(now()) @map("created_at")

  @@map("certificados_capacitacion")
}

// ==========================================
// FORMATOS DINÃMICOS (TEMPLATES + INSTANCIAS)
// ==========================================

enum TipoCampoFormato {
  TEXTO_CORTO
  TEXTO_LARGO
  TEXTO_ENRIQUECIDO
  NUMERO
  FECHA
  FECHA_HORA
  CHECKBOX
  CHECKBOX_GRUPO // C/NC/NA
  SELECT
  SELECT_MULTIPLE
  RADIO
  FIRMA
  ARCHIVO
  TABLA_DINAMICA
  CALCULO
  SECCION
  ENCABEZADO_DATOS
}

enum EstadoFormatoInstancia {
  BORRADOR
  EN_PROCESO
  COMPLETADO
  VENCIDO
  CANCELADO
}

enum TipoAlertaFormato {
  VENCIMIENTO_PROXIMO
  VENCIDO
  INCUMPLIMIENTO
  PENDIENTE_FIRMA
  PENDIENTE_REVISION
}

// Template de formato (diseÃ±o del formulario)
model FormatoTemplate {
  id                 String   @id @default(uuid())
  codigo             String   @unique
  nombre             String
  descripcion        String?
  categoria          String?
  version            Int      @default(1)
  requiereFirmas     Boolean  @default(false) @map("requiere_firmas")
  requiereAsistentes Boolean  @default(false) @map("requiere_asistentes")
  tieneVencimiento   Boolean  @default(false) @map("tiene_vencimiento")
  diasVigencia       Int?     @map("dias_vigencia")
  activo             Boolean  @default(true)
  creadoPor          String?  @map("creado_por") @db.Uuid
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  campos     CampoFormato[]
  secciones  SeccionFormato[]
  instancias FormatoInstancia[]

  @@map("formato_templates")
}

// Secciones del formato (agrupaciÃ³n visual)
model SeccionFormato {
  id          String  @id @default(uuid())
  templateId  String  @map("template_id")
  nombre      String
  descripcion String?
  orden       Int     @default(0)
  colapsable  Boolean @default(false)

  template FormatoTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  campos   CampoFormato[]

  @@map("formato_secciones")
}

// Campos/Items del template
model CampoFormato {
  id                    String           @id @default(uuid())
  templateId            String           @map("template_id")
  seccionId             String?          @map("seccion_id")
  nombre                String
  clave                 String
  tipo                  TipoCampoFormato
  descripcion           String?
  placeholder           String?
  esRequerido           Boolean          @default(false) @map("es_requerido")
  esObligatorio         Boolean          @default(false) @map("es_obligatorio")
  configuracion         Json?
  tieneVencimiento      Boolean          @default(false) @map("tiene_vencimiento")
  diasAlertaVencimiento Int?             @map("dias_alerta_vencimiento")
  orden                 Int              @default(0)
  anchoColumnas         Int              @default(12) @map("ancho_columnas")
  activo                Boolean          @default(true)
  createdAt             DateTime         @default(now()) @map("created_at")
  updatedAt             DateTime         @updatedAt @map("updated_at")

  template   FormatoTemplate  @relation(fields: [templateId], references: [id], onDelete: Cascade)
  seccion    SeccionFormato?  @relation(fields: [seccionId], references: [id])
  respuestas RespuestaCampo[]

  @@unique([templateId, clave])
  @@map("formato_campos")
}

// Instancia de un formato (documento llenado)
model FormatoInstancia {
  id               String                 @id @default(uuid())
  templateId       String                 @map("template_id")
  numero           Int
  personalId       String?                @map("personal_id")
  estado           EstadoFormatoInstancia @default(BORRADOR)
  fechaCreacion    DateTime               @default(now()) @map("fecha_creacion")
  fechaCompletado  DateTime?              @map("fecha_completado")
  fechaVencimiento DateTime?              @map("fecha_vencimiento")
  titulo           String?
  observaciones    String?
  creadoPor        String?                @map("creado_por") @db.Uuid
  completadoPor    String?                @map("completado_por") @db.Uuid
  createdAt        DateTime               @default(now()) @map("created_at")
  updatedAt        DateTime               @updatedAt @map("updated_at")

  template         FormatoTemplate    @relation(fields: [templateId], references: [id])
  personal         Personal?          @relation(fields: [personalId], references: [id])
  respuestas       RespuestaCampo[]
  asistentes       AsistenteFormato[]
  firmas           FirmaFormato[]
  historial        HistorialFormato[]
  alertas          AlertaFormato[]
  archivosAdjuntos ArchivoFormato[]

  @@unique([templateId, numero])
  @@map("formato_instancias")
}

// Respuestas a los campos
model RespuestaCampo {
  id               String    @id @default(uuid())
  instanciaId      String    @map("instancia_id")
  campoId          String    @map("campo_id")
  valorTexto       String?   @map("valor_texto") @db.Text
  valorNumero      Float?    @map("valor_numero")
  valorFecha       DateTime? @map("valor_fecha")
  valorBoolean     Boolean?  @map("valor_boolean")
  valorJson        Json?     @map("valor_json")
  valorArchivo     String?   @map("valor_archivo")
  cumple           Boolean?
  noAplica         Boolean?  @map("no_aplica")
  observaciones    String?
  fechaVencimiento DateTime? @map("fecha_vencimiento")
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")

  instancia FormatoInstancia @relation(fields: [instanciaId], references: [id], onDelete: Cascade)
  campo     CampoFormato     @relation(fields: [campoId], references: [id])

  @@unique([instanciaId, campoId])
  @@map("formato_respuestas")
}

// Asistentes (para actas)
model AsistenteFormato {
  id             String   @id @default(uuid())
  instanciaId    String   @map("instancia_id")
  personalId     String?  @map("personal_id")
  nombreCompleto String   @map("nombre_completo")
  cargo          String?
  firmaUrl       String?  @map("firma_url")
  asistio        Boolean  @default(true)
  createdAt      DateTime @default(now()) @map("created_at")

  instancia FormatoInstancia @relation(fields: [instanciaId], references: [id], onDelete: Cascade)
  personal  Personal?        @relation(fields: [personalId], references: [id])

  @@map("formato_asistentes")
}

// Firmas del documento
model FirmaFormato {
  id             String    @id @default(uuid())
  instanciaId    String    @map("instancia_id")
  rol            String
  nombreCompleto String    @map("nombre_completo")
  cargo          String?
  firmaUrl       String?   @map("firma_url")
  fechaFirma     DateTime? @map("fecha_firma")
  createdAt      DateTime  @default(now()) @map("created_at")

  instancia FormatoInstancia @relation(fields: [instanciaId], references: [id], onDelete: Cascade)

  @@map("formato_firmas")
}

// Historial de cambios
model HistorialFormato {
  id           String   @id @default(uuid())
  instanciaId  String   @map("instancia_id")
  accion       String
  descripcion  String?
  cambios      Json?
  realizadoPor String?  @map("realizado_por") @db.Uuid
  createdAt    DateTime @default(now()) @map("created_at")

  instancia FormatoInstancia @relation(fields: [instanciaId], references: [id], onDelete: Cascade)

  @@map("formato_historial")
}

// Alertas de formatos
model AlertaFormato {
  id            String            @id @default(uuid())
  instanciaId   String            @map("instancia_id")
  campoId       String?           @map("campo_id")
  tipo          TipoAlertaFormato
  mensaje       String
  fechaAlerta   DateTime          @map("fecha_alerta")
  atendida      Boolean           @default(false)
  fechaAtendida DateTime?         @map("fecha_atendida")
  atendidaPor   String?           @map("atendida_por") @db.Uuid
  createdAt     DateTime          @default(now()) @map("created_at")

  instancia FormatoInstancia @relation(fields: [instanciaId], references: [id], onDelete: Cascade)

  @@map("formato_alertas")
}

// Archivos adjuntos
model ArchivoFormato {
  id            String   @id @default(uuid())
  instanciaId   String   @map("instancia_id")
  nombre        String
  archivoUrl    String   @map("archivo_url")
  archivoNombre String   @map("archivo_nombre")
  archivoTipo   String?  @map("archivo_tipo")
  archivoTamano Int?     @map("archivo_tamano")
  subidoPor     String?  @map("subido_por") @db.Uuid
  createdAt     DateTime @default(now()) @map("created_at")

  instancia FormatoInstancia @relation(fields: [instanciaId], references: [id], onDelete: Cascade)

  @@map("formato_archivos")
}

// ==========================================
// ANTECEDENTES MÃDICOS ESTRUCTURADOS
// ==========================================

model AntecedentePatologico {
  id                String    @id @default(uuid())
  pacienteId        String    @map("paciente_id")
  enfermedad        String
  fechaDiagnostico  DateTime? @map("fecha_diagnostico")
  codigoCIE10       String?   @map("codigo_cie10")
  descripcionCIE10  String?   @map("descripcion_cie10")
  enTratamiento     Boolean   @default(false) @map("en_tratamiento")
  tratamientoActual String?   @map("tratamiento_actual")
  observaciones     String?
  activo            Boolean   @default(true)
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("antecedentes_patologicos")
}

model AntecedenteQuirurgico {
  id              String    @id @default(uuid())
  pacienteId      String    @map("paciente_id")
  procedimiento   String
  codigoCUPS      String?   @map("codigo_cups")
  descripcionCUPS String?   @map("descripcion_cups")
  fecha           DateTime?
  hospital        String?
  cirujano        String?
  anestesia       String? // General, Local, Regional, etc.
  complicaciones  String?
  observaciones   String?
  activo          Boolean   @default(true)
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("antecedentes_quirurgicos")
}

model AntecedenteAlergico {
  id             String    @id @default(uuid())
  pacienteId     String    @map("paciente_id")
  tipoAlergia    String    @map("tipo_alergia") // Medicamento, Alimento, Ambiental, Contacto, Otro
  sustancia      String
  reaccion       String?
  severidad      String // Leve, Moderada, Severa, AnafilÃ¡ctica
  fechaDeteccion DateTime? @map("fecha_deteccion")
  confirmada     Boolean   @default(false)
  observaciones  String?
  activo         Boolean   @default(true)
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("antecedentes_alergicos")
}

model AntecedenteFamiliar {
  id                 String   @id @default(uuid())
  pacienteId         String   @map("paciente_id")
  parentesco         String // Padre, Madre, Hermano, Abuelo paterno, Abuelo materno, TÃ­o, etc.
  enfermedad         String
  codigoCIE10        String?  @map("codigo_cie10")
  vive               Boolean?
  edadFallecimiento  Int?     @map("edad_fallecimiento")
  causaFallecimiento String?  @map("causa_fallecimiento")
  observaciones      String?
  activo             Boolean  @default(true)
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("antecedentes_familiares")
}

model AntecedenteFarmacologico {
  id                String    @id @default(uuid())
  pacienteId        String    @map("paciente_id")
  medicamento       String
  principioActivo   String?   @map("principio_activo")
  dosis             String?
  frecuencia        String?
  viaAdministracion String?   @map("via_administracion")
  indicacion        String? // Para quÃ© lo toma
  fechaInicio       DateTime? @map("fecha_inicio")
  fechaFin          DateTime? @map("fecha_fin")
  activo            Boolean   @default(true) // Si actualmente lo toma
  prescritoPor      String?   @map("prescrito_por")
  observaciones     String?
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("antecedentes_farmacologicos")
}

model AntecedenteGinecoObstetrico {
  id         String @id @default(uuid())
  pacienteId String @unique @map("paciente_id")

  // MenstruaciÃ³n
  menarca              Int? // Edad de primera menstruaciÃ³n
  fum                  DateTime? // Fecha Ãltima MenstruaciÃ³n
  cicloMenstrual       String?   @map("ciclo_menstrual") // Regular, Irregular
  duracionCiclo        Int?      @map("duracion_ciclo") // DÃ­as
  duracionMenstruacion Int?      @map("duracion_menstruacion") // DÃ­as
  dismenorrea          Boolean? // Dolor menstrual

  // FÃ³rmula obstÃ©trica
  gestas         Int @default(0) // G - Embarazos totales
  partos         Int @default(0) // P - Partos vaginales
  cesareas       Int @default(0) // C - CesÃ¡reas
  abortos        Int @default(0) // A - Abortos (espontÃ¡neos + provocados)
  ectopicos      Int @default(0) // Embarazos ectÃ³picos
  nacidosVivos   Int @default(0) @map("nacidos_vivos")
  nacidosMuertos Int @default(0) @map("nacidos_muertos")
  hijosVivos     Int @default(0) @map("hijos_vivos")

  // PlanificaciÃ³n familiar
  metodoPlanificacion String?   @map("metodo_planificacion")
  fechaInicioMetodo   DateTime? @map("fecha_inicio_metodo")

  // CitologÃ­a y mamografÃ­a
  fechaUltimaCitologia      DateTime? @map("fecha_ultima_citologia")
  resultadoUltimaCitologia  String?   @map("resultado_ultima_citologia")
  fechaUltimaMamografia     DateTime? @map("fecha_ultima_mamografia")
  resultadoUltimaMamografia String?   @map("resultado_ultima_mamografia")

  // Menopausia
  menopausia      Boolean @default(false)
  edadMenopausia  Int?    @map("edad_menopausia")
  terapiaHormonal Boolean @default(false) @map("terapia_hormonal")

  observaciones String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("antecedentes_gineco_obstetricos")
}

// ==========================================
// INCAPACIDADES MÃDICAS
// ==========================================

model IncapacidadMedica {
  id         String  @id @default(uuid())
  codigo     String? @unique
  pacienteId String  @map("paciente_id")
  doctorId   String  @map("doctor_id") @db.Uuid
  citaId     String? @map("cita_id")

  tipoIncapacidad String   @map("tipo_incapacidad")
  fechaInicio     DateTime @map("fecha_inicio")
  fechaFin        DateTime @map("fecha_fin")
  diasIncapacidad Int      @map("dias_incapacidad")

  diagnosticoCIE10       String @map("diagnostico_cie10")
  descripcionDiagnostico String @map("descripcion_diagnostico")

  esProrrogada          Boolean @default(false) @map("es_prorrogada")
  incapacidadOriginalId String? @map("incapacidad_original_id")
  diasAcumulados        Int?    @map("dias_acumulados")

  conceptoRehabilitacion String? @map("concepto_rehabilitacion")
  justificacion          String?
  restricciones          String?
  recomendaciones        String?

  firmadoPor   String?   @map("firmado_por") @db.Uuid
  fechaFirma   DateTime? @map("fecha_firma")
  firmaDigital String?   @map("firma_digital")
  pdfUrl       String?   @map("pdf_url")

  estado    String   @default("Activa")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  paciente            Paciente            @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  doctor              Usuario             @relation("IncapacidadesDoctor", fields: [doctorId], references: [id])
  cita                Cita?               @relation(fields: [citaId], references: [id])
  incapacidadOriginal IncapacidadMedica?  @relation("IncapacidadProrroga", fields: [incapacidadOriginalId], references: [id])
  prorrogas           IncapacidadMedica[] @relation("IncapacidadProrroga")

  @@index([pacienteId])
  @@index([doctorId])
  @@map("incapacidades_medicas")
}

// ==========================================
// CERTIFICADOS MÃDICOS
// ==========================================

model CertificadoMedico {
  id         String  @id @default(uuid())
  codigo     String? @unique
  pacienteId String  @map("paciente_id")
  doctorId   String  @map("doctor_id") @db.Uuid
  citaId     String? @map("cita_id")

  tipoCertificado String  @map("tipo_certificado")
  titulo          String?
  contenido       String
  diagnostico     String?
  codigoCIE10     String? @map("codigo_cie10")

  destinatario  String?
  vigenciaDesde DateTime? @map("vigencia_desde")
  vigenciaHasta DateTime? @map("vigencia_hasta")

  firmadoPor   String?   @map("firmado_por") @db.Uuid
  fechaFirma   DateTime? @map("fecha_firma")
  firmaDigital String?   @map("firma_digital")
  pdfUrl       String?   @map("pdf_url")

  fechaEmision DateTime @default(now()) @map("fecha_emision")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  doctor   Usuario  @relation("CertificadosDoctor", fields: [doctorId], references: [id])
  cita     Cita?    @relation(fields: [citaId], references: [id])

  @@index([pacienteId])
  @@index([doctorId])
  @@map("certificados_medicos")
}

// ==========================================
// SEGUIMIENTO Y CONTROL
// ==========================================

model SeguimientoControl {
  id           String  @id @default(uuid())
  pacienteId   String  @map("paciente_id")
  doctorId     String  @map("doctor_id") @db.Uuid
  citaOrigenId String? @map("cita_origen_id")

  tipoSeguimiento String   @map("tipo_seguimiento")
  fechaSugerida   DateTime @map("fecha_sugerida")
  diasParaControl Int      @map("dias_para_control")
  motivo          String
  instrucciones   String?
  prioridad       String   @default("Normal")

  citaGeneradaId String? @map("cita_generada_id")

  estado          String    @default("Pendiente")
  fechaCompletado DateTime? @map("fecha_completado")
  notasCompletado String?   @map("notas_completado")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  paciente Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  doctor   Usuario  @relation("SeguimientosDoctor", fields: [doctorId], references: [id])

  @@index([pacienteId])
  @@index([doctorId])
  @@map("seguimientos_control")
}

// =====================================================
// ASISTENTE IA MÃDICO - Logging de conversaciones
// =====================================================

model AiConversationLog {
  id             String  @id @default(uuid())
  conversationId String  @map("conversation_id")
  userId         String  @map("user_id") @db.Uuid
  pacienteId     String? @map("paciente_id")
  citaId         String? @map("cita_id")

  requestType  String @map("request_type") // chat, diagnosis_suggestion, prescription_check, etc.
  messageCount Int    @default(1) @map("message_count")
  toolsUsed    Json   @default("[]") @map("tools_used") // Array de herramientas usadas
  tokensUsed   Int    @default(0) @map("tokens_used")

  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  user     Usuario   @relation("AiConversationUser", fields: [userId], references: [id])
  paciente Paciente? @relation("AiConversationPaciente", fields: [pacienteId], references: [id])
  cita     Cita?     @relation("AiConversationCita", fields: [citaId], references: [id])

  @@index([userId])
  @@index([pacienteId])
  @@index([citaId])
  @@index([conversationId])
  @@index([requestType])
  @@index([createdAt])
  @@map("ai_conversation_logs")
}

// =====================================================
// ANALIZADOR DE HCE EXTERNAS CON IA
// =====================================================

model DocumentoHCEExterno {
  id String @id @default(uuid())

  // Relaciones opcionales
  pacienteId String? @map("paciente_id")
  doctorId   String  @map("doctor_id") @db.Uuid

  // Metadatos del archivo
  nombreArchivo  String @map("nombre_archivo")
  nombreOriginal String @map("nombre_original")
  rutaArchivo    String @map("ruta_archivo")
  tamanoBytes    Int    @map("tamano_bytes")
  tipoMime       String @map("tipo_mime")

  // Contenido extraÃ­do
  textoExtraido String? @map("texto_extraido") @db.Text
  textoHash     String? @map("texto_hash")
  paginasTotal  Int     @default(1) @map("paginas_total")

  // AnÃ¡lisis IA
  analisisCompleto Json?   @map("analisis_completo")
  resumenEjecutivo String? @map("resumen_ejecutivo") @db.Text
  tokensUsados     Int     @default(0) @map("tokens_usados")

  // Estado
  estado       String  @default("Pendiente") // Pendiente, Procesando, Completado, Error
  errorMensaje String? @map("error_mensaje")

  // Timestamps
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  procesadoAt DateTime? @map("procesado_at")

  // Relations
  paciente       Paciente?          @relation("DocumentoHCEPaciente", fields: [pacienteId], references: [id])
  doctor         Usuario            @relation("DocumentoHCEDoctor", fields: [doctorId], references: [id])
  conversaciones ChatDocumentoHCE[]

  @@index([doctorId])
  @@index([pacienteId])
  @@index([estado])
  @@index([createdAt])
  @@map("documentos_hce_externos")
}

model ChatDocumentoHCE {
  id          String @id @default(uuid())
  documentoId String @map("documento_id")

  // Mensaje
  rol       String // 'user' | 'assistant'
  contenido String @db.Text

  // Metadata
  tokensUsados Int      @default(0) @map("tokens_usados")
  createdAt    DateTime @default(now()) @map("created_at")

  // Relations
  documento DocumentoHCEExterno @relation(fields: [documentoId], references: [id], onDelete: Cascade)

  @@index([documentoId])
  @@map("chat_documentos_hce")
}

// =====================================================
// MÃDULO DE TALENTO HUMANO (RRHH COMPLETO)
// =====================================================

// ============ ENUMS TALENTO HUMANO ============

enum THEstadoVacante {
  ABIERTA
  EN_PROCESO
  CERRADA
  CANCELADA
}

enum THEstadoCandidato {
  APLICADO
  EN_REVISION
  PRESELECCIONADO
  ENTREVISTA_PROGRAMADA
  ENTREVISTA_REALIZADA
  PRUEBAS_PENDIENTES
  PRUEBAS_COMPLETADAS
  SELECCIONADO
  OFERTA_ENVIADA
  OFERTA_ACEPTADA
  RECHAZADO
  RETIRADO
  CONTRATADO
}

enum THTipoEntrevista {
  TELEFONICA
  VIRTUAL
  PRESENCIAL
  TECNICA
  PSICOLOGICA
  FINAL
}

enum THEstadoEntrevista {
  PROGRAMADA
  CONFIRMADA
  EN_CURSO
  COMPLETADA
  CANCELADA
  NO_ASISTIO
}

enum THEstadoEmpleado {
  ACTIVO
  INACTIVO
  VACACIONES
  INCAPACIDAD
  LICENCIA
  SUSPENDIDO
  RETIRADO
}

enum THTipoEmpleado {
  MEDICO
  ENFERMERIA
  ADMINISTRATIVO
  ASISTENCIAL
  TECNICO
  DIRECTIVO
  OPERATIVO
  PRACTICANTE
}

enum THTipoContrato {
  INDEFINIDO
  FIJO
  OBRA_LABOR
  PRESTACION_SERVICIOS
  APRENDIZAJE
  TEMPORAL
}

enum THJornada {
  COMPLETA
  MEDIA
  POR_HORAS
  TURNOS
}

enum THEstadoContrato {
  ACTIVO
  TERMINADO
  SUSPENDIDO
  EN_RENOVACION
}

enum THTipoMovimiento {
  INGRESO
  ASCENSO
  DESCENSO
  TRASLADO
  CAMBIO_AREA
  CAMBIO_JORNADA
  AJUSTE_SALARIAL
  SUSPENSION
  REINTEGRO
  RETIRO_VOLUNTARIO
  DESPIDO
  PENSION
}

enum THEstadoNomina {
  ABIERTO
  EN_PROCESO
  CERRADO
  PAGADO
}

enum THTipoNovedadNomina {
  HORA_EXTRA
  COMISION
  BONIFICACION
  DESCUENTO
  PRESTAMO
  INCAPACIDAD
  LICENCIA
}

enum THEstadoAsistencia {
  PRESENTE
  AUSENTE
  TARDANZA
  PERMISO
  VACACIONES
  INCAPACIDAD
}

enum THTipoVacacion {
  ORDINARIAS
  COMPENSADAS
  ANTICIPADAS
}

enum THTipoPermiso {
  CALAMIDAD
  CITA_MEDICA
  MATERNIDAD
  PATERNIDAD
  LICENCIA_NO_REMUNERADA
  PERSONAL
  COMISION
  LUTO
  MATRIMONIO
  ESTUDIO
}

enum THEstadoSolicitud {
  PENDIENTE
  APROBADA
  RECHAZADA
  CANCELADA
}

enum THTipoPeriodoEval {
  ANUAL
  SEMESTRAL
  TRIMESTRAL
  PRUEBA
}

enum THEstadoPeriodoEval {
  CONFIGURACION
  ACTIVO
  EN_EVALUACION
  CERRADO
}

enum THTipoEvaluador {
  JEFE
  AUTO
  PAR
  SUBORDINADO
  CLIENTE
}

enum THEstadoEvaluacion {
  PENDIENTE
  EN_PROGRESO
  COMPLETADA
}

enum THEstadoObjetivo {
  EN_PROGRESO
  COMPLETADO
  NO_CUMPLIDO
  CANCELADO
}

enum THTipoFeedback {
  RECONOCIMIENTO
  MEJORA
  GENERAL
}

enum THModalidadCapacitacion {
  PRESENCIAL
  VIRTUAL
  MIXTA
  ELEARNING
}

enum THEstadoCapacitacion {
  PROGRAMADA
  EN_CURSO
  COMPLETADA
  CANCELADA
}

enum THEstadoAsistente {
  INSCRITO
  CONFIRMADO
  ASISTIO
  NO_ASISTIO
  CANCELADO
}

enum THTipoEncuesta {
  CLIMA
  SATISFACCION
  PULSO
  SALIDA
  PERSONALIZADA
}

// ============ CARGOS Y ESTRUCTURA ============

model THCargo {
  id              String   @id @default(uuid())
  codigo          String   @unique
  nombre          String
  descripcion     String?  @db.Text
  nivel           Int      @default(1)
  departamentoId  String?  @map("departamento_id") @db.Uuid
  cargoSuperiorId String?  @map("cargo_superior_id")
  funciones       String?  @db.Text
  requisitos      Json?
  salarioMinimo   Decimal? @map("salario_minimo")
  salarioMaximo   Decimal? @map("salario_maximo")
  competencias    String[]
  activo          Boolean  @default(true)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  cargoSuperior       THCargo?             @relation("JerarquiaCargos", fields: [cargoSuperiorId], references: [id])
  cargosSupervisados  THCargo[]            @relation("JerarquiaCargos")
  empleados           THEmpleado[]
  vacantes            THVacante[]
  SSTProfesiograma    SSTProfesiograma[]
  riesgosIPVR         SSTMatrizIPVRCargo[] // Riesgos asociados al cargo desde Matriz IPVR
  alertaDestinatarios AlertaDestinatario[] @relation("AlertaDestinatarioCargo")

  @@map("th_cargos")
}

// ============ RECLUTAMIENTO ============

model THVacante {
  id              String          @id @default(uuid())
  titulo          String
  departamentoId  String?         @map("departamento_id") @db.Uuid
  cargoId         String?         @map("cargo_id")
  descripcion     String          @db.Text
  requisitos      Json
  salarioMin      Decimal?        @map("salario_min")
  salarioMax      Decimal?        @map("salario_max")
  tipoContrato    THTipoContrato  @map("tipo_contrato")
  jornada         THJornada
  ubicacion       String?
  cantidadPuestos Int             @default(1) @map("cantidad_puestos")
  fechaApertura   DateTime        @map("fecha_apertura")
  fechaCierre     DateTime?       @map("fecha_cierre")
  estado          THEstadoVacante @default(ABIERTA)
  publicarExterno Boolean         @default(false) @map("publicar_externo")
  urlsPublicacion Json?           @map("urls_publicacion")
  createdBy       String          @map("created_by") @db.Uuid
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")

  cargo      THCargo?             @relation(fields: [cargoId], references: [id])
  candidatos THCandidatoVacante[]
  creador    Usuario              @relation("THVacanteCreador", fields: [createdBy], references: [id])

  @@index([estado])
  @@index([departamentoId])
  @@map("th_vacantes")
}

model THCandidato {
  id                   String    @id @default(uuid())
  tipoDocumento        String    @map("tipo_documento")
  documento            String
  nombre               String
  apellido             String
  fechaNacimiento      DateTime? @map("fecha_nacimiento")
  genero               String?
  estadoCivil          String?   @map("estado_civil")
  nacionalidad         String?
  email                String
  telefono             String
  direccion            String?
  ciudad               String?
  departamentoGeo      String?   @map("departamento_geo")
  profesion            String?
  nivelEducativo       String?   @map("nivel_educativo")
  institucionEducativa String?   @map("institucion_educativa")
  anioGraduacion       Int?      @map("anio_graduacion")
  experienciaAnios     Int?      @map("experiencia_anios")
  cargoActual          String?   @map("cargo_actual")
  empresaActual        String?   @map("empresa_actual")
  salarioActual        Decimal?  @map("salario_actual")
  expectativaSalarial  Decimal?  @map("expectativa_salarial")
  disponibilidad       String?
  cvUrl                String?   @map("cv_url")
  cvTexto              String?   @map("cv_texto") @db.Text
  documentos           Json?
  screeningIA          Json?     @map("screening_ia")
  scoreIA              Int?      @map("score_ia")
  fuenteAplicacion     String?   @map("fuente_aplicacion")
  referidoPor          String?   @map("referido_por")
  notas                String?   @db.Text
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")

  vacantes    THCandidatoVacante[]
  entrevistas THEntrevista[]

  @@unique([tipoDocumento, documento])
  @@index([email])
  @@map("th_candidatos")
}

model THCandidatoVacante {
  id                       String            @id @default(uuid())
  candidatoId              String            @map("candidato_id")
  vacanteId                String            @map("vacante_id")
  estado                   THEstadoCandidato @default(APLICADO)
  etapaActual              String?           @map("etapa_actual")
  fechaAplicacion          DateTime          @default(now()) @map("fecha_aplicacion")
  fechaUltimaActualizacion DateTime          @updatedAt @map("fecha_ultima_actualizacion")
  responsableId            String?           @map("responsable_id") @db.Uuid
  notas                    String?           @db.Text
  motivoRechazo            String?           @map("motivo_rechazo")

  candidato   THCandidato @relation(fields: [candidatoId], references: [id])
  vacante     THVacante   @relation(fields: [vacanteId], references: [id])
  responsable Usuario?    @relation("THCandidatoResponsable", fields: [responsableId], references: [id])

  @@unique([candidatoId, vacanteId])
  @@index([estado])
  @@map("th_candidato_vacante")
}

model THEntrevista {
  id              String             @id @default(uuid())
  candidatoId     String             @map("candidato_id")
  vacanteId       String?            @map("vacante_id")
  tipo            THTipoEntrevista
  fechaProgramada DateTime           @map("fecha_programada")
  duracionMinutos Int                @default(60) @map("duracion_minutos")
  modalidad       String
  ubicacion       String?
  entrevistadorId String             @map("entrevistador_id") @db.Uuid
  estado          THEstadoEntrevista @default(PROGRAMADA)
  preguntasIA     Json?              @map("preguntas_ia")
  respuestas      Json?
  evaluacion      Json?
  observaciones   String?            @db.Text
  recomendacion   String?
  createdAt       DateTime           @default(now()) @map("created_at")
  updatedAt       DateTime           @updatedAt @map("updated_at")

  candidato     THCandidato @relation(fields: [candidatoId], references: [id])
  entrevistador Usuario     @relation("THEntrevistador", fields: [entrevistadorId], references: [id])

  @@index([candidatoId])
  @@index([estado])
  @@map("th_entrevistas")
}

// ============ EMPLEADOS ============

model THEmpleado {
  id                       String           @id @default(uuid())
  usuarioId                String?          @unique @map("usuario_id") @db.Uuid
  candidatoId              String?          @unique @map("candidato_id")
  tipoDocumento            String           @map("tipo_documento")
  documento                String           @unique
  nombre                   String
  apellido                 String
  fechaNacimiento          DateTime?        @map("fecha_nacimiento")
  lugarNacimiento          String?          @map("lugar_nacimiento")
  genero                   String?
  estadoCivil              String?          @map("estado_civil")
  nacionalidad             String?
  tipoSangre               String?          @map("tipo_sangre")
  fotoUrl                  String?          @map("foto_url")
  email                    String
  emailCorporativo         String?          @map("email_corporativo")
  telefono                 String
  telefonoEmergencia       String?          @map("telefono_emergencia")
  contactoEmergencia       String?          @map("contacto_emergencia")
  parentescoEmergencia     String?          @map("parentesco_emergencia")
  direccion                String?
  ciudad                   String?
  departamentoGeo          String?          @map("departamento_geo")
  cargoId                  String           @map("cargo_id")
  departamentoId           String?          @map("departamento_id") @db.Uuid
  jefeDirectoId            String?          @map("jefe_directo_id")
  fechaIngreso             DateTime         @map("fecha_ingreso")
  fechaRetiro              DateTime?        @map("fecha_retiro")
  estado                   THEstadoEmpleado @default(ACTIVO)
  tipoEmpleado             THTipoEmpleado   @map("tipo_empleado")
  nivelEducativo           String?          @map("nivel_educativo")
  profesion                String?
  especializaciones        String[]
  numeroTarjetaProfesional String?          @map("numero_tarjeta_profesional")
  rethus                   String?
  eps                      String?
  afp                      String?
  arl                      String?
  cajaCompensacion         String?          @map("caja_compensacion")
  banco                    String?
  tipoCuenta               String?          @map("tipo_cuenta")
  numeroCuenta             String?          @map("numero_cuenta")
  observaciones            String?          @db.Text
  createdAt                DateTime         @default(now()) @map("created_at")
  updatedAt                DateTime         @updatedAt @map("updated_at")

  usuario               Usuario?                  @relation("THEmpleadoUsuario", fields: [usuarioId], references: [id])
  cargo                 THCargo                   @relation(fields: [cargoId], references: [id])
  jefeDirecto           THEmpleado?               @relation("JefeSubordinado", fields: [jefeDirectoId], references: [id])
  subordinados          THEmpleado[]              @relation("JefeSubordinado")
  contratos             THContrato[]
  movimientos           THMovimiento[]
  documentos            THDocumentoEmpleado[]
  asistencias           THAsistencia[]
  vacaciones            THVacacion[]
  permisos              THPermiso[]
  evaluacionesRecibidas THEvaluacionDesempeno[]   @relation("THEvaluacionEmpleado")
  evaluacionesDadas     THEvaluacionDesempeno[]   @relation("THEvaluacionEvaluador")
  objetivos             THObjetivo[]
  feedbackRecibido      THFeedback[]              @relation("THFeedbackEmpleado")
  feedbackDado          THFeedback[]              @relation("THFeedbackDe")
  capacitaciones        THAsistenteCapacitacion[]
  nominaDetalles        THNominaDetalle[]
  beneficios            THBeneficioEmpleado[]
  reconocimientos       THReconocimiento[]
  eventosAsistente      THAsistenteEvento[]

  // ========== RELACIONES SST (Seguridad y Salud en el Trabajo) ==========
  // Accidentes e Incidentes
  accidentesReportados       SSTAccidenteTrabajo[]       @relation("SSTAccidenteReportante")
  accidentesSufridos         SSTAccidenteTrabajo[]       @relation("SSTAccidenteAfectado")
  testigos                   SSTTestigoAccidente[]       @relation("SSTTestigoEmpleado")
  incidentesReportados       SSTIncidente[]              @relation("SSTIncidenteReporta")
  incidentesAfectados        SSTIncidente[]              @relation("SSTIncidenteAfectado")
  investigacionesPrincipales SSTInvestigacionAccidente[] @relation("SSTInvestigadorPrincipal")
  miembroInvestigaciones     SSTMiembroInvestigacion[]   @relation("SSTMiembroInvestigacion")
  medidasControlResponsable  SSTMedidaControlAccidente[] @relation("SSTMedidaControlResponsable")

  // Enfermedades Laborales
  enfermedadesLaborales  SSTEnfermedadLaboral[]     @relation("SSTEnfermedadEmpleado")
  seguimientosEnfermedad SSTSeguimientoEnfermedad[] @relation("SSTSeguimientoEnfermedadResponsable")

  // Matriz IPVR
  matricesElaboradas      SSTMatrizIPVR[]         @relation("SSTMatrizElaborador")
  matricesAprobadas       SSTMatrizIPVR[]         @relation("SSTMatrizAprobador")
  medidasIntervencionResp SSTMedidaIntervencion[] @relation("SSTMedidaIntervencionResponsable")

  // ExÃ¡menes MÃ©dicos
  examenesMedicos SSTExamenMedico[] @relation("SSTExamenEmpleado")

  // COPASST
  integrantesCopasst     SSTCopasstIntegrante[] @relation("SSTCopasstIntegrante")
  compromisosCopasstResp SSTCompromisoReunion[] @relation("SSTCompromisoResponsable")

  // ComitÃ© Convivencia Laboral
  integrantesCCL     SSTCCLIntegrante[]         @relation("SSTCCLIntegrante")
  compromisosCCLResp SSTCCLCompromiso[]         @relation("SSTCCLCompromisoResponsable")
  quejasComoQuejoso  SSTQuejaAcosoLaboral[]     @relation("SSTQuejaQuejoso")
  quejasComoAcusado  SSTQuejaAcosoLaboral[]     @relation("SSTQuejaAcusado")
  seguimientosQueja  SSTSeguimientoQuejaAcoso[] @relation("SSTSeguimientoQuejaResp")

  // Plan Anual de Trabajo
  planesElaborados       SSTPlanAnualTrabajo[] @relation("SSTPlanElaborador")
  planesAprobados        SSTPlanAnualTrabajo[] @relation("SSTPlanAprobador")
  actividadesResponsable SSTActividadPlan[]    @relation("SSTActividadResponsable")

  // Capacitaciones SST
  capacitacionesSSTFacilitador SSTCapacitacionSST[]           @relation("SSTCapacitacionFacilitador")
  asistenciasCapacitacionSST   SSTAsistenteCapacitacionSST[]  @relation("SSTAsistenteCapacitacionSST")
  evaluacionesCapacitacionSST  SSTEvaluacionCapacitacionSST[] @relation("SSTEvaluacionCapacitacionSST")

  // Inspecciones
  inspeccionesPrincipales SSTInspeccion[]         @relation("SSTInspectorPrincipal")
  inspeccionesAdicionales SSTInspectorAdicional[] @relation("SSTInspectorAdicional")
  hallazgosResponsable    SSTHallazgoInspeccion[] @relation("SSTHallazgoResponsable")

  // Indicadores
  medicionesIndicador SSTMedicionIndicador[] @relation("SSTMedicionRegistrador")

  // EPP
  entregasEPPRecibidas  SSTEntregaEPP[] @relation("SSTEntregaEPPEmpleado")
  entregasEPPRealizadas SSTEntregaEPP[] @relation("SSTEntregaEPPEntregador")

  // Emergencias
  brigadasJefatura            SSTBrigadaEmergencia[]     @relation("SSTBrigadaJefe")
  miembroBrigadas             SSTMiembroBrigada[]        @relation("SSTMiembroBrigada")
  simulacrosCoordinados       SSTSimulacro[]             @relation("SSTSimulacroCoordinador")
  participacionesSimulacro    SSTParticipanteSimulacro[] @relation("SSTParticipanteSimulacro")
  accionesMejoraSimulacroResp SSTAccionMejoraSimulacro[] @relation("SSTAccionMejoraSimulacroResponsable")

  // Documentos SST
  documentosSSTElaborados SSTDocumentoSST[]       @relation("SSTDocumentoElaborador")
  documentosSSTRevisados  SSTDocumentoSST[]       @relation("SSTDocumentoRevisor")
  documentosSSTAprobados  SSTDocumentoSST[]       @relation("SSTDocumentoAprobador")
  historialDocumentosSST  SSTHistorialDocumento[] @relation("SSTHistorialModificador")

  // AuditorÃ­as
  auditoriasLideradas  SSTAuditoria[]        @relation("SSTAuditorLider")
  equipoAuditor        SSTAuditorEquipo[]    @relation("SSTAuditorEquipo")
  accionesCorrectivas  SSTAccionCorrectiva[] @relation("SSTAccionResponsable")
  verificacionesAccion SSTAccionCorrectiva[] @relation("SSTAccionVerificador")

  // EvaluaciÃ³n EstÃ¡ndares MÃ­nimos
  evaluacionesRealizadas   SSTEvaluacionEstandares[]       @relation("SSTEvaluacionEvaluador")
  accionesMejoramientoResp SSTAccionMejoramientoEstandar[] @relation("SSTAccionMejoramientoResponsable")

  // Alertas
  alertaDestinatarios AlertaDestinatario[] @relation("AlertaDestinatarioEmpleado")

  @@index([estado])
  @@index([cargoId])
  @@index([departamentoId])
  @@map("th_empleados")
}

// ============ CONTRATOS ============

model THContrato {
  id                   String           @id @default(uuid())
  empleadoId           String           @map("empleado_id")
  numeroContrato       String           @unique @map("numero_contrato")
  tipoContrato         THTipoContrato   @map("tipo_contrato")
  fechaInicio          DateTime         @map("fecha_inicio")
  fechaFin             DateTime?        @map("fecha_fin")
  salarioBase          Decimal          @map("salario_base")
  auxTransporte        Boolean          @default(true) @map("aux_transporte")
  jornada              THJornada
  horasSemana          Int              @default(48) @map("horas_semana")
  periodoPruebaDias    Int?             @map("periodo_prueba_dias")
  clausulasAdicionales String?          @map("clausulas_adicionales") @db.Text
  estado               THEstadoContrato @default(ACTIVO)
  documentoUrl         String?          @map("documento_url")
  firmaEmpleado        DateTime?        @map("firma_empleado")
  firmaEmpresa         DateTime?        @map("firma_empresa")
  motivoTerminacion    String?          @map("motivo_terminacion")
  fechaTerminacion     DateTime?        @map("fecha_terminacion")
  createdAt            DateTime         @default(now()) @map("created_at")
  updatedAt            DateTime         @updatedAt @map("updated_at")

  empleado       THEmpleado               @relation(fields: [empleadoId], references: [id])
  modificaciones THModificacionContrato[]

  @@index([empleadoId])
  @@index([estado])
  @@map("th_contratos")
}

model THModificacionContrato {
  id               String   @id @default(uuid())
  contratoId       String   @map("contrato_id")
  tipoModificacion String   @map("tipo_modificacion")
  descripcion      String   @db.Text
  datosAnteriores  Json     @map("datos_anteriores")
  datosNuevos      Json     @map("datos_nuevos")
  fechaEfectiva    DateTime @map("fecha_efectiva")
  documentoUrl     String?  @map("documento_url")
  createdAt        DateTime @default(now()) @map("created_at")

  contrato THContrato @relation(fields: [contratoId], references: [id])

  @@map("th_modificaciones_contrato")
}

// ============ MOVIMIENTOS ============

model THMovimiento {
  id                   String           @id @default(uuid())
  empleadoId           String           @map("empleado_id")
  tipoMovimiento       THTipoMovimiento @map("tipo_movimiento")
  fechaEfectiva        DateTime         @map("fecha_efectiva")
  motivo               String?
  cargoAnteriorId      String?          @map("cargo_anterior_id")
  salarioAnterior      Decimal?         @map("salario_anterior")
  departamentoAnterior String?          @map("departamento_anterior")
  cargoNuevoId         String?          @map("cargo_nuevo_id")
  salarioNuevo         Decimal?         @map("salario_nuevo")
  departamentoNuevo    String?          @map("departamento_nuevo")
  solicitadoPor        String?          @map("solicitado_por") @db.Uuid
  aprobadoPor          String?          @map("aprobado_por") @db.Uuid
  fechaAprobacion      DateTime?        @map("fecha_aprobacion")
  documentoSoporte     String?          @map("documento_soporte")
  observaciones        String?          @db.Text
  createdAt            DateTime         @default(now()) @map("created_at")

  empleado    THEmpleado @relation(fields: [empleadoId], references: [id])
  solicitante Usuario?   @relation("THMovimientoSolicitante", fields: [solicitadoPor], references: [id])
  aprobador   Usuario?   @relation("THMovimientoAprobador", fields: [aprobadoPor], references: [id])

  @@index([empleadoId])
  @@index([tipoMovimiento])
  @@map("th_movimientos")
}

// ============ DOCUMENTOS EMPLEADO ============

model THDocumentoEmpleado {
  id                String    @id @default(uuid())
  empleadoId        String    @map("empleado_id")
  tipo              String
  nombre            String
  url               String
  fechaEmision      DateTime? @map("fecha_emision")
  fechaVencimiento  DateTime? @map("fecha_vencimiento")
  estado            String    @default("VIGENTE")
  verificadoPor     String?   @map("verificado_por") @db.Uuid
  fechaVerificacion DateTime? @map("fecha_verificacion")
  createdAt         DateTime  @default(now()) @map("created_at")

  empleado    THEmpleado @relation(fields: [empleadoId], references: [id])
  verificador Usuario?   @relation("THDocumentoVerificador", fields: [verificadoPor], references: [id])

  @@index([empleadoId])
  @@index([tipo])
  @@map("th_documentos_empleado")
}

// ============ NÃMINA ============

model THPeriodoNomina {
  id            String         @id @default(uuid())
  anio          Int
  mes           Int
  quincena      Int?
  fechaInicio   DateTime       @map("fecha_inicio")
  fechaFin      DateTime       @map("fecha_fin")
  fechaPago     DateTime       @map("fecha_pago")
  estado        THEstadoNomina @default(ABIERTO)
  procesadoPor  String?        @map("procesado_por") @db.Uuid
  fechaProceso  DateTime?      @map("fecha_proceso")
  observaciones String?
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")

  detalles   THNominaDetalle[]
  procesador Usuario?          @relation("THNominaProcesador", fields: [procesadoPor], references: [id])

  @@unique([anio, mes, quincena])
  @@map("th_periodos_nomina")
}

model THNominaDetalle {
  id               String   @id @default(uuid())
  periodoId        String   @map("periodo_id")
  empleadoId       String   @map("empleado_id")
  salarioBase      Decimal  @map("salario_base")
  auxTransporte    Decimal  @default(0) @map("aux_transporte")
  horasExtras      Json?    @map("horas_extras")
  comisiones       Decimal  @default(0)
  bonificaciones   Decimal  @default(0)
  otrosIngresos    Decimal  @default(0) @map("otros_ingresos")
  totalDevengado   Decimal  @map("total_devengado")
  saludEmpleado    Decimal  @default(0) @map("salud_empleado")
  pensionEmpleado  Decimal  @default(0) @map("pension_empleado")
  fondoSolidaridad Decimal  @default(0) @map("fondo_solidaridad")
  retencionFuente  Decimal  @default(0) @map("retencion_fuente")
  embargos         Decimal  @default(0)
  prestamos        Decimal  @default(0)
  otrosDescuentos  Decimal  @default(0) @map("otros_descuentos")
  totalDeducciones Decimal  @map("total_deducciones")
  netoPagar        Decimal  @map("neto_pagar")
  saludEmpresa     Decimal  @default(0) @map("salud_empresa")
  pensionEmpresa   Decimal  @default(0) @map("pension_empresa")
  arl              Decimal  @default(0)
  cajaCompensacion Decimal  @default(0) @map("caja_compensacion")
  sena             Decimal  @default(0)
  icbf             Decimal  @default(0)
  cesantias        Decimal  @default(0)
  intCesantias     Decimal  @default(0) @map("int_cesantias")
  prima            Decimal  @default(0)
  vacacionesProv   Decimal  @default(0) @map("vacaciones_prov")
  createdAt        DateTime @default(now()) @map("created_at")

  periodo  THPeriodoNomina @relation(fields: [periodoId], references: [id])
  empleado THEmpleado      @relation(fields: [empleadoId], references: [id])

  @@unique([periodoId, empleadoId])
  @@map("th_nomina_detalle")
}

model THNovedadNomina {
  id            String              @id @default(uuid())
  empleadoId    String              @map("empleado_id")
  periodoId     String?             @map("periodo_id")
  tipo          THTipoNovedadNomina
  concepto      String
  valor         Decimal
  cantidad      Decimal?
  fechaInicio   DateTime?           @map("fecha_inicio")
  fechaFin      DateTime?           @map("fecha_fin")
  recurrente    Boolean             @default(false)
  estado        String              @default("PENDIENTE")
  aprobadoPor   String?             @map("aprobado_por") @db.Uuid
  observaciones String?
  createdAt     DateTime            @default(now()) @map("created_at")

  aprobador Usuario? @relation("THNovedadAprobador", fields: [aprobadoPor], references: [id])

  @@index([empleadoId])
  @@map("th_novedades_nomina")
}

// ============ ASISTENCIA ============

model THTurno {
  id           String   @id @default(uuid())
  nombre       String
  codigo       String   @unique
  horaInicio   String   @map("hora_inicio")
  horaFin      String   @map("hora_fin")
  horasJornada Decimal  @map("horas_jornada")
  esNocturno   Boolean  @default(false) @map("es_nocturno")
  esRotativo   Boolean  @default(false) @map("es_rotativo")
  color        String?
  activo       Boolean  @default(true)
  createdAt    DateTime @default(now()) @map("created_at")

  asignaciones THAsignacionTurno[]
  asistencias  THAsistencia[]

  @@map("th_turnos")
}

model THAsignacionTurno {
  id          String    @id @default(uuid())
  empleadoId  String    @map("empleado_id")
  turnoId     String    @map("turno_id")
  fechaInicio DateTime  @map("fecha_inicio") @db.Date
  fechaFin    DateTime? @map("fecha_fin") @db.Date
  diasSemana  Int[]     @map("dias_semana")
  createdAt   DateTime  @default(now()) @map("created_at")

  turno THTurno @relation(fields: [turnoId], references: [id])

  @@map("th_asignacion_turnos")
}

model THAsistencia {
  id               String             @id @default(uuid())
  empleadoId       String             @map("empleado_id")
  fecha            DateTime           @db.Date
  horaEntrada      DateTime?          @map("hora_entrada")
  horaSalida       DateTime?          @map("hora_salida")
  horasTrabajadas  Decimal?           @map("horas_trabajadas")
  horasExtras      Decimal?           @map("horas_extras")
  tipoRegistro     String             @map("tipo_registro")
  ubicacionEntrada Json?              @map("ubicacion_entrada")
  ubicacionSalida  Json?              @map("ubicacion_salida")
  turnoId          String?            @map("turno_id")
  estado           THEstadoAsistencia @default(PRESENTE)
  observaciones    String?
  registradoPor    String?            @map("registrado_por") @db.Uuid
  createdAt        DateTime           @default(now()) @map("created_at")
  updatedAt        DateTime           @updatedAt @map("updated_at")

  empleado    THEmpleado @relation(fields: [empleadoId], references: [id])
  turno       THTurno?   @relation(fields: [turnoId], references: [id])
  registrador Usuario?   @relation("THAsistenciaRegistrador", fields: [registradoPor], references: [id])

  @@unique([empleadoId, fecha])
  @@index([fecha])
  @@map("th_asistencia")
}

model THVacacion {
  id              String            @id @default(uuid())
  empleadoId      String            @map("empleado_id")
  tipo            THTipoVacacion
  fechaInicio     DateTime          @map("fecha_inicio") @db.Date
  fechaFin        DateTime          @map("fecha_fin") @db.Date
  diasSolicitados Int               @map("dias_solicitados")
  diasHabiles     Int               @map("dias_habiles")
  estado          THEstadoSolicitud @default(PENDIENTE)
  solicitadoEl    DateTime          @default(now()) @map("solicitado_el")
  aprobadoPor     String?           @map("aprobado_por") @db.Uuid
  fechaAprobacion DateTime?         @map("fecha_aprobacion")
  observaciones   String?

  empleado  THEmpleado @relation(fields: [empleadoId], references: [id])
  aprobador Usuario?   @relation("THVacacionAprobador", fields: [aprobadoPor], references: [id])

  @@index([empleadoId])
  @@index([estado])
  @@map("th_vacaciones")
}

model THPermiso {
  id               String            @id @default(uuid())
  empleadoId       String            @map("empleado_id")
  tipoPermiso      THTipoPermiso     @map("tipo_permiso")
  fechaInicio      DateTime          @map("fecha_inicio")
  fechaFin         DateTime          @map("fecha_fin")
  horaInicio       String?           @map("hora_inicio")
  horaFin          String?           @map("hora_fin")
  motivo           String
  documentoSoporte String?           @map("documento_soporte")
  estado           THEstadoSolicitud @default(PENDIENTE)
  solicitadoEl     DateTime          @default(now()) @map("solicitado_el")
  aprobadoPor      String?           @map("aprobado_por") @db.Uuid
  fechaAprobacion  DateTime?         @map("fecha_aprobacion")
  observaciones    String?

  empleado  THEmpleado @relation(fields: [empleadoId], references: [id])
  aprobador Usuario?   @relation("THPermisoAprobador", fields: [aprobadoPor], references: [id])

  @@index([empleadoId])
  @@index([estado])
  @@map("th_permisos")
}

// ============ EVALUACIÃN DE DESEMPEÃO ============

model THPeriodoEvaluacion {
  id               String              @id @default(uuid())
  nombre           String
  anio             Int
  tipo             THTipoPeriodoEval
  fechaInicio      DateTime            @map("fecha_inicio")
  fechaFin         DateTime            @map("fecha_fin")
  fechaLimiteEval  DateTime            @map("fecha_limite_eval")
  estado           THEstadoPeriodoEval @default(CONFIGURACION)
  competencias     Json?
  pesosEvaluadores Json?               @map("pesos_evaluadores")
  createdAt        DateTime            @default(now()) @map("created_at")

  evaluaciones THEvaluacionDesempeno[]

  @@map("th_periodos_evaluacion")
}

model THEvaluacionDesempeno {
  id                String             @id @default(uuid())
  periodoId         String             @map("periodo_id")
  empleadoId        String             @map("empleado_id")
  evaluadorId       String             @map("evaluador_id")
  tipoEvaluador     THTipoEvaluador    @map("tipo_evaluador")
  estado            THEstadoEvaluacion @default(PENDIENTE)
  fechaAsignacion   DateTime           @default(now()) @map("fecha_asignacion")
  fechaCompletado   DateTime?          @map("fecha_completado")
  respuestas        Json?
  scoreTotal        Decimal?           @map("score_total")
  fortalezas        String?            @db.Text
  areasMejora       String?            @map("areas_mejora") @db.Text
  comentarioGeneral String?            @map("comentario_general") @db.Text
  analisisIA        Json?              @map("analisis_ia")

  periodo   THPeriodoEvaluacion @relation(fields: [periodoId], references: [id])
  empleado  THEmpleado          @relation("THEvaluacionEmpleado", fields: [empleadoId], references: [id])
  evaluador THEmpleado          @relation("THEvaluacionEvaluador", fields: [evaluadorId], references: [id])

  @@index([periodoId])
  @@index([empleadoId])
  @@map("th_evaluaciones_desempeno")
}

model THObjetivo {
  id          String           @id @default(uuid())
  empleadoId  String           @map("empleado_id")
  anio        Int
  titulo      String
  descripcion String?          @db.Text
  metrica     String
  valorMeta   Decimal?         @map("valor_meta")
  valorActual Decimal?         @map("valor_actual")
  peso        Int              @default(100)
  fechaLimite DateTime?        @map("fecha_limite")
  estado      THEstadoObjetivo @default(EN_PROGRESO)
  progreso    Int              @default(0)
  evidencias  Json?
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  empleado THEmpleado @relation(fields: [empleadoId], references: [id])

  @@index([empleadoId])
  @@index([anio])
  @@map("th_objetivos")
}

model THFeedback {
  id                     String         @id @default(uuid())
  empleadoId             String         @map("empleado_id")
  deParte                String         @map("de_parte")
  tipo                   THTipoFeedback
  contenido              String         @db.Text
  esPublico              Boolean        @default(false) @map("es_publico")
  competenciaRelacionada String?        @map("competencia_relacionada")
  createdAt              DateTime       @default(now()) @map("created_at")

  empleado THEmpleado @relation("THFeedbackEmpleado", fields: [empleadoId], references: [id])
  autor    THEmpleado @relation("THFeedbackDe", fields: [deParte], references: [id])

  @@index([empleadoId])
  @@map("th_feedback")
}

// ============ CAPACITACIÃN ============

model THCapacitacion {
  id            String                  @id @default(uuid())
  nombre        String
  descripcion   String?                 @db.Text
  categoria     String?
  modalidad     THModalidadCapacitacion
  duracionHoras Int                     @map("duracion_horas")
  instructor    String?
  esInterno     Boolean                 @default(true) @map("es_interno")
  costoTotal    Decimal?                @map("costo_total")
  cuposMaximos  Int?                    @map("cupos_maximos")
  requisitos    String?                 @db.Text
  objetivos     String?                 @db.Text
  contenido     String?                 @db.Text
  estado        THEstadoCapacitacion    @default(PROGRAMADA)
  fechaInicio   DateTime?               @map("fecha_inicio")
  fechaFin      DateTime?               @map("fecha_fin")
  createdAt     DateTime                @default(now()) @map("created_at")
  updatedAt     DateTime                @updatedAt @map("updated_at")

  asistentes      THAsistenteCapacitacion[]
  sesiones        THSesionCapacitacion[]
  capacitacionSST SSTCapacitacionSST? // RelaciÃ³n 1:1 con capacitaciÃ³n SST

  @@map("th_capacitaciones")
}

model THSesionCapacitacion {
  id             String   @id @default(uuid())
  capacitacionId String   @map("capacitacion_id")
  fecha          DateTime
  horaInicio     String   @map("hora_inicio")
  horaFin        String   @map("hora_fin")
  ubicacion      String?
  enlaceVirtual  String?  @map("enlace_virtual")
  estado         String   @default("PROGRAMADA")

  capacitacion THCapacitacion @relation(fields: [capacitacionId], references: [id])

  @@map("th_sesiones_capacitacion")
}

model THAsistenteCapacitacion {
  id             String            @id @default(uuid())
  capacitacionId String            @map("capacitacion_id")
  empleadoId     String            @map("empleado_id")
  estado         THEstadoAsistente @default(INSCRITO)
  asistio        Boolean?
  notaEvaluacion Decimal?          @map("nota_evaluacion")
  certificadoUrl String?           @map("certificado_url")
  feedbackCurso  String?           @map("feedback_curso") @db.Text
  createdAt      DateTime          @default(now()) @map("created_at")

  capacitacion THCapacitacion @relation(fields: [capacitacionId], references: [id])
  empleado     THEmpleado     @relation(fields: [empleadoId], references: [id])

  @@unique([capacitacionId, empleadoId])
  @@map("th_asistentes_capacitacion")
}

// ============ BIENESTAR ============

model THBeneficio {
  id           String   @id @default(uuid())
  nombre       String
  descripcion  String?  @db.Text
  tipo         String
  valorMensual Decimal? @map("valor_mensual")
  requisitos   String?
  activo       Boolean  @default(true)
  createdAt    DateTime @default(now()) @map("created_at")

  asignaciones THBeneficioEmpleado[]

  @@map("th_beneficios")
}

model THBeneficioEmpleado {
  id          String    @id @default(uuid())
  beneficioId String    @map("beneficio_id")
  empleadoId  String    @map("empleado_id")
  fechaInicio DateTime  @map("fecha_inicio")
  fechaFin    DateTime? @map("fecha_fin")
  estado      String    @default("ACTIVO")

  beneficio THBeneficio @relation(fields: [beneficioId], references: [id])
  empleado  THEmpleado  @relation(fields: [empleadoId], references: [id])

  @@map("th_beneficios_empleado")
}

model THEncuesta {
  id          String         @id @default(uuid())
  titulo      String
  descripcion String?
  tipo        THTipoEncuesta
  fechaInicio DateTime       @map("fecha_inicio")
  fechaFin    DateTime       @map("fecha_fin")
  esAnonima   Boolean        @default(true) @map("es_anonima")
  estado      String         @default("BORRADOR")
  preguntas   Json
  createdAt   DateTime       @default(now()) @map("created_at")

  respuestas THRespuestaEncuesta[]

  @@map("th_encuestas")
}

model THRespuestaEncuesta {
  id           String   @id @default(uuid())
  encuestaId   String   @map("encuesta_id")
  empleadoId   String?  @map("empleado_id")
  respuestas   Json
  completadaEl DateTime @default(now()) @map("completada_el")

  encuesta THEncuesta @relation(fields: [encuestaId], references: [id])

  @@map("th_respuestas_encuesta")
}

model THEvento {
  id            String   @id @default(uuid())
  titulo        String
  descripcion   String?  @db.Text
  tipo          String
  fecha         DateTime
  horaInicio    String?  @map("hora_inicio")
  horaFin       String?  @map("hora_fin")
  ubicacion     String?
  cupoMaximo    Int?     @map("cupo_maximo")
  esObligatorio Boolean  @default(false) @map("es_obligatorio")
  estado        String   @default("PROGRAMADO")
  createdAt     DateTime @default(now()) @map("created_at")

  asistentes THAsistenteEvento[]

  @@map("th_eventos")
}

model THAsistenteEvento {
  id         String   @id @default(uuid())
  eventoId   String   @map("evento_id")
  empleadoId String   @map("empleado_id")
  confirmado Boolean  @default(false)
  asistio    Boolean?

  evento   THEvento   @relation(fields: [eventoId], references: [id])
  empleado THEmpleado @relation(fields: [empleadoId], references: [id])

  @@unique([eventoId, empleadoId])
  @@map("th_asistentes_evento")
}

// ============ RECONOCIMIENTOS ============

model THReconocimiento {
  id            String   @id @default(uuid())
  empleadoId    String   @map("empleado_id")
  tipo          String
  titulo        String
  descripcion   String?  @db.Text
  fecha         DateTime
  otorgadoPor   String   @map("otorgado_por") @db.Uuid
  valorAsociado String?  @map("valor_asociado")
  esPublico     Boolean  @default(true) @map("es_publico")
  createdAt     DateTime @default(now()) @map("created_at")

  empleado  THEmpleado @relation(fields: [empleadoId], references: [id])
  otorgante Usuario    @relation("THReconocimientoOtorgante", fields: [otorgadoPor], references: [id])

  @@index([empleadoId])
  @@map("th_reconocimientos")
}

// ============ CONVERSACIONES IA TALENTO HUMANO ============

model THConversacionIA {
  id           String   @id @default(uuid())
  usuarioId    String   @map("usuario_id") @db.Uuid
  tipo         String // screening, entrevista, desempeno, chat
  contexto     Json?
  mensajes     Json     @default("[]")
  tokensUsados Int      @default(0) @map("tokens_usados")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  usuario Usuario @relation("THConversacionUsuario", fields: [usuarioId], references: [id])

  @@index([usuarioId])
  @@index([tipo])
  @@map("th_conversaciones_ia")
}

// ==========================================
// MÃDULO INFRAESTRUCTURA - CALIDAD 2.0
// ==========================================
// Sistema de gestiÃ³n de documentos legales con alertas de vencimiento
// y gestiÃ³n del PGIRASA (Plan de GestiÃ³n Integral de Residuos)
// ==========================================

// 1. DOCUMENTOS LEGALES CON ALERTAS DE VENCIMIENTO
model DocumentoLegalInfraestructura {
  id                String    @id @default(uuid())
  carpetaId         String?   @map("carpeta_id")
  nombre            String
  descripcion       String?
  tipoDocumento     String    @map("tipo_documento") // CONCEPTO_SANITARIO, CERTIFICADO, LICENCIA, etc
  numeroDocumento   String?   @map("numero_documento")
  entidadEmisora    String?   @map("entidad_emisora")

  // Archivo
  archivoUrl        String    @map("archivo_url")
  archivoNombre     String    @map("archivo_nombre")
  archivoTipo       String    @map("archivo_tipo")
  archivoTamano     Int       @map("archivo_tamano")

  // Vencimiento y Alertas
  fechaEmision      DateTime? @map("fecha_emision")
  fechaVencimiento  DateTime? @map("fecha_vencimiento")
  tieneVencimiento  Boolean   @default(false) @map("tiene_vencimiento")
  diasAlerta        Int[]     @default([30, 15, 7]) @map("dias_alerta") // DÃ­as antes para alertar

  // AuditorÃ­a
  subidoPor         String    @map("subido_por") @db.Uuid
  activo            Boolean   @default(true)
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Relaciones
  carpeta           CarpetaCalidad2? @relation("CarpetaInfraestructuraDocumentos", fields: [carpetaId], references: [id])
  usuario           Usuario          @relation("DocumentoLegalCreador", fields: [subidoPor], references: [id])
  alertas           AlertaDocumentoLegal[]

  @@map("documentos_legales_infraestructura")
}

model AlertaDocumentoLegal {
  id                String    @id @default(uuid())
  documentoId       String    @map("documento_id")
  tipo              String    // POR_VENCER_30, POR_VENCER_15, POR_VENCER_7, VENCIDO
  mensaje           String
  fechaAlerta       DateTime  @map("fecha_alerta")
  diasRestantes     Int?      @map("dias_restantes")

  // Estado
  estado            String    @default("PENDIENTE") // PENDIENTE, NOTIFICADO, RESUELTO
  fechaNotificacion DateTime? @map("fecha_notificacion")
  emailEnviado      Boolean   @default(false) @map("email_enviado")

  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Relaciones
  documento         DocumentoLegalInfraestructura @relation(fields: [documentoId], references: [id], onDelete: Cascade)

  @@map("alertas_documentos_legales")
}

// 2. CONCEPTOS SANITARIOS (PGIRASA - Infraestructura)
model ConceptoSanitario {
  id                    String    @id @default(uuid())
  anio                  Int
  numeroConcepto        String    @map("numero_concepto")
  fechaInspeccion       DateTime  @map("fecha_inspeccion")
  entidadInspectora     String    @map("entidad_inspectora")
  tipoInspeccion        String    @map("tipo_inspeccion") // ORDINARIA, EXTRAORDINARIA, SEGUIMIENTO

  // Estado General
  estadoGeneral         String    @map("estado_general") // CONFORME, NO_CONFORME, REQUIERE_MEJORA
  porcentajeCompliance  Float     @default(0) @map("porcentaje_compliance")
  observaciones         String?   @db.Text

  // AuditorÃ­a
  evaluadoPor           String    @map("evaluado_por") @db.Uuid
  fechaEvaluacion       DateTime  @default(now()) @map("fecha_evaluacion")
  activo                Boolean   @default(true)
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  // Relaciones
  evaluador             Usuario                        @relation("ConceptoSanitarioEvaluador", fields: [evaluadoPor], references: [id])
  items                 ItemConceptoSanitario[]
  documentos            DocumentoConceptoSanitario[]
  solicitudesVisita     SolicitudVisitaInspeccion[]

  @@unique([anio, numeroConcepto])
  @@map("conceptos_sanitarios")
}

model ItemConceptoSanitario {
  id                  String    @id @default(uuid())
  conceptoId          String    @map("concepto_id")
  numero              Int       // 1-28
  pregunta            String    @db.Text
  respuesta           String    // SI, NO, N/A, o texto libre
  observaciones       String?   @db.Text
  cumple              Boolean?  // true si respuesta = SI, false si NO, null si N/A
  evidenciaUrl        String?   @map("evidencia_url")

  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relaciones
  concepto            ConceptoSanitario @relation(fields: [conceptoId], references: [id], onDelete: Cascade)

  @@unique([conceptoId, numero])
  @@map("items_concepto_sanitario")
}

model DocumentoConceptoSanitario {
  id                  String    @id @default(uuid())
  conceptoId          String    @map("concepto_id")
  nombre              String
  descripcion         String?
  archivoUrl          String    @map("archivo_url")
  archivoNombre       String    @map("archivo_nombre")
  archivoTipo         String    @map("archivo_tipo")
  archivoTamano       Int       @map("archivo_tamano")
  tipoDocumento       String    @map("tipo_documento") // CHECKLIST, EVIDENCIA, ACTA, OTRO

  subidoPor           String    @map("subido_por") @db.Uuid
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relaciones
  concepto            ConceptoSanitario @relation(fields: [conceptoId], references: [id], onDelete: Cascade)
  usuario             Usuario           @relation("DocumentoConceptoCreador", fields: [subidoPor], references: [id])

  @@map("documentos_concepto_sanitario")
}

model SolicitudVisitaInspeccion {
  id                  String    @id @default(uuid())
  conceptoId          String?   @map("concepto_id")
  anio                Int
  fechaSolicitud      DateTime  @map("fecha_solicitud")
  fechaProgramada     DateTime? @map("fecha_programada")
  entidadSolicitante  String    @map("entidad_solicitante")
  motivo              String    @db.Text
  estado              String    @default("PROGRAMADA") // PROGRAMADA, REALIZADA, CANCELADA
  observaciones       String?   @db.Text

  // AuditorÃ­a
  solicitadoPor       String    @map("solicitado_por") @db.Uuid
  activo              Boolean   @default(true)
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relaciones
  concepto            ConceptoSanitario? @relation(fields: [conceptoId], references: [id])
  solicitante         Usuario            @relation("SolicitudVisitaCreador", fields: [solicitadoPor], references: [id])
  documentos          DocumentoSolicitudVisita[]

  @@map("solicitudes_visita_inspeccion")
}

model DocumentoSolicitudVisita {
  id                  String    @id @default(uuid())
  solicitudId         String    @map("solicitud_id")
  nombre              String
  descripcion         String?
  archivoUrl          String    @map("archivo_url")
  archivoNombre       String    @map("archivo_nombre")
  archivoTipo         String    @map("archivo_tipo")
  archivoTamano       Int       @map("archivo_tamano")
  tipoDocumento       String    @map("tipo_documento") // REQUISITO, SOPORTE, CERTIFICADO, OTRO

  subidoPor           String    @map("subido_por") @db.Uuid
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relaciones
  solicitud           SolicitudVisitaInspeccion @relation(fields: [solicitudId], references: [id], onDelete: Cascade)
  usuario             Usuario                   @relation("DocumentoSolicitudVisitaCreador", fields: [subidoPor], references: [id])

  @@map("documentos_solicitud_visita")
}

// 3. AUDITORÃAS (INTERNAS Y EXTERNAS)
model AuditoriaInfraestructura {
  id                  String    @id @default(uuid())
  tipo                String    // INTERNA, EXTERNA
  codigo              String    @unique
  nombre              String
  fechaInicio         DateTime  @map("fecha_inicio")
  fechaFin            DateTime? @map("fecha_fin")
  objetivo            String    @db.Text
  alcance             String    @db.Text
  equipo              String[]  // Lista de auditores
  hallazgos           String?   @db.Text
  conclusiones        String?   @db.Text

  // Estado
  estado              String    @default("PROGRAMADA") // PROGRAMADA, EN_CURSO, COMPLETADA, CANCELADA

  // AuditorÃ­a
  creadoPor           String    @map("creado_por") @db.Uuid
  activo              Boolean   @default(true)
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relaciones
  creador             Usuario                            @relation("AuditoriaInfraestructuraCreador", fields: [creadoPor], references: [id])
  documentos          DocumentoAuditoriaInfraestructura[]

  @@map("auditorias_infraestructura")
}

model DocumentoAuditoriaInfraestructura {
  id                  String    @id @default(uuid())
  auditoriaId         String    @map("auditoria_id")
  nombre              String
  descripcion         String?   @db.Text
  archivoUrl          String    @map("archivo_url")
  archivoNombre       String    @map("archivo_nombre")
  archivoTipo         String    @map("archivo_tipo")
  tipoDocumento       String    @map("tipo_documento") // PLAN, CHECKLIST, INFORME, EVIDENCIA, OTRO

  subidoPor           String    @map("subido_por") @db.Uuid
  createdAt           DateTime  @default(now()) @map("created_at")

  // Relaciones
  auditoria           AuditoriaInfraestructura @relation(fields: [auditoriaId], references: [id], onDelete: Cascade)
  usuario             Usuario                  @relation("DocumentoAuditoriaInfraestructuraCreador", fields: [subidoPor], references: [id])

  @@map("documentos_auditoria_infraestructura")
}

// 4. FORMULARIO RH1 (RESIDUOS HOSPITALARIOS)
model ResiduoRH1 {
  id                        String    @id @default(uuid())
  fecha                     DateTime  @unique
  mes                       Int
  anio                      Int
  dia                       Int

  // Residuos No Peligrosos (kg/dÃ­a)
  residuosAprovechables     Float     @default(0) @map("residuos_aprovechables")
  residuosNoAprovechables   Float     @default(0) @map("residuos_no_aprovechables")

  // Residuos Peligrosos (kg/dÃ­a)
  residuosInfecciosos       Float     @default(0) @map("residuos_infecciosos")
  residuosBiosanitarios     Float     @default(0) @map("residuos_biosanitarios")

  // Totales Calculados AutomÃ¡ticamente
  totalNoPeligrosos         Float     @default(0) @map("total_no_peligrosos")
  totalPeligrosos           Float     @default(0) @map("total_peligrosos")
  totalGenerado             Float     @default(0) @map("total_generado")

  // AuditorÃ­a
  registradoPor             String    @map("registrado_por") @db.Uuid
  modificadoPor             String?   @map("modificado_por") @db.Uuid
  activo                    Boolean   @default(true)
  createdAt                 DateTime  @default(now()) @map("created_at")
  updatedAt                 DateTime  @updatedAt @map("updated_at")

  // Relaciones
  registrador               Usuario   @relation("ResiduoRH1Registrador", fields: [registradoPor], references: [id])
  modificador               Usuario?  @relation("ResiduoRH1Modificador", fields: [modificadoPor], references: [id])

  @@unique([anio, mes, dia])
  @@map("residuos_rh1")
}

model ManifiestoRecoleccion {
  id                  String    @id @default(uuid())
  numeroManifiesto    String    @unique @map("numero_manifiesto")
  fecha               DateTime
  empresaRecolectora  String    @map("empresa_recolectora")
  tipoResiduo         String    @map("tipo_residuo") // PELIGROSO, NO_PELIGROSO
  cantidadKg          Float     @map("cantidad_kg")
  responsable         String
  observaciones       String?   @db.Text

  // Archivo adjunto
  archivoUrl          String?   @map("archivo_url")
  archivoNombre       String?   @map("archivo_nombre")

  // AuditorÃ­a
  registradoPor       String    @map("registrado_por") @db.Uuid
  activo              Boolean   @default(true)
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relaciones
  registrador         Usuario   @relation("ManifiestoRecoleccionCreador", fields: [registradoPor], references: [id])

  @@map("manifiestos_recoleccion")
}

model ActaDesactivacion {
  id                  String    @id @default(uuid())
  numeroActa          String    @unique @map("numero_acta")
  fecha               DateTime
  tipoEquipo          String    @map("tipo_equipo")
  numeroSerie         String?   @map("numero_serie")
  motivoDesactivacion String    @map("motivo_desactivacion") @db.Text
  responsable         String
  testigos            String[]
  observaciones       String?   @db.Text

  // Archivo adjunto
  archivoUrl          String?   @map("archivo_url")
  archivoNombre       String?   @map("archivo_nombre")

  // AuditorÃ­a
  registradoPor       String    @map("registrado_por") @db.Uuid
  activo              Boolean   @default(true)
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  // Relaciones
  registrador         Usuario   @relation("ActaDesactivacionCreador", fields: [registradoPor], references: [id])

  @@map("actas_desactivacion")
}

// ============================================================================
// SEGURIDAD Y SALUD EN EL TRABAJO (SST) - Normatividad Colombia 2025
// ============================================================================
// Decreto 1072/2015, Ley 1562/2012, ResoluciÃ³n 0312/2019
// ResoluciÃ³n 1843/2025, ResoluciÃ³n 3461/2025, ResoluciÃ³n 1401/2007
// GTC 45, Ley 1010/2006
// ============================================================================

// ============ ENUMS SST ============

enum SSTTipoAccidente {
  TRABAJO
  IN_ITINERE
}

enum SSTTipoIncapacidad {
  TEMPORAL
  PERMANENTE_PARCIAL
  PERMANENTE_TOTAL
  MUERTE
}

enum SSTEstadoAccidente {
  REPORTADO
  EN_INVESTIGACION
  INVESTIGADO
  CERRADO
}

enum SSTTipoIncidente {
  CASI_ACCIDENTE
  CONDICION_INSEGURA
  ACTO_INSEGURO
  EMERGENCIA_AMBIENTAL
}

enum SSTPotencialDano {
  BAJO
  MEDIO
  ALTO
  CRITICO
}

enum SSTEstadoIncidente {
  REPORTADO
  EN_INVESTIGACION
  CERRADO
}

enum SSTEstadoInvestigacion {
  EN_PROCESO
  COMPLETADA
  CERRADA
}

enum SSTTipoControl {
  ELIMINACION
  SUSTITUCION
  CONTROLES_INGENIERIA
  CONTROLES_ADMINISTRATIVOS
  EPP
}

enum SSTEstadoMedida {
  PENDIENTE
  EN_PROCESO
  IMPLEMENTADA
  VERIFICADA
}

enum SSTTipoEnfermedad {
  OSTEOMUSCULAR
  AUDITIVA
  RESPIRATORIA
  DERMATOLOGICA
  VISUAL
  MENTAL
  CARDIOVASCULAR
  CANCER_OCUPACIONAL
  OTRA
}

enum SSTOrigenEnfermedad {
  LABORAL
  COMUN
  EN_ESTUDIO
}

enum SSTEstadoEnfermedad {
  EN_ESTUDIO
  CALIFICADA_LABORAL
  CALIFICADA_COMUN
  EN_TRATAMIENTO
  REHABILITACION
  CERRADA
}

enum SSTEstadoMatriz {
  BORRADOR
  EN_REVISION
  APROBADA
  OBSOLETA
}

enum SSTClasificacionPeligro {
  BIOLOGICO
  FISICO
  QUIMICO
  PSICOSOCIAL
  BIOMECANICO
  CONDICIONES_SEGURIDAD
  FENOMENOS_NATURALES
}

enum SSTAceptabilidadRiesgo {
  NO_ACEPTABLE
  NO_ACEPTABLE_CON_CONTROL
  ACEPTABLE_CON_CONTROL
  ACEPTABLE
}

enum SSTTipoExamenMedico {
  PRE_EMPLEO
  PERIODICO
  POST_INCAPACIDAD
  POR_CAMBIO_OCUPACION
  RETIRO
}

enum SSTConceptoAptitud {
  APTO
  APTO_CON_RESTRICCIONES
  APTO_CON_RECOMENDACIONES
  APLAZADO
  NO_APTO
}

enum SSTEstadoExamen {
  PROGRAMADO
  NOTIFICADO
  REALIZADO
  ENTREGADO
  CANCELADO
}

enum SSTTipoComponenteExamen {
  EXAMEN_FISICO
  LABORATORIO_CLINICO
  AUDIOMETRIA
  OPTOMETRIA
  ESPIROMETRIA
  ELECTROCARDIOGRAMA
  RX_TORAX
  PSICOTECNICO
  VISIOMETRIA
  OSTEOMUSCULAR
  DERMATOLOGICO
  OTRO
}

enum SSTEstadoCopasst {
  ACTIVO
  VENCIDO
  RENOVACION
}

enum SSTTipoRepresentacion {
  EMPLEADOR
  TRABAJADORES
}

enum SSTCargoCopasst {
  PRESIDENTE
  SECRETARIO
  VOCAL
}

enum SSTTipoReunionCopasst {
  ORDINARIA
  EXTRAORDINARIA
}

enum SSTEstadoReunion {
  PROGRAMADA
  EN_CURSO
  FINALIZADA
  CANCELADA
}

enum SSTEstadoCompromiso {
  PENDIENTE
  EN_PROCESO
  CUMPLIDO
  VENCIDO
}

enum SSTCargoCCL {
  PRESIDENTE
  SECRETARIO
  MIEMBRO
}

enum SSTTipoAcoso {
  MALTRATO_LABORAL
  PERSECUCION_LABORAL
  DISCRIMINACION_LABORAL
  ENTORPECIMIENTO_LABORAL
  INEQUIDAD_LABORAL
  DESPROTECCION_LABORAL
}

enum SSTDecisionQueja {
  ARCHIVADA_SIN_MERITO
  CONCILIACION_EXITOSA
  MEDIDAS_CORRECTIVAS
  TRASLADO_AUTORIDAD
}

enum SSTEstadoQueja {
  RECIBIDA
  EN_INVESTIGACION
  AUDIENCIA_PROGRAMADA
  EN_CONCILIACION
  RESUELTA
  TRASLADADA
  ARCHIVADA
}

enum SSTEstadoPlan {
  BORRADOR
  EN_REVISION
  APROBADO
  EN_EJECUCION
  CERRADO
}

enum SSTPilarSGSST {
  POLITICA
  ORGANIZACION
  PLANIFICACION
  APLICACION
  EVALUACION
  AUDITORIA
  MEJORA
}

enum SSTTipoActividad {
  CAPACITACION
  INSPECCION
  EXAMEN_MEDICO
  MEDICION_AMBIENTAL
  SIMULACRO
  INVESTIGACION
  DOCUMENTACION
  AUDITORIA
  REVISION_GERENCIA
  MANTENIMIENTO_PREVENTIVO
  DOTACION_EPP
  SENALIZACION
  OTRO
}

enum SSTEstadoActividad {
  PROGRAMADA
  EN_EJECUCION
  EJECUTADA
  REPROGRAMADA
  CANCELADA
}

enum SSTTipoCapacitacion {
  INDUCCION_SST
  REINDUCCION_SST
  ESPECIFICA_CARGO
  RIESGO_PRIORITARIO
  BRIGADA_EMERGENCIA
  PRIMEROS_AUXILIOS
  MANEJO_EXTINTORES
  EVACUACION
  TRABAJO_ALTURAS
  ESPACIOS_CONFINADOS
  RIESGO_ELECTRICO
  MANEJO_SUSTANCIAS_QUIMICAS
  ERGONOMIA
  RIESGO_PSICOSOCIAL
  SEGURIDAD_VIAL
  COPASST_CCL
  OTRO
}

enum SSTModalidadCapacitacion {
  PRESENCIAL
  VIRTUAL
  MIXTA
}

enum SSTEstadoCapacitacionSST {
  PROGRAMADA
  EN_CURSO
  FINALIZADA
  REPROGRAMADA
  CANCELADA
}

enum SSTTipoInspeccion {
  LOCATIVA
  EPP
  EXTINTORES
  BOTIQUINES
  SENALIZACION
  MAQUINARIA_EQUIPOS
  ELECTRICA
  ORDEN_ASEO
  ERGONOMICA
  VEHICULOS
  INTEGRAL
  OTRA
}

enum SSTEstadoInspeccion {
  PROGRAMADA
  EN_EJECUCION
  COMPLETADA
  CANCELADA
}

enum SSTTipoHallazgo {
  CONDICION_INSEGURA
  ACTO_INSEGURO
  NO_CONFORMIDAD
  OPORTUNIDAD_MEJORA
  OBSERVACION
}

enum SSTClasificacionHallazgo {
  CRITICO
  MAYOR
  MENOR
}

enum SSTEstadoHallazgo {
  ABIERTO
  EN_PROCESO
  CERRADO
  VERIFICADO
}

enum SSTTipoIndicador {
  ESTRUCTURA
  PROCESO
  RESULTADO
}

enum SSTCategoriaIndicador {
  ACCIDENTALIDAD
  ENFERMEDAD_LABORAL
  AUSENTISMO
  CAPACITACION
  COBERTURA
  CUMPLIMIENTO
  INVESTIGACION
  MORTALIDAD
}

enum SSTFrecuenciaMedicion {
  MENSUAL
  TRIMESTRAL
  SEMESTRAL
  ANUAL
}

enum SSTCategoriaEPP {
  PROTECCION_CABEZA
  PROTECCION_OJOS_CARA
  PROTECCION_AUDITIVA
  PROTECCION_RESPIRATORIA
  PROTECCION_MANOS
  PROTECCION_PIES
  PROTECCION_CUERPO
  PROTECCION_CAIDAS
  OTRO
}

enum SSTMotivoEntregaEPP {
  INGRESO
  REPOSICION_DESGASTE
  REPOSICION_PERDIDA
  CAMBIO_TALLA
  CAMBIO_CARGO
  DOTACION_PERIODICA
}

enum SSTEstadoPlanEmergencia {
  BORRADOR
  EN_REVISION
  APROBADO
  VIGENTE
  OBSOLETO
}

enum SSTRolBrigada {
  COORDINADOR
  LIDER_GRUPO
  BRIGADISTA
}

enum SSTGrupoBrigada {
  PRIMEROS_AUXILIOS
  CONTROL_INCENDIOS
  EVACUACION
  COMUNICACIONES
}

enum SSTTipoSimulacro {
  INCENDIO
  SISMO
  EVACUACION_GENERAL
  DERRAME_QUIMICO
  EMERGENCIA_MEDICA
  AMENAZA_BOMBA
  INUNDACION
  OTRO
}

enum SSTAlcanceSimulacro {
  PARCIAL
  TOTAL
}

enum SSTEstadoSimulacro {
  PROGRAMADO
  EJECUTADO
  CANCELADO
}

enum SSTTipoDocumento {
  POLITICA
  MANUAL
  PROGRAMA
  PROCEDIMIENTO
  INSTRUCTIVO
  FORMATO
  REGISTRO
  PLAN
  MATRIZ
  PROTOCOLO
  GUIA
}

enum SSTCategoriaDocumento {
  POLITICAS_OBJETIVOS
  ORGANIZACION
  PLANIFICACION
  APLICACION_OPERACION
  VERIFICACION
  AUDITORIA_INTERNA
  REVISION_DIRECCION
  MEJORA_CONTINUA
}

enum SSTEstadoDocumento {
  BORRADOR
  EN_REVISION
  APROBADO
  VIGENTE
  OBSOLETO
}

enum SSTTipoAuditoria {
  INTERNA
  EXTERNA
  ARL
  MINISTERIO
}

enum SSTEstadoAuditoria {
  PROGRAMADA
  EN_EJECUCION
  INFORME_PENDIENTE
  CERRADA
}

enum SSTTipoHallazgoAuditoria {
  NO_CONFORMIDAD_MAYOR
  NO_CONFORMIDAD_MENOR
  OBSERVACION
  OPORTUNIDAD_MEJORA
  FORTALEZA
}

enum SSTEstadoHallazgoAuditoria {
  ABIERTO
  EN_TRATAMIENTO
  CERRADO_EFICAZ
  CERRADO_NO_EFICAZ
}

enum SSTOrigenAccion {
  AUDITORIA_INTERNA
  AUDITORIA_EXTERNA
  INVESTIGACION_ACCIDENTE
  INSPECCION
  REVISION_DIRECCION
  QUEJA_SUGERENCIA
  NO_CONFORMIDAD
  ACCION_PREVENTIVA
  OPORTUNIDAD_MEJORA
}

enum SSTTipoAccion {
  CORRECCION
  CORRECTIVA
  PREVENTIVA
  MEJORA
}

enum SSTEstadoAccionCorrectiva {
  ABIERTA
  EN_IMPLEMENTACION
  IMPLEMENTADA
  EN_VERIFICACION
  CERRADA_EFICAZ
  CERRADA_NO_EFICAZ
}

enum SSTTamanoEmpresa {
  MICRO
  PEQUENA
  MEDIANA
  GRANDE
}

enum SSTNivelRiesgoARL {
  I
  II
  III
  IV
  V
}

enum SSTCicloPHVA {
  PLANIFICAR
  HACER
  VERIFICAR
  ACTUAR
}

enum SSTCumplimientoEstandar {
  CUMPLE_TOTALMENTE
  CUMPLE_PARCIALMENTE
  NO_CUMPLE
  NO_APLICA
}

enum SSTValoracionEstandar {
  CRITICO
  MODERADAMENTE_ACEPTABLE
  ACEPTABLE
}

// ============ ACCIDENTES DE TRABAJO ============

model SSTAccidenteTrabajo {
  id           String @id @default(uuid())
  empleadoId   String @map("empleado_id")
  reportanteId String @map("reportante_id")

  fechaAccidente      DateTime         @map("fecha_accidente")
  horaAccidente       String           @map("hora_accidente")
  lugarAccidente      String           @map("lugar_accidente")
  tipoAccidente       SSTTipoAccidente @map("tipo_accidente")
  tipoLesion          String           @map("tipo_lesion")
  parteCuerpoAfectada String           @map("parte_cuerpo_afectada")
  agenteAccidente     String           @map("agente_accidente")
  mecanismoAccidente  String           @map("mecanismo_accidente")

  descripcionHechos  String  @map("descripcion_hechos") @db.Text
  actividadRealizaba String  @map("actividad_realizaba")
  testigosNombres    String? @map("testigos_nombres")
  testigosContacto   String? @map("testigos_contacto")

  diasIncapacidad Int                 @default(0) @map("dias_incapacidad")
  tipoIncapacidad SSTTipoIncapacidad? @map("tipo_incapacidad")
  atencionMedica  Boolean             @default(false) @map("atencion_medica")
  hospitalizacion Boolean             @default(false)
  nombreIPS       String?             @map("nombre_ips")

  furatGenerado     Boolean   @default(false) @map("furat_generado")
  furatNumero       String?   @map("furat_numero")
  furatFechaReporte DateTime? @map("furat_fecha_reporte")
  furatArchivoUrl   String?   @map("furat_archivo_url")

  estado SSTEstadoAccidente @default(REPORTADO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  empleado      THEmpleado                 @relation("SSTAccidenteAfectado", fields: [empleadoId], references: [id])
  reportante    THEmpleado                 @relation("SSTAccidenteReportante", fields: [reportanteId], references: [id])
  investigacion SSTInvestigacionAccidente?
  testigos      SSTTestigoAccidente[]

  @@index([empleadoId])
  @@index([reportanteId])
  @@index([estado])
  @@index([fechaAccidente])
  @@map("sst_accidentes_trabajo")
}

// ============ INCIDENTES ============

model SSTIncidente {
  id                 String  @id @default(uuid())
  empleadoReportaId  String  @map("empleado_reporta_id")
  empleadoAfectadoId String? @map("empleado_afectado_id")

  fechaIncidente DateTime         @map("fecha_incidente")
  horaIncidente  String           @map("hora_incidente")
  lugarIncidente String           @map("lugar_incidente")
  descripcion    String           @db.Text
  tipoIncidente  SSTTipoIncidente @map("tipo_incidente")
  potencialDano  SSTPotencialDano @map("potencial_dano")

  accionesTomadas String? @map("acciones_tomadas") @db.Text

  investigado         Boolean   @default(false)
  accionesCorrectivas String?   @map("acciones_correctivas") @db.Text
  responsableAcciones String?   @map("responsable_acciones")
  fechaCierreAcciones DateTime? @map("fecha_cierre_acciones")

  estado SSTEstadoIncidente @default(REPORTADO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  empleadoReporta  THEmpleado  @relation("SSTIncidenteReporta", fields: [empleadoReportaId], references: [id])
  empleadoAfectado THEmpleado? @relation("SSTIncidenteAfectado", fields: [empleadoAfectadoId], references: [id])

  @@index([empleadoReportaId])
  @@index([estado])
  @@map("sst_incidentes")
}

// ============ INVESTIGACION DE ACCIDENTES (Res. 1401/2007) ============

model SSTInvestigacionAccidente {
  id                      String @id @default(uuid())
  accidenteId             String @unique @map("accidente_id")
  investigadorPrincipalId String @map("investigador_principal_id")

  fechaInvestigacion DateTime @map("fecha_investigacion")

  causasInmediatas String  @map("causas_inmediatas") @db.Text
  causasBasicas    String  @map("causas_basicas") @db.Text
  faltaControl     String? @map("falta_control") @db.Text

  analisis5Porques Json? @map("analisis_5_porques")

  leccionesAprendidas String? @map("lecciones_aprendidas") @db.Text

  firmaInvestigador       String?   @map("firma_investigador")
  firmaResponsableSST     String?   @map("firma_responsable_sst")
  firmaRepresentanteLegal String?   @map("firma_representante_legal")
  fechaCierre             DateTime? @map("fecha_cierre")

  estado SSTEstadoInvestigacion @default(EN_PROCESO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  accidente             SSTAccidenteTrabajo         @relation(fields: [accidenteId], references: [id])
  investigadorPrincipal THEmpleado                  @relation("SSTInvestigadorPrincipal", fields: [investigadorPrincipalId], references: [id])
  miembrosEquipo        SSTMiembroInvestigacion[]
  medidasControl        SSTMedidaControlAccidente[]
  documentos            SSTDocumentoInvestigacion[]

  @@map("sst_investigaciones_accidente")
}

model SSTMiembroInvestigacion {
  id              String @id @default(uuid())
  investigacionId String @map("investigacion_id")
  empleadoId      String @map("empleado_id")
  rol             String

  createdAt DateTime @default(now()) @map("created_at")

  investigacion SSTInvestigacionAccidente @relation(fields: [investigacionId], references: [id])
  empleado      THEmpleado                @relation("SSTMiembroInvestigacion", fields: [empleadoId], references: [id])

  @@unique([investigacionId, empleadoId])
  @@map("sst_miembros_investigacion")
}

model SSTMedidaControlAccidente {
  id              String @id @default(uuid())
  investigacionId String @map("investigacion_id")

  descripcion         String
  tipoControl         SSTTipoControl  @map("tipo_control")
  responsableId       String          @map("responsable_id")
  fechaImplementacion DateTime        @map("fecha_implementacion")
  fechaCumplimiento   DateTime?       @map("fecha_cumplimiento")
  estado              SSTEstadoMedida @default(PENDIENTE)
  evidenciaUrl        String?         @map("evidencia_url")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  investigacion SSTInvestigacionAccidente @relation(fields: [investigacionId], references: [id])
  responsable   THEmpleado                @relation("SSTMedidaControlResponsable", fields: [responsableId], references: [id])

  @@map("sst_medidas_control_accidente")
}

model SSTDocumentoInvestigacion {
  id              String @id @default(uuid())
  investigacionId String @map("investigacion_id")
  nombre          String
  tipo            String
  url             String

  createdAt DateTime @default(now()) @map("created_at")

  investigacion SSTInvestigacionAccidente @relation(fields: [investigacionId], references: [id])

  @@map("sst_documentos_investigacion")
}

// ============ ENFERMEDADES LABORALES ============

model SSTEnfermedadLaboral {
  id         String @id @default(uuid())
  empleadoId String @map("empleado_id")

  fechaDiagnostico DateTime            @map("fecha_diagnostico")
  cie10Codigo      String              @map("cie10_codigo")
  cie10Descripcion String              @map("cie10_descripcion")
  tipoEnfermedad   SSTTipoEnfermedad   @map("tipo_enfermedad")
  origenEnfermedad SSTOrigenEnfermedad @default(EN_ESTUDIO) @map("origen_enfermedad")

  entidadCalificadora String?   @map("entidad_calificadora")
  fechaCalificacion   DateTime? @map("fecha_calificacion")
  porcentajePCL       Decimal?  @map("porcentaje_pcl") @db.Decimal(5, 2)

  factorRiesgoId String? @map("factor_riesgo_id")

  furelGenerado     Boolean   @default(false) @map("furel_generado")
  furelNumero       String?   @map("furel_numero")
  furelFechaReporte DateTime? @map("furel_fecha_reporte")
  furelArchivoUrl   String?   @map("furel_archivo_url")

  restricciones       String? @db.Text
  recomendaciones     String? @db.Text
  requiereReubicacion Boolean @default(false) @map("requiere_reubicacion")

  estado SSTEstadoEnfermedad @default(EN_ESTUDIO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  empleado     THEmpleado                 @relation("SSTEnfermedadEmpleado", fields: [empleadoId], references: [id])
  factorRiesgo SSTFactorRiesgo?           @relation(fields: [factorRiesgoId], references: [id])
  seguimientos SSTSeguimientoEnfermedad[]

  @@index([empleadoId])
  @@index([estado])
  @@map("sst_enfermedades_laborales")
}

model SSTSeguimientoEnfermedad {
  id           String @id @default(uuid())
  enfermedadId String @map("enfermedad_id")

  fecha           DateTime
  tipoSeguimiento String    @map("tipo_seguimiento")
  observaciones   String    @db.Text
  recomendaciones String?   @db.Text
  proximaCita     DateTime? @map("proxima_cita")
  responsableId   String    @map("responsable_id")

  createdAt DateTime @default(now()) @map("created_at")

  enfermedad  SSTEnfermedadLaboral @relation(fields: [enfermedadId], references: [id])
  responsable THEmpleado           @relation("SSTSeguimientoEnfermedadResponsable", fields: [responsableId], references: [id])

  @@map("sst_seguimientos_enfermedad")
}

// ============ FACTORES DE RIESGO (CatÃ¡logo) ============

model SSTFactorRiesgo {
  id                String                  @id @default(uuid())
  codigo            String                  @unique
  nombre            String
  clasificacion     SSTClasificacionPeligro
  descripcion       String?                 @db.Text
  efectosSalud      String?                 @map("efectos_salud") @db.Text
  medidasPrevencion String?                 @map("medidas_prevencion") @db.Text

  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  peligros     SSTPeligro[]
  enfermedades SSTEnfermedadLaboral[]

  @@map("sst_factores_riesgo")
}

// ============ MATRIZ IPVR (GTC 45) ============

model SSTMatrizIPVR {
  id                 String          @id @default(uuid())
  version            Int             @default(1)
  fechaElaboracion   DateTime        @map("fecha_elaboracion")
  fechaActualizacion DateTime?       @map("fecha_actualizacion")
  elaboradoPorId     String          @map("elaborado_por_id")
  aprobadoPorId      String?         @map("aprobado_por_id")
  estado             SSTEstadoMatriz @default(BORRADOR)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  elaboradoPor    THEmpleado           @relation("SSTMatrizElaborador", fields: [elaboradoPorId], references: [id])
  aprobadoPor     THEmpleado?          @relation("SSTMatrizAprobador", fields: [aprobadoPorId], references: [id])
  peligros        SSTPeligro[]
  cargosAfectados SSTMatrizIPVRCargo[] // RelaciÃ³n con cargos afectados por riesgos

  @@map("sst_matriz_ipvr")
}

// Tabla puente: Vincula Matriz IPVR con Cargos afectados
model SSTMatrizIPVRCargo {
  id       String @id @default(uuid())
  matrizId String @map("matriz_id")
  cargoId  String @map("cargo_id")

  nivelExposicion     SSTNivelExposicion @default(MEDIO) @map("nivel_exposicion")
  peligrosPrincipales String[]           @map("peligros_principales") // IDs de SSTPeligro relevantes
  medidasEspecificas  String?            @map("medidas_especificas") @db.Text

  createdAt DateTime @default(now()) @map("created_at")

  matriz SSTMatrizIPVR @relation(fields: [matrizId], references: [id], onDelete: Cascade)
  cargo  THCargo       @relation(fields: [cargoId], references: [id])

  @@unique([matrizId, cargoId])
  @@map("sst_matriz_ipvr_cargos")
}

enum SSTNivelExposicion {
  BAJO
  MEDIO
  ALTO
  MUY_ALTO
}

model SSTPeligro {
  id       String @id @default(uuid())
  matrizId String @map("matriz_id")

  proceso        String
  zona           String
  actividad      String
  tareaRutinaria Boolean @default(true) @map("tarea_rutinaria")

  clasificacion      SSTClasificacionPeligro
  descripcionPeligro String                  @map("descripcion_peligro")
  fuenteGeneradora   String                  @map("fuente_generadora")
  efectosPosibles    String                  @map("efectos_posibles") @db.Text

  controlFuente    String? @map("control_fuente")
  controlMedio     String? @map("control_medio")
  controlIndividuo String? @map("control_individuo")

  factorRiesgoId String? @map("factor_riesgo_id")

  expuestosDirectos   Int      @default(0) @map("expuestos_directos")
  expuestosIndirectos Int      @default(0) @map("expuestos_indirectos")
  horasExposicionDia  Decimal? @map("horas_exposicion_dia") @db.Decimal(4, 2)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  matriz              SSTMatrizIPVR           @relation(fields: [matrizId], references: [id])
  factorRiesgo        SSTFactorRiesgo?        @relation(fields: [factorRiesgoId], references: [id])
  valoracionRiesgo    SSTValoracionRiesgo?
  medidasIntervencion SSTMedidaIntervencion[]

  @@map("sst_peligros")
}

model SSTValoracionRiesgo {
  id        String @id @default(uuid())
  peligroId String @unique @map("peligro_id")

  nivelDeficiencia  Int                    @map("nivel_deficiencia")
  nivelExposicion   Int                    @map("nivel_exposicion")
  nivelProbabilidad Int                    @map("nivel_probabilidad")
  interpretacionNP  String                 @map("interpretacion_np")
  nivelConsecuencia Int                    @map("nivel_consecuencia")
  nivelRiesgo       Int                    @map("nivel_riesgo")
  interpretacionNR  String                 @map("interpretacion_nr")
  aceptabilidad     SSTAceptabilidadRiesgo
  significado       String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  peligro SSTPeligro @relation(fields: [peligroId], references: [id])

  @@map("sst_valoracion_riesgo")
}

model SSTMedidaIntervencion {
  id        String @id @default(uuid())
  peligroId String @map("peligro_id")

  tipoControl     SSTTipoControl  @map("tipo_control")
  descripcion     String          @db.Text
  responsableId   String          @map("responsable_id")
  fechaProgramada DateTime        @map("fecha_programada")
  fechaEjecucion  DateTime?       @map("fecha_ejecucion")
  presupuesto     Decimal?        @db.Decimal(15, 2)
  estado          SSTEstadoMedida @default(PENDIENTE)
  evidenciaUrl    String?         @map("evidencia_url")
  observaciones   String?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  peligro     SSTPeligro @relation(fields: [peligroId], references: [id])
  responsable THEmpleado @relation("SSTMedidaIntervencionResponsable", fields: [responsableId], references: [id])

  @@map("sst_medidas_intervencion")
}

// ============ EXAMENES MEDICOS OCUPACIONALES (Res. 1843/2025) ============

model SSTExamenMedico {
  id         String @id @default(uuid())
  empleadoId String @map("empleado_id")

  tipoExamen SSTTipoExamenMedico @map("tipo_examen")

  fechaProgramada  DateTime? @map("fecha_programada")
  fechaRealizacion DateTime? @map("fecha_realizacion")

  ipsRealizaId      String? @map("ips_realiza_id")
  medicoOcupacional String? @map("medico_ocupacional")
  licenciaMedico    String? @map("licencia_medico")

  profesiogramaId String? @map("profesiograma_id")

  conceptoAptitud     SSTConceptoAptitud? @map("concepto_aptitud")
  restricciones       String?             @db.Text
  recomendaciones     String?             @db.Text
  requiereRevaluacion Boolean             @default(false) @map("requiere_revaluacion")
  fechaProximoExamen  DateTime?           @map("fecha_proximo_examen")

  certificadoUrl     String? @map("certificado_url")
  historiaClinicaUrl String? @map("historia_clinica_url")

  entregadoTrabajador Boolean   @default(false) @map("entregado_trabajador")
  fechaEntrega        DateTime? @map("fecha_entrega")
  firmaRecibido       String?   @map("firma_recibido")

  estado SSTEstadoExamen @default(PROGRAMADO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  empleado          THEmpleado            @relation("SSTExamenEmpleado", fields: [empleadoId], references: [id])
  ipsRealiza        SSTProveedorMedico?   @relation(fields: [ipsRealizaId], references: [id])
  profesiograma     SSTProfesiograma?     @relation(fields: [profesiogramaId], references: [id])
  componentesExamen SSTComponenteExamen[]

  @@index([empleadoId])
  @@index([estado])
  @@index([fechaProximoExamen])
  @@map("sst_examenes_medicos")
}

model SSTComponenteExamen {
  id             String @id @default(uuid())
  examenMedicoId String @map("examen_medico_id")

  tipoComponente  SSTTipoComponenteExamen @map("tipo_componente")
  nombre          String
  resultado       String?
  valorReferencia String?                 @map("valor_referencia")
  interpretacion  String?
  observaciones   String?
  documentoUrl    String?                 @map("documento_url")

  createdAt DateTime @default(now()) @map("created_at")

  examenMedico SSTExamenMedico @relation(fields: [examenMedicoId], references: [id])

  @@map("sst_componentes_examen")
}

model SSTProfesiograma {
  id      String @id @default(uuid())
  cargoId String @map("cargo_id") // Obligatorio: cada cargo debe tener profesiograma

  nombre      String
  descripcion String?

  riesgosExpuestos Json @map("riesgos_expuestos")

  examenesIngreso    Json @map("examenes_ingreso")
  examenesPeriodicos Json @map("examenes_periodicos")
  periodicidadMeses  Int  @default(12) @map("periodicidad_meses")
  examenesRetiro     Json @map("examenes_retiro")

  requisitosEspeciales String? @map("requisitos_especiales") @db.Text
  contraindicaciones   String? @db.Text

  activo Boolean @default(true)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  cargo    THCargo           @relation(fields: [cargoId], references: [id])
  examenes SSTExamenMedico[]

  @@map("sst_profesiogramas")
}

model SSTProveedorMedico {
  id                  String   @id @default(uuid())
  nombre              String
  nit                 String   @unique
  direccion           String
  ciudad              String
  telefono            String
  email               String?
  licenciaSO          String   @map("licencia_so")
  fechaVencimientoLic DateTime @map("fecha_vencimiento_lic")
  serviciosOfrecidos  Json     @map("servicios_ofrecidos")

  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  examenes SSTExamenMedico[]

  @@map("sst_proveedores_medicos")
}

// ============ COPASST (Res. 2013/1986) ============

model SSTCopasst {
  id               String    @id @default(uuid())
  periodoInicio    DateTime  @map("periodo_inicio")
  periodoFin       DateTime  @map("periodo_fin")
  numeroResolucion String?   @map("numero_resolucion")
  fechaResolucion  DateTime? @map("fecha_resolucion")

  estado SSTEstadoCopasst @default(ACTIVO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  integrantes  SSTCopasstIntegrante[]
  reuniones    SSTCopasstReunion[]
  inspecciones SSTInspeccion[]

  @@map("sst_copasst")
}

model SSTCopasstIntegrante {
  id         String @id @default(uuid())
  copasstId  String @map("copasst_id")
  empleadoId String @map("empleado_id")

  tipoRepresentacion SSTTipoRepresentacion @map("tipo_representacion")
  cargo              SSTCargoCopasst
  fechaEleccion      DateTime              @map("fecha_eleccion")
  numeroVotos        Int?                  @map("numero_votos")
  esSuplente         Boolean               @default(false) @map("es_suplente")

  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")

  copasst     SSTCopasst            @relation(fields: [copasstId], references: [id])
  empleado    THEmpleado            @relation("SSTCopasstIntegrante", fields: [empleadoId], references: [id])
  asistencias SSTAsistenteReunion[]

  @@unique([copasstId, empleadoId])
  @@map("sst_copasst_integrantes")
}

model SSTCopasstReunion {
  id        String @id @default(uuid())
  copasstId String @map("copasst_id")

  tipoReunion SSTTipoReunionCopasst @map("tipo_reunion")
  numero      Int
  fecha       DateTime
  horaInicio  String                @map("hora_inicio")
  horaFin     String?               @map("hora_fin")
  lugar       String

  ordenDia        String @map("orden_dia") @db.Text
  desarrolloTemas String @map("desarrollo_temas") @db.Text

  actaUrl         String? @map("acta_url")
  firmaPresidente String? @map("firma_presidente")
  firmaSecretario String? @map("firma_secretario")

  estado SSTEstadoReunion @default(PROGRAMADA)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  copasst     SSTCopasst             @relation(fields: [copasstId], references: [id])
  asistentes  SSTAsistenteReunion[]
  compromisos SSTCompromisoReunion[]

  @@map("sst_copasst_reuniones")
}

model SSTAsistenteReunion {
  id            String  @id @default(uuid())
  reunionId     String  @map("reunion_id")
  integranteId  String? @map("integrante_id")
  nombreExterno String? @map("nombre_externo")
  asistio       Boolean @default(false)
  justificacion String?

  createdAt DateTime @default(now()) @map("created_at")

  reunion    SSTCopasstReunion     @relation(fields: [reunionId], references: [id])
  integrante SSTCopasstIntegrante? @relation(fields: [integranteId], references: [id])

  @@map("sst_asistentes_reunion")
}

model SSTCompromisoReunion {
  id        String @id @default(uuid())
  reunionId String @map("reunion_id")

  descripcion       String
  responsableId     String              @map("responsable_id")
  fechaLimite       DateTime            @map("fecha_limite")
  fechaCumplimiento DateTime?           @map("fecha_cumplimiento")
  evidencia         String?
  estado            SSTEstadoCompromiso @default(PENDIENTE)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  reunion     SSTCopasstReunion @relation(fields: [reunionId], references: [id])
  responsable THEmpleado        @relation("SSTCompromisoResponsable", fields: [responsableId], references: [id])

  @@map("sst_compromisos_reunion")
}

// ============ COMITE DE CONVIVENCIA LABORAL (Res. 3461/2025) ============

model SSTComiteConvivencia {
  id               String    @id @default(uuid())
  periodoInicio    DateTime  @map("periodo_inicio")
  periodoFin       DateTime  @map("periodo_fin")
  numeroResolucion String?   @map("numero_resolucion")
  fechaResolucion  DateTime? @map("fecha_resolucion")

  estado SSTEstadoCopasst @default(ACTIVO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  integrantes SSTCCLIntegrante[]
  reuniones   SSTCCLReunion[]
  quejas      SSTQuejaAcosoLaboral[]

  @@map("sst_comite_convivencia")
}

model SSTCCLIntegrante {
  id         String @id @default(uuid())
  comiteId   String @map("comite_id")
  empleadoId String @map("empleado_id")

  tipoRepresentacion SSTTipoRepresentacion @map("tipo_representacion")
  cargo              SSTCargoCCL
  esSuplente         Boolean               @default(false) @map("es_suplente")

  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")

  comite      SSTComiteConvivencia @relation(fields: [comiteId], references: [id])
  empleado    THEmpleado           @relation("SSTCCLIntegrante", fields: [empleadoId], references: [id])
  asistencias SSTCCLAsistente[]

  @@unique([comiteId, empleadoId])
  @@map("sst_ccl_integrantes")
}

model SSTCCLReunion {
  id       String @id @default(uuid())
  comiteId String @map("comite_id")

  tipoReunion SSTTipoReunionCopasst @map("tipo_reunion")
  numero      Int
  fecha       DateTime
  horaInicio  String                @map("hora_inicio")
  horaFin     String?               @map("hora_fin")
  lugar       String

  ordenDia        String @map("orden_dia") @db.Text
  desarrolloTemas String @map("desarrollo_temas") @db.Text

  actaUrl         String? @map("acta_url")
  firmaPresidente String? @map("firma_presidente")
  firmaSecretario String? @map("firma_secretario")

  estado SSTEstadoReunion @default(PROGRAMADA)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  comite      SSTComiteConvivencia @relation(fields: [comiteId], references: [id])
  asistentes  SSTCCLAsistente[]
  compromisos SSTCCLCompromiso[]

  @@map("sst_ccl_reuniones")
}

model SSTCCLAsistente {
  id            String  @id @default(uuid())
  reunionId     String  @map("reunion_id")
  integranteId  String? @map("integrante_id")
  asistio       Boolean @default(false)
  justificacion String?

  createdAt DateTime @default(now()) @map("created_at")

  reunion    SSTCCLReunion     @relation(fields: [reunionId], references: [id])
  integrante SSTCCLIntegrante? @relation(fields: [integranteId], references: [id])

  @@map("sst_ccl_asistentes")
}

model SSTCCLCompromiso {
  id        String @id @default(uuid())
  reunionId String @map("reunion_id")

  descripcion       String
  responsableId     String              @map("responsable_id")
  fechaLimite       DateTime            @map("fecha_limite")
  fechaCumplimiento DateTime?           @map("fecha_cumplimiento")
  estado            SSTEstadoCompromiso @default(PENDIENTE)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  reunion     SSTCCLReunion @relation(fields: [reunionId], references: [id])
  responsable THEmpleado    @relation("SSTCCLCompromisoResponsable", fields: [responsableId], references: [id])

  @@map("sst_ccl_compromisos")
}

// ============ QUEJAS ACOSO LABORAL (Ley 1010/2006) ============

model SSTQuejaAcosoLaboral {
  id       String @id @default(uuid())
  comiteId String @map("comite_id")

  esAnonima Boolean @default(false) @map("es_anonima")
  quejosoId String? @map("quejoso_id")
  acusadoId String  @map("acusado_id")

  fechaHechos       DateTime     @map("fecha_hechos")
  tipoAcoso         SSTTipoAcoso @map("tipo_acoso")
  descripcionHechos String       @map("descripcion_hechos") @db.Text
  pruebasAportadas  String?      @map("pruebas_aportadas") @db.Text
  documentosUrl     Json?        @map("documentos_url")

  fechaRecepcion           DateTime  @default(now()) @map("fecha_recepcion")
  fechaNotificacionAcusado DateTime? @map("fecha_notificacion_acusado")
  descargosAcusado         String?   @map("descargos_acusado") @db.Text
  fechaDescargos           DateTime? @map("fecha_descargos")

  huboAudiencia      Boolean   @default(false) @map("hubo_audiencia")
  fechaAudiencia     DateTime? @map("fecha_audiencia")
  resultadoAudiencia String?   @map("resultado_audiencia") @db.Text
  acuerdosAlcanzados String?   @map("acuerdos_alcanzados") @db.Text

  fechaDecision      DateTime?         @map("fecha_decision")
  decision           SSTDecisionQueja?
  motivosDecision    String?           @map("motivos_decision") @db.Text
  medidasCorrectivas String?           @map("medidas_correctivas") @db.Text

  trasladoAutoridad Boolean   @default(false) @map("traslado_autoridad")
  entidadTraslado   String?   @map("entidad_traslado")
  fechaTraslado     DateTime? @map("fecha_traslado")

  estado SSTEstadoQueja @default(RECIBIDA)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  comite       SSTComiteConvivencia       @relation(fields: [comiteId], references: [id])
  quejoso      THEmpleado?                @relation("SSTQuejaQuejoso", fields: [quejosoId], references: [id])
  acusado      THEmpleado                 @relation("SSTQuejaAcusado", fields: [acusadoId], references: [id])
  seguimientos SSTSeguimientoQuejaAcoso[]

  @@index([estado])
  @@map("sst_quejas_acoso_laboral")
}

// ============ PLAN ANUAL DE TRABAJO SST ============

model SSTPlanAnualTrabajo {
  id      String @id @default(uuid())
  ano     Int
  version Int    @default(1)

  objetivoGeneral      String @map("objetivo_general") @db.Text
  objetivosEspecificos Json   @map("objetivos_especificos")

  presupuestoTotal Decimal @map("presupuesto_total") @db.Decimal(15, 2)
  recursosHumanos  String? @map("recursos_humanos") @db.Text
  recursosTecnicos String? @map("recursos_tecnicos") @db.Text

  fechaElaboracion DateTime  @map("fecha_elaboracion")
  elaboradoPorId   String    @map("elaborado_por_id")
  aprobadoPorId    String?   @map("aprobado_por_id")
  fechaAprobacion  DateTime? @map("fecha_aprobacion")

  estado SSTEstadoPlan @default(BORRADOR)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  elaboradoPor THEmpleado         @relation("SSTPlanElaborador", fields: [elaboradoPorId], references: [id])
  aprobadoPor  THEmpleado?        @relation("SSTPlanAprobador", fields: [aprobadoPorId], references: [id])
  metas        SSTMetaPlan[]
  actividades  SSTActividadPlan[]

  @@unique([ano, version])
  @@map("sst_plan_anual_trabajo")
}

model SSTMetaPlan {
  id     String @id @default(uuid())
  planId String @map("plan_id")

  descripcion String
  indicadorId String? @map("indicador_id")
  metaValor   Decimal @map("meta_valor") @db.Decimal(10, 2)
  metaUnidad  String  @map("meta_unidad")

  createdAt DateTime @default(now()) @map("created_at")

  plan      SSTPlanAnualTrabajo @relation(fields: [planId], references: [id])
  indicador SSTIndicador?       @relation(fields: [indicadorId], references: [id])

  @@map("sst_metas_plan")
}

model SSTActividadPlan {
  id     String @id @default(uuid())
  planId String @map("plan_id")

  pilarSGSST    SSTPilarSGSST    @map("pilar_sgsst")
  tipoActividad SSTTipoActividad @map("tipo_actividad")

  nombre      String
  descripcion String @db.Text
  objetivo    String

  mesProgramado         Int       @map("mes_programado")
  fechaInicioProgramada DateTime? @map("fecha_inicio_programada")
  fechaFinProgramada    DateTime? @map("fecha_fin_programada")
  fechaEjecucionReal    DateTime? @map("fecha_ejecucion_real")

  responsableId String @map("responsable_id")

  presupuesto        Decimal? @db.Decimal(15, 2)
  recursosRequeridos String?  @map("recursos_requeridos")

  porcentajeAvance Int     @default(0) @map("porcentaje_avance")
  observaciones    String? @db.Text

  estado SSTEstadoActividad @default(PROGRAMADA)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  plan           SSTPlanAnualTrabajo     @relation(fields: [planId], references: [id])
  responsable    THEmpleado              @relation("SSTActividadResponsable", fields: [responsableId], references: [id])
  evidencias     SSTEvidenciaActividad[]
  capacitaciones SSTCapacitacionSST[]
  inspecciones   SSTInspeccion[]         @relation("SSTInspeccionActividad")
  simulacros     SSTSimulacro[]

  @@map("sst_actividades_plan")
}

model SSTEvidenciaActividad {
  id          String @id @default(uuid())
  actividadId String @map("actividad_id")

  tipo        String
  nombre      String
  url         String
  descripcion String?

  createdAt DateTime @default(now()) @map("created_at")

  actividad SSTActividadPlan @relation(fields: [actividadId], references: [id])

  @@map("sst_evidencias_actividad")
}

// ============ CAPACITACIONES SST ============

model SSTCapacitacionSST {
  id              String  @id @default(uuid())
  actividadPlanId String? @map("actividad_plan_id")

  // Puente con RRHH: Si la capacitaciÃ³n SST se sincroniza con THCapacitacion
  capacitacionRRHHId String? @unique @map("capacitacion_rrhh_id")

  nombre           String
  descripcion      String?                  @db.Text
  tipoCapacitacion SSTTipoCapacitacion      @map("tipo_capacitacion")
  modalidad        SSTModalidadCapacitacion

  fechaProgramada   DateTime @map("fecha_programada")
  horaInicio        String   @map("hora_inicio")
  horaFin           String?  @map("hora_fin")
  duracionHoras     Decimal  @map("duracion_horas") @db.Decimal(5, 2)
  lugar             String?
  plataformaVirtual String?  @map("plataforma_virtual")

  facilitadorInterno Boolean @default(true) @map("facilitador_interno")
  facilitadorId      String? @map("facilitador_id")
  facilitadorExterno String? @map("facilitador_externo")
  facilitadorEmpresa String? @map("facilitador_empresa")

  objetivos   String  @db.Text
  temas       Json
  materialUrl String? @map("material_url")

  requiereEvaluacion Boolean @default(false) @map("requiere_evaluacion")

  listaAsistenciaUrl String? @map("lista_asistencia_url")
  fotosUrl           Json?   @map("fotos_url")
  certificadoBaseUrl String? @map("certificado_base_url")

  estado SSTEstadoCapacitacionSST @default(PROGRAMADA)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  actividadPlan    SSTActividadPlan?              @relation(fields: [actividadPlanId], references: [id])
  facilitador      THEmpleado?                    @relation("SSTCapacitacionFacilitador", fields: [facilitadorId], references: [id])
  capacitacionRRHH THCapacitacion?                @relation(fields: [capacitacionRRHHId], references: [id])
  asistentes       SSTAsistenteCapacitacionSST[]
  evaluaciones     SSTEvaluacionCapacitacionSST[]

  @@map("sst_capacitaciones")
}

model SSTAsistenteCapacitacionSST {
  id             String @id @default(uuid())
  capacitacionId String @map("capacitacion_id")
  empleadoId     String @map("empleado_id")

  asistio     Boolean @default(false)
  horaLlegada String? @map("hora_llegada")
  horaSalida  String? @map("hora_salida")
  firma       String?

  createdAt DateTime @default(now()) @map("created_at")

  capacitacion SSTCapacitacionSST @relation(fields: [capacitacionId], references: [id])
  empleado     THEmpleado         @relation("SSTAsistenteCapacitacionSST", fields: [empleadoId], references: [id])

  @@unique([capacitacionId, empleadoId])
  @@map("sst_asistentes_capacitacion")
}

model SSTEvaluacionCapacitacionSST {
  id             String @id @default(uuid())
  capacitacionId String @map("capacitacion_id")
  empleadoId     String @map("empleado_id")

  calificacion       Decimal @db.Decimal(5, 2)
  calificacionMaxima Decimal @default(100) @map("calificacion_maxima") @db.Decimal(5, 2)
  aprobado           Boolean @default(false)
  observaciones      String?

  createdAt DateTime @default(now()) @map("created_at")

  capacitacion SSTCapacitacionSST @relation(fields: [capacitacionId], references: [id])
  empleado     THEmpleado         @relation("SSTEvaluacionCapacitacionSST", fields: [empleadoId], references: [id])

  @@unique([capacitacionId, empleadoId])
  @@map("sst_evaluaciones_capacitacion")
}

// ============ INSPECCIONES DE SEGURIDAD ============

model SSTInspeccion {
  id              String  @id @default(uuid())
  copasstId       String? @map("copasst_id")
  actividadPlanId String? @map("actividad_plan_id")

  tipoInspeccion    SSTTipoInspeccion @map("tipo_inspeccion")
  areaInspeccionada String            @map("area_inspeccionada")
  fecha             DateTime
  horaInicio        String            @map("hora_inicio")
  horaFin           String?           @map("hora_fin")

  inspectorPrincipalId String @map("inspector_principal_id")

  listaVerificacionId String? @map("lista_verificacion_id")

  observacionesGenerales String?  @map("observaciones_generales") @db.Text
  calificacionGeneral    Decimal? @map("calificacion_general") @db.Decimal(5, 2)

  informeUrl String? @map("informe_url")
  fotosUrl   Json?   @map("fotos_url")

  estado SSTEstadoInspeccion @default(PROGRAMADA)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  copasst                SSTCopasst?             @relation(fields: [copasstId], references: [id])
  actividadPlan          SSTActividadPlan?       @relation("SSTInspeccionActividad", fields: [actividadPlanId], references: [id])
  inspectorPrincipal     THEmpleado              @relation("SSTInspectorPrincipal", fields: [inspectorPrincipalId], references: [id])
  listaVerificacion      SSTListaVerificacion?   @relation(fields: [listaVerificacionId], references: [id])
  inspectoresAdicionales SSTInspectorAdicional[]
  hallazgos              SSTHallazgoInspeccion[]

  @@map("sst_inspecciones")
}

model SSTInspectorAdicional {
  id           String @id @default(uuid())
  inspeccionId String @map("inspeccion_id")
  empleadoId   String @map("empleado_id")

  createdAt DateTime @default(now()) @map("created_at")

  inspeccion SSTInspeccion @relation(fields: [inspeccionId], references: [id])
  empleado   THEmpleado    @relation("SSTInspectorAdicional", fields: [empleadoId], references: [id])

  @@unique([inspeccionId, empleadoId])
  @@map("sst_inspectores_adicionales")
}

model SSTHallazgoInspeccion {
  id           String @id @default(uuid())
  inspeccionId String @map("inspeccion_id")

  descripcion         String
  ubicacionEspecifica String?                  @map("ubicacion_especifica")
  tipoHallazgo        SSTTipoHallazgo          @map("tipo_hallazgo")
  clasificacion       SSTClasificacionHallazgo
  fotoUrl             String?                  @map("foto_url")

  accionCorrectiva   String?   @map("accion_correctiva")
  responsableId      String?   @map("responsable_id")
  fechaLimite        DateTime? @map("fecha_limite")
  fechaCierre        DateTime? @map("fecha_cierre")
  evidenciaCierreUrl String?   @map("evidencia_cierre_url")

  estado SSTEstadoHallazgo @default(ABIERTO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  inspeccion  SSTInspeccion @relation(fields: [inspeccionId], references: [id])
  responsable THEmpleado?   @relation("SSTHallazgoResponsable", fields: [responsableId], references: [id])

  @@map("sst_hallazgos_inspeccion")
}

model SSTListaVerificacion {
  id             String            @id @default(uuid())
  nombre         String
  tipoInspeccion SSTTipoInspeccion @map("tipo_inspeccion")
  descripcion    String?
  version        Int               @default(1)

  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  items        SSTItemListaVerificacion[]
  inspecciones SSTInspeccion[]

  @@map("sst_listas_verificacion")
}

model SSTItemListaVerificacion {
  id      String @id @default(uuid())
  listaId String @map("lista_id")

  orden              Int
  categoria          String?
  aspecto            String
  criterioEvaluacion String?  @map("criterio_evaluacion")
  pesoPonderacion    Decimal? @map("peso_ponderacion") @db.Decimal(5, 2)

  createdAt DateTime @default(now()) @map("created_at")

  lista SSTListaVerificacion @relation(fields: [listaId], references: [id])

  @@map("sst_items_lista_verificacion")
}

// ============ INDICADORES SST (Res. 0312/2019) ============

model SSTIndicador {
  id                 String                @id @default(uuid())
  codigo             String                @unique
  nombre             String
  tipoIndicador      SSTTipoIndicador      @map("tipo_indicador")
  categoriaIndicador SSTCategoriaIndicador @map("categoria_indicador")

  formula            String
  descripcionFormula String @map("descripcion_formula") @db.Text
  unidadMedida       String @map("unidad_medida")

  metaAnual          Decimal?              @map("meta_anual") @db.Decimal(10, 2)
  frecuenciaMedicion SSTFrecuenciaMedicion @map("frecuencia_medicion")

  fuenteNumerador   String  @map("fuente_numerador")
  fuenteDenominador String? @map("fuente_denominador")

  interpretacion String @db.Text

  valorMinimo Decimal? @map("valor_minimo") @db.Decimal(10, 2)
  valorMaximo Decimal? @map("valor_maximo") @db.Decimal(10, 2)
  valorAlerta Decimal? @map("valor_alerta") @db.Decimal(10, 2)

  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  mediciones SSTMedicionIndicador[]
  metas      SSTMetaPlan[]

  @@map("sst_indicadores")
}

model SSTMedicionIndicador {
  id          String @id @default(uuid())
  indicadorId String @map("indicador_id")

  periodo   String
  ano       Int
  mes       Int?
  trimestre Int?

  valorNumerador   Decimal @map("valor_numerador") @db.Decimal(15, 2)
  valorDenominador Decimal @map("valor_denominador") @db.Decimal(15, 2)
  valorCalculado   Decimal @map("valor_calculado") @db.Decimal(15, 4)

  cumpleMeta    Boolean? @map("cumple_meta")
  analisis      String?  @db.Text
  accionesTomar String?  @map("acciones_tomar") @db.Text

  registradoPorId String @map("registrado_por_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  indicador     SSTIndicador @relation(fields: [indicadorId], references: [id])
  registradoPor THEmpleado   @relation("SSTMedicionRegistrador", fields: [registradoPorId], references: [id])

  @@unique([indicadorId, periodo])
  @@map("sst_mediciones_indicador")
}

// ============ EPP Y DOTACION ============

model SSTElementoEPP {
  id             String          @id @default(uuid())
  codigo         String          @unique
  nombre         String
  categoria      SSTCategoriaEPP
  descripcion    String?
  normaAplicable String?         @map("norma_aplicable")
  vidaUtilMeses  Int?            @map("vida_util_meses")

  stockMinimo Int @default(0) @map("stock_minimo")
  stockActual Int @default(0) @map("stock_actual")

  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  entregas SSTEntregaEPP[]

  @@map("sst_elementos_epp")
}

model SSTEntregaEPP {
  id         String @id @default(uuid())
  empleadoId String @map("empleado_id")
  elementoId String @map("elemento_id")

  fechaEntrega     DateTime  @map("fecha_entrega")
  cantidad         Int       @default(1)
  talla            String?
  lote             String?
  fechaVencimiento DateTime? @map("fecha_vencimiento")

  motivoEntrega SSTMotivoEntregaEPP @map("motivo_entrega")
  observaciones String?

  firmaEmpleado   String? @map("firma_empleado")
  firmaEntregador String? @map("firma_entregador")
  entregadoPorId  String  @map("entregado_por_id")

  devuelto         Boolean   @default(false)
  fechaDevolucion  DateTime? @map("fecha_devolucion")
  estadoDevolucion String?   @map("estado_devolucion")

  createdAt DateTime @default(now()) @map("created_at")

  empleado     THEmpleado     @relation("SSTEntregaEPPEmpleado", fields: [empleadoId], references: [id])
  elemento     SSTElementoEPP @relation(fields: [elementoId], references: [id])
  entregadoPor THEmpleado     @relation("SSTEntregaEPPEntregador", fields: [entregadoPorId], references: [id])

  @@index([empleadoId])
  @@map("sst_entregas_epp")
}

// ============ PLAN DE EMERGENCIAS ============

model SSTPlanEmergencias {
  id                 String    @id @default(uuid())
  version            Int       @default(1)
  fechaElaboracion   DateTime  @map("fecha_elaboracion")
  fechaActualizacion DateTime? @map("fecha_actualizacion")

  analisisAmenazas       Json @map("analisis_amenazas")
  analisisVulnerabilidad Json @map("analisis_vulnerabilidad")
  nivelRiesgo            Json @map("nivel_riesgo")

  procedimientosOperativos Json @map("procedimientos_operativos")

  recursosInternos Json @map("recursos_internos")
  recursosExternos Json @map("recursos_externos")

  rutasEvacuacion Json    @map("rutas_evacuacion")
  puntosEncuentro Json    @map("puntos_encuentro")
  planosUrl       String? @map("planos_url")

  documentoUrl String? @map("documento_url")

  estado SSTEstadoPlanEmergencia @default(BORRADOR)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  brigada    SSTBrigadaEmergencia?
  simulacros SSTSimulacro[]

  @@map("sst_plan_emergencias")
}

model SSTBrigadaEmergencia {
  id                String @id @default(uuid())
  planEmergenciasId String @unique @map("plan_emergencias_id")

  jefeId String @map("jefe_id")

  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  planEmergencias       SSTPlanEmergencias       @relation(fields: [planEmergenciasId], references: [id])
  jefe                  THEmpleado               @relation("SSTBrigadaJefe", fields: [jefeId], references: [id])
  miembros              SSTMiembroBrigada[]
  capacitacionesBrigada SSTCapacitacionBrigada[]

  @@map("sst_brigadas_emergencia")
}

model SSTMiembroBrigada {
  id         String @id @default(uuid())
  brigadaId  String @map("brigada_id")
  empleadoId String @map("empleado_id")

  rol                SSTRolBrigada
  grupoEspecializado SSTGrupoBrigada? @map("grupo_especializado")

  certificacionPrimerosAuxilios Boolean   @default(false) @map("certificacion_primeros_auxilios")
  fechaCertPrimerosAuxilios     DateTime? @map("fecha_cert_primeros_auxilios")
  certificacionExtintores       Boolean   @default(false) @map("certificacion_extintores")
  fechaCertExtintores           DateTime? @map("fecha_cert_extintores")
  certificacionEvacuacion       Boolean   @default(false) @map("certificacion_evacuacion")
  fechaCertEvacuacion           DateTime? @map("fecha_cert_evacuacion")

  activo    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")

  brigada  SSTBrigadaEmergencia @relation(fields: [brigadaId], references: [id])
  empleado THEmpleado           @relation("SSTMiembroBrigada", fields: [empleadoId], references: [id])

  @@unique([brigadaId, empleadoId])
  @@map("sst_miembros_brigada")
}

model SSTCapacitacionBrigada {
  id        String @id @default(uuid())
  brigadaId String @map("brigada_id")

  tema           String
  fecha          DateTime
  duracionHoras  Decimal  @map("duracion_horas") @db.Decimal(4, 2)
  facilitador    String
  participantes  Json
  certificadoUrl String?  @map("certificado_url")

  createdAt DateTime @default(now()) @map("created_at")

  brigada SSTBrigadaEmergencia @relation(fields: [brigadaId], references: [id])

  @@map("sst_capacitaciones_brigada")
}

// ============ SIMULACROS ============

model SSTSimulacro {
  id                String  @id @default(uuid())
  planEmergenciasId String? @map("plan_emergencias_id")
  actividadPlanId   String? @map("actividad_plan_id")
  coordinadorId     String  @map("coordinador_id")

  tipoSimulacro  SSTTipoSimulacro    @map("tipo_simulacro")
  alcance        SSTAlcanceSimulacro
  areasCubiertas Json                @map("areas_cubiertas")

  fechaProgramada DateTime  @map("fecha_programada")
  fechaEjecucion  DateTime? @map("fecha_ejecucion")
  horaInicio      String    @map("hora_inicio")
  horaFin         String?   @map("hora_fin")

  escenarioSimulado String @map("escenario_simulado") @db.Text
  hipotesis         String @db.Text

  totalTrabajadores       Int      @map("total_trabajadores")
  cantidadParticipantes   Int?     @map("cantidad_participantes")
  porcentajeParticipacion Decimal? @map("porcentaje_participacion") @db.Decimal(5, 2)

  tiempoEvacuacionMin       Decimal? @map("tiempo_evacuacion_min") @db.Decimal(5, 2)
  tiempoRespuestaBrigadaMin Decimal? @map("tiempo_respuesta_brigada_min") @db.Decimal(5, 2)

  evaluacion        String? @db.Text
  aspectosPositivos String? @map("aspectos_positivos") @db.Text
  aspectosMejorar   String? @map("aspectos_mejorar") @db.Text

  fotosUrl   Json?   @map("fotos_url")
  videoUrl   String? @map("video_url")
  informeUrl String? @map("informe_url")

  estado SSTEstadoSimulacro @default(PROGRAMADO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  planEmergencias SSTPlanEmergencias?        @relation(fields: [planEmergenciasId], references: [id])
  actividadPlan   SSTActividadPlan?          @relation(fields: [actividadPlanId], references: [id])
  coordinador     THEmpleado                 @relation("SSTSimulacroCoordinador", fields: [coordinadorId], references: [id])
  accionesMejora  SSTAccionMejoraSimulacro[]
  participantes   SSTParticipanteSimulacro[]

  @@index([coordinadorId])
  @@map("sst_simulacros")
}

model SSTAccionMejoraSimulacro {
  id          String @id @default(uuid())
  simulacroId String @map("simulacro_id")

  descripcion       String
  responsableId     String              @map("responsable_id")
  fechaLimite       DateTime            @map("fecha_limite")
  fechaCumplimiento DateTime?           @map("fecha_cumplimiento")
  estado            SSTEstadoCompromiso @default(PENDIENTE)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  simulacro   SSTSimulacro @relation(fields: [simulacroId], references: [id])
  responsable THEmpleado   @relation("SSTAccionMejoraSimulacroResponsable", fields: [responsableId], references: [id])

  @@map("sst_acciones_mejora_simulacro")
}

// ============ DOCUMENTOS SG-SST ============

model SSTDocumentoSST {
  id                 String                @id @default(uuid())
  codigo             String                @unique
  nombre             String
  tipoDocumento      SSTTipoDocumento      @map("tipo_documento")
  categoriaDocumento SSTCategoriaDocumento @map("categoria_documento")

  version          Int       @default(1)
  fechaElaboracion DateTime  @map("fecha_elaboracion")
  fechaAprobacion  DateTime? @map("fecha_aprobacion")
  fechaVigencia    DateTime  @map("fecha_vigencia")
  fechaVencimiento DateTime? @map("fecha_vencimiento") // Fecha en que expira el documento
  alertaDias       Int       @default(30) @map("alerta_dias") // DÃ­as antes de vencimiento para alertar

  elaboradoPorId String  @map("elaborado_por_id")
  revisadoPorId  String? @map("revisado_por_id")
  aprobadoPorId  String? @map("aprobado_por_id")

  archivoUrl String @map("archivo_url")

  estado SSTEstadoDocumento @default(BORRADOR)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  elaboradoPor       THEmpleado              @relation("SSTDocumentoElaborador", fields: [elaboradoPorId], references: [id])
  revisadoPor        THEmpleado?             @relation("SSTDocumentoRevisor", fields: [revisadoPorId], references: [id])
  aprobadoPor        THEmpleado?             @relation("SSTDocumentoAprobador", fields: [aprobadoPorId], references: [id])
  historialVersiones SSTHistorialDocumento[]

  @@map("sst_documentos")
}

model SSTHistorialDocumento {
  id          String @id @default(uuid())
  documentoId String @map("documento_id")

  versionAnterior    Int      @map("version_anterior")
  fechaCambio        DateTime @map("fecha_cambio")
  descripcionCambio  String   @map("descripcion_cambio") @db.Text
  archivoAnteriorUrl String?  @map("archivo_anterior_url")
  modificadoPorId    String   @map("modificado_por_id")

  createdAt DateTime @default(now()) @map("created_at")

  documento     SSTDocumentoSST @relation(fields: [documentoId], references: [id])
  modificadoPor THEmpleado      @relation("SSTHistorialModificador", fields: [modificadoPorId], references: [id])

  @@map("sst_historial_documentos")
}

// ============ AUDITORIAS SG-SST ============

model SSTAuditoria {
  id            String           @id @default(uuid())
  ano           Int
  tipoAuditoria SSTTipoAuditoria @map("tipo_auditoria")

  alcance            String @db.Text
  criteriosAuditoria String @map("criterios_auditoria") @db.Text
  procesosAuditados  Json   @map("procesos_auditados")

  fechaProgramada DateTime  @map("fecha_programada")
  fechaEjecucion  DateTime? @map("fecha_ejecucion")
  fechaCierre     DateTime? @map("fecha_cierre")

  auditorLiderId String @map("auditor_lider_id")

  planAuditoriaUrl String? @map("plan_auditoria_url")

  resumenEjecutivo String? @map("resumen_ejecutivo") @db.Text
  conclusiones     String? @db.Text
  informeUrl       String? @map("informe_url")

  estado SSTEstadoAuditoria @default(PROGRAMADA)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  auditorLider  THEmpleado             @relation("SSTAuditorLider", fields: [auditorLiderId], references: [id])
  equipoAuditor SSTAuditorEquipo[]
  hallazgos     SSTHallazgoAuditoria[]

  @@map("sst_auditorias")
}

model SSTAuditorEquipo {
  id          String @id @default(uuid())
  auditoriaId String @map("auditoria_id")
  auditorId   String @map("auditor_id")
  rol         String

  createdAt DateTime @default(now()) @map("created_at")

  auditoria SSTAuditoria @relation(fields: [auditoriaId], references: [id])
  auditor   THEmpleado   @relation("SSTAuditorEquipo", fields: [auditorId], references: [id])

  @@unique([auditoriaId, auditorId])
  @@map("sst_auditores_equipo")
}

model SSTHallazgoAuditoria {
  id          String @id @default(uuid())
  auditoriaId String @map("auditoria_id")

  tipoHallazgo        SSTTipoHallazgoAuditoria @map("tipo_hallazgo")
  requisitoIncumplido String                   @map("requisito_incumplido")
  procesoAfectado     String                   @map("proceso_afectado")

  descripcion       String @db.Text
  evidenciaObjetiva String @map("evidencia_objetiva") @db.Text
  evidenciasUrl     Json?  @map("evidencias_url")

  estado SSTEstadoHallazgoAuditoria @default(ABIERTO)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  auditoria        SSTAuditoria         @relation(fields: [auditoriaId], references: [id])
  accionCorrectiva SSTAccionCorrectiva?

  @@map("sst_hallazgos_auditoria")
}

// ============ ACCIONES CORRECTIVAS / PREVENTIVAS / MEJORA ============

model SSTAccionCorrectiva {
  id                  String  @id @default(uuid())
  hallazgoAuditoriaId String? @unique @map("hallazgo_auditoria_id")

  origen            SSTOrigenAccion
  descripcionOrigen String?         @map("descripcion_origen")

  analisisCausaRaiz   String  @map("analisis_causa_raiz") @db.Text
  metodologiaAnalisis String? @map("metodologia_analisis")

  descripcionAccion   String        @map("descripcion_accion") @db.Text
  tipoAccion          SSTTipoAccion @map("tipo_accion")
  responsableId       String        @map("responsable_id")
  fechaProgramada     DateTime      @map("fecha_programada")
  fechaImplementacion DateTime?     @map("fecha_implementacion")

  recursosRequeridos String?  @map("recursos_requeridos")
  presupuesto        Decimal? @db.Decimal(15, 2)

  fechaVerificacion     DateTime? @map("fecha_verificacion")
  verificadoPorId       String?   @map("verificado_por_id")
  resultadoVerificacion String?   @map("resultado_verificacion") @db.Text
  esEficaz              Boolean?  @map("es_eficaz")

  evidenciasUrl Json? @map("evidencias_url")

  estado SSTEstadoAccionCorrectiva @default(ABIERTA)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  hallazgoAuditoria SSTHallazgoAuditoria? @relation(fields: [hallazgoAuditoriaId], references: [id])
  responsable       THEmpleado            @relation("SSTAccionResponsable", fields: [responsableId], references: [id])
  verificadoPor     THEmpleado?           @relation("SSTAccionVerificador", fields: [verificadoPorId], references: [id])

  @@map("sst_acciones_correctivas")
}

// ============ EVALUACION ESTANDARES MINIMOS (Res. 0312/2019) ============

model SSTEvaluacionEstandares {
  id              String   @id @default(uuid())
  ano             Int
  fechaEvaluacion DateTime @map("fecha_evaluacion")

  tamanoEmpresa SSTTamanoEmpresa  @map("tamano_empresa")
  nivelRiesgo   SSTNivelRiesgoARL @map("nivel_riesgo")

  evaluadorId String @map("evaluador_id")

  puntajeTotal Decimal               @map("puntaje_total") @db.Decimal(5, 2)
  valoracion   SSTValoracionEstandar

  documentoUrl String? @map("documento_url")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  evaluador        THEmpleado                   @relation("SSTEvaluacionEvaluador", fields: [evaluadorId], references: [id])
  ciclosPHVA       SSTEvaluacionCiclo[]
  items            SSTItemEvaluacionEstandar[]
  planMejoramiento SSTPlanMejoramientoEstandar?

  @@unique([ano])
  @@map("sst_evaluacion_estandares")
}

model SSTEvaluacionCiclo {
  id           String @id @default(uuid())
  evaluacionId String @map("evaluacion_id")

  ciclo                  SSTCicloPHVA
  puntajeMaximo          Decimal      @map("puntaje_maximo") @db.Decimal(5, 2)
  puntajeObtenido        Decimal      @map("puntaje_obtenido") @db.Decimal(5, 2)
  porcentajeCumplimiento Decimal      @map("porcentaje_cumplimiento") @db.Decimal(5, 2)

  createdAt DateTime @default(now()) @map("created_at")

  evaluacion SSTEvaluacionEstandares @relation(fields: [evaluacionId], references: [id])

  @@unique([evaluacionId, ciclo])
  @@map("sst_evaluacion_ciclos")
}

model SSTItemEvaluacionEstandar {
  id           String @id @default(uuid())
  evaluacionId String @map("evaluacion_id")

  ciclo          SSTCicloPHVA
  numeral        String
  estandar       String
  itemEvaluacion String       @map("item_evaluacion")

  puntajeMaximo   Decimal @map("puntaje_maximo") @db.Decimal(5, 2)
  puntajeObtenido Decimal @map("puntaje_obtenido") @db.Decimal(5, 2)

  cumple        SSTCumplimientoEstandar
  justificacion String?                 @db.Text
  evidenciaUrl  String?                 @map("evidencia_url")

  observaciones String? @db.Text

  createdAt DateTime @default(now()) @map("created_at")

  evaluacion     SSTEvaluacionEstandares         @relation(fields: [evaluacionId], references: [id])
  accionesMejora SSTAccionMejoramientoEstandar[]

  @@map("sst_items_evaluacion_estandar")
}

model SSTPlanMejoramientoEstandar {
  id           String @id @default(uuid())
  evaluacionId String @unique @map("evaluacion_id")

  enviadoARL    Boolean   @default(false) @map("enviado_arl")
  fechaEnvioARL DateTime? @map("fecha_envio_arl")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  evaluacion SSTEvaluacionEstandares         @relation(fields: [evaluacionId], references: [id])
  acciones   SSTAccionMejoramientoEstandar[]

  @@map("sst_plan_mejoramiento_estandar")
}

model SSTAccionMejoramientoEstandar {
  id               String @id @default(uuid())
  planId           String @map("plan_id")
  itemEvaluacionId String @map("item_evaluacion_id")

  accionMejora      String              @map("accion_mejora") @db.Text
  responsableId     String              @map("responsable_id")
  fechaProgramada   DateTime            @map("fecha_programada")
  fechaCumplimiento DateTime?           @map("fecha_cumplimiento")
  evidenciaUrl      String?             @map("evidencia_url")
  estado            SSTEstadoCompromiso @default(PENDIENTE)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  plan           SSTPlanMejoramientoEstandar @relation(fields: [planId], references: [id])
  itemEvaluacion SSTItemEvaluacionEstandar   @relation(fields: [itemEvaluacionId], references: [id])
  responsable    THEmpleado                  @relation("SSTAccionMejoramientoResponsable", fields: [responsableId], references: [id])

  @@map("sst_acciones_mejoramiento_estandar")
}

// ============ CONFIGURACION SST ============

model SSTConfiguracion {
  id String @id @default(uuid())

  nombreResponsableSST String  @map("nombre_responsable_sst")
  cargoResponsableSST  String  @map("cargo_responsable_sst")
  licenciaSO           String? @map("licencia_so")
  arlNombre            String  @map("arl_nombre")
  arlNit               String  @map("arl_nit")
  numeroPolizaARL      String? @map("numero_poliza_arl")

  politicaSSTUrl   String?   @map("politica_sst_url")
  fechaPoliticaSST DateTime? @map("fecha_politica_sst")
  versionPolitica  Int       @default(1) @map("version_politica")

  objetivosSSTUrl String? @map("objetivos_sst_url")

  certificaciones Json?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("sst_configuracion")
}

// ============ MODELOS ADICIONALES SST ============

// Testigos de accidentes de trabajo
model SSTTestigoAccidente {
  id          String  @id @default(uuid())
  accidenteId String  @map("accidente_id")
  empleadoId  String? @map("empleado_id")

  // Si no es empleado de la empresa
  nombreTestigo    String? @map("nombre_testigo")
  documentoTestigo String? @map("documento_testigo")
  telefonoTestigo  String? @map("telefono_testigo")
  cargoTestigo     String? @map("cargo_testigo")
  empresaTestigo   String? @map("empresa_testigo")

  declaracion      String?   @db.Text
  fechaDeclaracion DateTime? @map("fecha_declaracion")
  firmaUrl         String?   @map("firma_url")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  accidente SSTAccidenteTrabajo @relation(fields: [accidenteId], references: [id])
  empleado  THEmpleado?         @relation("SSTTestigoEmpleado", fields: [empleadoId], references: [id])

  @@map("sst_testigos_accidente")
}

// Seguimiento de quejas por acoso laboral
model SSTSeguimientoQuejaAcoso {
  id            String @id @default(uuid())
  quejaId       String @map("queja_id")
  responsableId String @map("responsable_id")

  fechaSeguimiento   DateTime @map("fecha_seguimiento")
  tipoSeguimiento    String   @map("tipo_seguimiento")
  descripcion        String   @db.Text
  acuerdosAlcanzados String?  @map("acuerdos_alcanzados") @db.Text

  documentoUrl String? @map("documento_url")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  queja       SSTQuejaAcosoLaboral @relation(fields: [quejaId], references: [id])
  responsable THEmpleado           @relation("SSTSeguimientoQuejaResp", fields: [responsableId], references: [id])

  @@map("sst_seguimientos_queja_acoso")
}

// Participantes en simulacros
model SSTParticipanteSimulacro {
  id          String @id @default(uuid())
  simulacroId String @map("simulacro_id")
  empleadoId  String @map("empleado_id")

  rolParticipacion String   @map("rol_participacion") // EVACUADO, BRIGADISTA, OBSERVADOR, COORDINADOR
  area             String?
  puntoEncuentro   String?  @map("punto_encuentro")
  tiempoEvacuacion Decimal? @map("tiempo_evacuacion") @db.Decimal(5, 2)

  observaciones String? @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  simulacro SSTSimulacro @relation(fields: [simulacroId], references: [id])
  empleado  THEmpleado   @relation("SSTParticipanteSimulacro", fields: [empleadoId], references: [id])

  @@unique([simulacroId, empleadoId])
  @@map("sst_participantes_simulacro")
}

// ============ SISTEMA DE ALERTAS Y NOTIFICACIONES ============

// Configuracion general de alertas por modulo
model AlertaConfiguracion {
  id     String @id @default(uuid())
  modulo String // SST, RRHH, CALIDAD, etc.

  tipoAlerta  AlertaTipo @map("tipo_alerta")
  nombre      String
  descripcion String?    @db.Text
  activo      Boolean    @default(true)

  // Configuracion de anticipacion
  diasAnticipacion Int[]  @map("dias_anticipacion") // [30, 15, 7, 1] dias antes
  horaEnvio        String @default("08:00") @map("hora_envio") // HH:mm

  // Frecuencia de recordatorio
  frecuenciaRecordatorio AlertaFrecuencia @default(UNICA) @map("frecuencia_recordatorio")

  // Prioridad
  prioridad AlertaPrioridad @default(MEDIA)

  // Plantilla de email
  asuntoTemplate String @map("asunto_template")
  cuerpoTemplate String @map("cuerpo_template") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  destinatarios AlertaDestinatario[]
  historial     AlertaHistorial[]

  @@unique([modulo, tipoAlerta])
  @@map("alerta_configuraciones")
}

// Destinatarios de alertas
model AlertaDestinatario {
  id              String @id @default(uuid())
  configuracionId String @map("configuracion_id")

  tipoDestinatario TipoDestinatario @map("tipo_destinatario")

  // Si es EMAIL_FIJO
  email String?

  // Si es ROL o CARGO
  rolId   String? @map("rol_id")
  cargoId String? @map("cargo_id")

  // Si es EMPLEADO_ESPECIFICO
  empleadoId String? @map("empleado_id")

  // Si es RESPONSABLE_AREA
  departamentoId String? @map("departamento_id") @db.Uuid

  activo Boolean @default(true)

  createdAt DateTime @default(now()) @map("created_at")

  configuracion AlertaConfiguracion @relation(fields: [configuracionId], references: [id], onDelete: Cascade)
  empleado      THEmpleado?         @relation("AlertaDestinatarioEmpleado", fields: [empleadoId], references: [id])
  cargo         THCargo?            @relation("AlertaDestinatarioCargo", fields: [cargoId], references: [id])

  @@map("alerta_destinatarios")
}

// Historial de alertas enviadas
model AlertaHistorial {
  id              String @id @default(uuid())
  configuracionId String @map("configuracion_id")

  tipoAlerta     AlertaTipo @map("tipo_alerta")
  referenciaId   String     @map("referencia_id") // ID del documento, examen, etc.
  referenciaTipo String     @map("referencia_tipo") // DOCUMENTO_SST, EXAMEN_MEDICO, etc.

  asunto String
  cuerpo String @db.Text

  destinatariosEmail String[] @map("destinatarios_email")

  estado       AlertaEstadoEnvio @default(PENDIENTE)
  fechaEnvio   DateTime?         @map("fecha_envio")
  errorMensaje String?           @map("error_mensaje") @db.Text
  resendId     String?           @map("resend_id") // ID de Resend para tracking

  intentos      Int       @default(0)
  ultimoIntento DateTime? @map("ultimo_intento")

  createdAt DateTime @default(now()) @map("created_at")

  configuracion AlertaConfiguracion @relation(fields: [configuracionId], references: [id])

  @@index([estado, fechaEnvio])
  @@index([referenciaId, referenciaTipo])
  @@map("alerta_historial")
}

// Alertas pendientes programadas (cola de alertas)
model AlertaProgramada {
  id String @id @default(uuid())

  tipoAlerta     AlertaTipo @map("tipo_alerta")
  referenciaId   String     @map("referencia_id")
  referenciaTipo String     @map("referencia_tipo")

  fechaProgramada DateTime @map("fecha_programada")
  diasRestantes   Int      @map("dias_restantes")

  procesada      Boolean   @default(false)
  fechaProcesada DateTime? @map("fecha_procesada")

  createdAt DateTime @default(now()) @map("created_at")

  @@index([fechaProgramada, procesada])
  @@index([referenciaId, referenciaTipo])
  @@map("alerta_programadas")
}

enum AlertaTipo {
  // SST
  DOCUMENTO_VENCIMIENTO
  EXAMEN_MEDICO_VENCIMIENTO
  EXAMEN_MEDICO_PENDIENTE
  CAPACITACION_PROGRAMADA
  EPP_VENCIMIENTO
  LICENCIA_PROVEEDOR_VENCIMIENTO
  EVALUACION_ESTANDARES_PENDIENTE
  PLAN_ANUAL_ACTIVIDAD
  ACCIDENTE_REPORTADO
  INCIDENTE_REPORTADO

  // RRHH
  CONTRATO_VENCIMIENTO
  EVALUACION_PENDIENTE
  VACACIONES_PENDIENTES
  CUMPLEANOS_EMPLEADO

  // General
  PERSONALIZADA
}

enum AlertaFrecuencia {
  UNICA // Solo una vez por cada dia de anticipacion
  DIARIA // Todos los dias hasta la fecha
  SEMANAL // Una vez por semana
}

enum AlertaPrioridad {
  BAJA
  MEDIA
  ALTA
  URGENTE
}

enum TipoDestinatario {
  EMAIL_FIJO
  ROL
  CARGO
  EMPLEADO_ESPECIFICO
  RESPONSABLE_SST
  RESPONSABLE_RRHH
  JEFE_DIRECTO
}

enum AlertaEstadoEnvio {
  PENDIENTE
  ENVIADO
  FALLIDO
  REBOTADO
}
