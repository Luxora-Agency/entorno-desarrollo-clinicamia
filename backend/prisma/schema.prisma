generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Rol {
  SUPER_ADMIN
  ADMIN
  DOCTOR
  NURSE
  RECEPTIONIST
  PATIENT
  PHARMACIST
  LAB_TECHNICIAN
}

enum Genero {
  Masculino
  Femenino
  Otro
}

enum EstadoCita {
  Programada
  Confirmada
  EnConsulta
  Completada
  Cancelada
  NoAsistio
}

enum Estado {
  Activo
  Inactivo
}

model Usuario {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email             String          @unique @db.VarChar(255)
  password          String          @db.VarChar(255)
  nombre            String          @db.VarChar(255)
  apellido          String          @db.VarChar(255)
  rol               String          @db.VarChar(50)
  telefono          String?         @db.VarChar(20)
  cedula            String?         @db.VarChar(50)
  activo            Boolean         @default(true)
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @default(now()) @map("updated_at")
  
  // Relaciones
  doctor            Doctor?
  citasComoDoctor   Cita[]          @relation("CitasDoctor")
  departamentosResponsable Departamento[] @relation("DepartamentoResponsable")

  @@map("usuarios")
}

model Paciente {
  id                             String    @id @default(uuid())
  
  // Datos Personales
  nombre                         String
  apellido                       String
  tipoDocumento                  String?   @map("tipo_documento")
  cedula                         String    @unique
  fechaNacimiento                DateTime? @map("fecha_nacimiento") @db.Date
  genero                         String?
  
  // Ubicación y Residencia
  paisNacimiento                 String?   @map("pais_nacimiento")
  departamento                   String?
  municipio                      String?
  barrio                         String?
  direccion                      String?
  
  // Contacto
  telefono                       String?
  email                          String?
  
  // Contactos de Emergencia (JSON array)
  contactosEmergencia            Json?     @map("contactos_emergencia")
  
  // Aseguramiento en Salud
  eps                            String?
  regimen                        String?
  tipoAfiliacion                 String?   @map("tipo_afiliacion")
  nivelSisben                    String?   @map("nivel_sisben")
  numeroAutorizacion             String?   @map("numero_autorizacion")
  fechaAfiliacion                DateTime? @map("fecha_afiliacion") @db.Date
  
  // Información Médica
  tipoSangre                     String?   @map("tipo_sangre")
  peso                           Float?
  altura                         Float?
  alergias                       String?
  enfermedadesCronicas           String?   @map("enfermedades_cronicas")
  medicamentosActuales           String?   @map("medicamentos_actuales")
  antecedentesQuirurgicos        String?   @map("antecedentes_quirurgicos")
  
  // Mantener compatibilidad (deprecado)
  contactoEmergenciaNombre       String?   @map("contacto_emergencia_nombre")
  contactoEmergenciaTelefono     String?   @map("contacto_emergencia_telefono")
  
  // Estado
  estado                         String    @default("Activo")
  ultimaConsulta                 DateTime? @map("ultima_consulta") @db.Date
  activo                         Boolean   @default(true)
  createdAt                      DateTime  @default(now()) @map("created_at")
  updatedAt                      DateTime  @updatedAt @map("updated_at")
  
  // Relaciones
  citas                          Cita[]
  documentos                     DocumentoPaciente[]
  admisiones                     Admision[]

  @@map("pacientes")
}

model Cita {
  id              String       @id @default(uuid())
  pacienteId      String       @map("paciente_id")
  doctorId        String       @map("doctor_id") @db.Uuid
  especialidadId  String?      @map("especialidad_id") @db.Uuid
  fecha           DateTime     @db.Date
  hora            DateTime     @db.Time
  motivo          String
  estado          EstadoCita   @default(Programada)
  notas           String?
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  
  // Relaciones
  paciente        Paciente     @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  doctor          Usuario      @relation("CitasDoctor", fields: [doctorId], references: [id], onDelete: Cascade)
  especialidad    Especialidad? @relation(fields: [especialidadId], references: [id])

  @@map("citas")
}

model Departamento {
  id                  String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nombre              String          @unique @db.VarChar(255)
  descripcion         String?
  responsableId       String?         @map("responsable_id") @db.Uuid
  estado              String          @default("Activo") @db.VarChar(20)
  createdAt           DateTime        @default(now()) @map("created_at")
  updatedAt           DateTime        @default(now()) @map("updated_at")
  
  // Relaciones
  responsable         Usuario?        @relation("DepartamentoResponsable", fields: [responsableId], references: [id])
  especialidades      Especialidad[]

  @@map("departamentos")
}

model Especialidad {
  id                    String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  titulo                String        @db.VarChar(255)
  codigo                String?       @db.VarChar(50)
  departamentoId        String        @map("departamento_id") @db.Uuid
  costoCOP              Decimal       @map("costo_cop") @db.Decimal(10, 2)
  duracionMinutos       Int           @map("duracion_minutos")
  duracionExternaMin    Int?          @map("duracion_externa_min")
  duracionInternaMin    Int?          @map("duracion_interna_min")
  descripcion           String?
  estado                String        @default("Activo") @db.VarChar(20)
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @default(now()) @map("updated_at")
  
  // Relaciones
  departamento          Departamento  @relation(fields: [departamentoId], references: [id], onDelete: Cascade)
  doctores              DoctorEspecialidad[]
  citas                 Cita[]

  @@map("especialidades")
}
model Doctor {
  id                 String   @id @default(uuid()) @db.Uuid
  usuarioId          String   @unique @map("usuario_id") @db.Uuid
  licenciaMedica     String   @map("licencia_medica")
  universidad        String?
  aniosExperiencia   Int?     @map("anios_experiencia")
  biografia          String?  @db.Text
  horarios           Json?
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  usuario            Usuario  @relation(fields: [usuarioId], references: [id])
  especialidades     DoctorEspecialidad[]

  @@map("doctores")
}

model DoctorEspecialidad {
  id              String   @id @default(uuid()) @db.Uuid
  doctorId        String   @map("doctor_id") @db.Uuid
  especialidadId  String   @map("especialidad_id") @db.Uuid
  createdAt       DateTime @default(now()) @map("created_at")

  doctor          Doctor       @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  especialidad    Especialidad @relation(fields: [especialidadId], references: [id])

  @@unique([doctorId, especialidadId])
  @@map("doctores_especialidades")
}

model CategoriaExamen {
  id              String              @id @default(uuid()) @db.Uuid
  nombre          String              @db.VarChar(255)
  descripcion     String              @db.Text
  colorHex        String              @map("color_hex") @db.VarChar(7)
  estado          String              @default("Activo") @db.VarChar(50)
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")

  examenes        ExamenProcedimiento[]

  @@map("categorias_examenes")
}

model ExamenProcedimiento {
  id                  String            @id @default(uuid()) @db.Uuid
  tipo                String            @db.VarChar(50) // 'Examen' o 'Procedimiento'
  nombre              String            @db.VarChar(255)
  descripcion         String?           @db.Text
  categoriaId         String?           @map("categoria_id") @db.Uuid
  duracionMinutos     Int               @map("duracion_minutos")
  costoBase           Decimal           @map("costo_base") @db.Decimal(10, 2)
  preparacionEspecial String?           @map("preparacion_especial") @db.Text
  requiereAyuno       Boolean           @default(false) @map("requiere_ayuno")
  estado              String            @default("Activo") @db.VarChar(50)
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")

  categoria           CategoriaExamen?  @relation(fields: [categoriaId], references: [id], onDelete: SetNull)

  @@map("examenes_procedimientos")
}

// Modelos de Farmacia
model CategoriaProducto {
  id          String     @id @default(uuid())
  nombre      String
  descripcion String?
  color       String?
  activo      Boolean    @default(true)
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  
  productos   Producto[]

  @@map("categorias_productos")
}

model EtiquetaProducto {
  id          String     @id @default(uuid())
  nombre      String
  color       String?
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  
  productos   ProductoEtiqueta[]

  @@map("etiquetas_productos")
}

model Producto {
  id                          String    @id @default(uuid())
  
  // Información Básica
  nombre                      String
  categoriaId                 String    @map("categoria_id")
  sku                         String    @unique
  laboratorio                 String?
  descripcion                 String?
  
  // Información Farmacológica
  principioActivo             String?   @map("principio_activo")
  concentracion               String?
  viaAdministracion           String?   @map("via_administracion")
  presentacion                String?
  registroSanitario           String?   @map("registro_sanitario")
  temperaturaAlmacenamiento   String?   @map("temperatura_almacenamiento")
  requiereReceta              Boolean   @default(false) @map("requiere_receta")
  
  // Inventario
  cantidadTotal               Int       @map("cantidad_total")
  cantidadConsumida           Int       @default(0) @map("cantidad_consumida")
  cantidadMinAlerta           Int       @map("cantidad_min_alerta")
  lote                        String?
  fechaVencimiento            DateTime? @map("fecha_vencimiento")
  
  // Precios
  precioVenta                 Float     @map("precio_venta")
  precioCompra                Float?    @map("precio_compra")
  
  // Estado e Imagen
  activo                      Boolean   @default(true)
  imagenUrl                   String?   @map("imagen_url")
  
  createdAt                   DateTime  @default(now()) @map("created_at")
  updatedAt                   DateTime  @updatedAt @map("updated_at")
  
  // Relaciones
  categoria                   CategoriaProducto @relation(fields: [categoriaId], references: [id])
  etiquetas                   ProductoEtiqueta[]

  @@map("productos")
}

model ProductoEtiqueta {
  id          String            @id @default(uuid())
  productoId  String            @map("producto_id")
  etiquetaId  String            @map("etiqueta_id")
  createdAt   DateTime          @default(now()) @map("created_at")
  
  producto    Producto          @relation(fields: [productoId], references: [id], onDelete: Cascade)
  etiqueta    EtiquetaProducto  @relation(fields: [etiquetaId], references: [id], onDelete: Cascade)

  @@unique([productoId, etiquetaId])
  @@map("productos_etiquetas")
}

model DocumentoPaciente {
  id              String    @id @default(uuid())
  pacienteId      String    @map("paciente_id")
  nombreArchivo   String    @map("nombre_archivo")
  nombreOriginal  String    @map("nombre_original")
  tipoArchivo     String    @map("tipo_archivo")
  tamano          Int       // en bytes
  rutaArchivo     String    @map("ruta_archivo")
  descripcion     String?
  categoria       String?   // Ej: "Historia Clínica", "Resultados", "Consentimiento", etc.
  uploadedBy      String?   @map("uploaded_by") @db.Uuid
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  paciente        Paciente  @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("documentos_paciente")

}

// ===================================
// MÓDULO DE HOSPITALIZACIÓN
// ===================================

model Unidad {
  id              String        @id @default(uuid())
  nombre          String        @unique
  descripcion     String?
  tipo            String        // UCI, Observación, Hospitalización General, Pediatría, etc.
  capacidad       Int           @default(0)
  activo          Boolean       @default(true)
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  // Relaciones
  habitaciones           Habitacion[]
  admisiones             Admision[]
  movimientosOrigen      Movimiento[]  @relation("MovimientoUnidadOrigen")
  movimientosDestino     Movimiento[]  @relation("MovimientoUnidadDestino")

  @@map("unidades")
}

model Habitacion {
  id              String        @id @default(uuid())
  numero          String
  unidadId        String        @map("unidad_id")
  piso            Int?
  capacidadCamas  Int           @default(1) @map("capacidad_camas")
  activo          Boolean       @default(true)
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  // Relaciones
  unidad          Unidad        @relation(fields: [unidadId], references: [id], onDelete: Cascade)
  camas           Cama[]

  @@unique([numero, unidadId])
  @@map("habitaciones")
}

model Cama {
  id              String        @id @default(uuid())
  numero          String
  habitacionId    String        @map("habitacion_id")
  estado          EstadoCama    @default(Disponible)
  observaciones   String?
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  // Relaciones
  habitacion           Habitacion    @relation(fields: [habitacionId], references: [id], onDelete: Cascade)
  admisiones           Admision[]
  movimientosOrigen    Movimiento[]  @relation("MovimientoCamaOrigen")
  movimientosDestino   Movimiento[]  @relation("MovimientoCamaDestino")

  @@unique([numero, habitacionId])
  @@map("camas")
}

model Admision {
  id                    String            @id @default(uuid())
  pacienteId            String            @map("paciente_id")
  unidadId              String            @map("unidad_id")
  camaId                String?           @map("cama_id")
  fechaIngreso          DateTime          @map("fecha_ingreso") @default(now())
  fechaEgreso           DateTime?         @map("fecha_egreso")
  motivoIngreso         String            @map("motivo_ingreso")
  diagnosticoIngreso    String            @map("diagnostico_ingreso")
  diagnosticoEgreso     String?           @map("diagnostico_egreso")
  estado                EstadoAdmision    @default(Activa)
  observaciones         String?
  responsableIngreso    String?           @map("responsable_ingreso") @db.Uuid
  responsableEgreso     String?           @map("responsable_egreso") @db.Uuid
  createdAt             DateTime          @default(now()) @map("created_at")
  updatedAt             DateTime          @updatedAt @map("updated_at")

  // Relaciones
  paciente              Paciente          @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  unidad                Unidad            @relation(fields: [unidadId], references: [id])
  cama                  Cama?             @relation(fields: [camaId], references: [id])
  movimientos           Movimiento[]

  @@map("admisiones")
}

model Movimiento {
  id                    String            @id @default(uuid())
  admisionId            String            @map("admision_id")
  tipo                  TipoMovimiento
  unidadOrigenId        String?           @map("unidad_origen_id")
  unidadDestinoId       String?           @map("unidad_destino_id")
  camaOrigenId          String?           @map("cama_origen_id")
  camaDestinoId         String?           @map("cama_destino_id")
  motivo                String
  observaciones         String?
  responsable           String?           @db.Uuid
  fechaMovimiento       DateTime          @default(now()) @map("fecha_movimiento")
  createdAt             DateTime          @default(now()) @map("created_at")

  // Relaciones
  admision              Admision          @relation(fields: [admisionId], references: [id], onDelete: Cascade)
  unidadOrigen          Unidad?           @relation("MovimientoUnidadOrigen", fields: [unidadOrigenId], references: [id])
  unidadDestino         Unidad?           @relation("MovimientoUnidadDestino", fields: [unidadDestinoId], references: [id])
  camaOrigen            Cama?             @relation("MovimientoCamaOrigen", fields: [camaOrigenId], references: [id])
  camaDestino           Cama?             @relation("MovimientoCamaDestino", fields: [camaDestinoId], references: [id])

  @@map("movimientos")
}

// ===================================
// ENUMS PARA HOSPITALIZACIÓN
// ===================================

enum EstadoCama {
  Disponible
  Ocupada
  Mantenimiento
  Reservada
}

enum EstadoAdmision {
  Activa
  Egresada
  Cancelada
}

enum TipoMovimiento {
  Ingreso
  Traslado
  CambioCama
  CambioUnidad
  Egreso
}

// ===================================
// MÓDULO DE FACTURACIÓN Y ÓRDENES
// ===================================

enum EstadoOrdenMedica {
  Pendiente
  EnProceso
  Completada
  Cancelada
}

enum PrioridadOrden {
  Normal
  Urgente
}

enum EstadoOrdenMedicamento {
  Pendiente
  Preparada
  Despachada
  Cancelada
}

enum EstadoFactura {
  Pendiente
  Parcial
  Pagada
  Cancelada
  Vencida
}

enum TipoItemFactura {
  Consulta
  OrdenMedica
  OrdenMedicamento
  Hospitalizacion
  Otro
}

enum MetodoPago {
  Efectivo
  Tarjeta
  Transferencia
  EPS
  Otro
}

// Paquetes de hospitalización por tipo de unidad
model PaqueteHospitalizacion {
  id                String    @id @default(uuid())
  nombre            String    // "UCI Adultos", "Hospitalización General", etc.
  descripcion       String?
  tipoUnidad        String    // Debe coincidir con Unidad.tipo
  precioDia         Decimal   @map("precio_dia") @db.Decimal(10, 2)
  incluye           String?   @db.Text // Descripción de lo que incluye
  activo            Boolean   @default(true)
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  @@map("paquetes_hospitalizacion")
}

// Órdenes médicas (exámenes y procedimientos)
model OrdenMedica {
  id                        String              @id @default(uuid())
  pacienteId                String              @map("paciente_id")
  citaId                    String?             @map("cita_id")
  admisionId                String?             @map("admision_id")
  examenProcedimientoId     String              @map("examen_procedimiento_id") @db.Uuid
  doctorId                  String              @map("doctor_id") @db.Uuid
  estado                    EstadoOrdenMedica   @default(Pendiente)
  prioridad                 PrioridadOrden      @default(Normal)
  observaciones             String?             @db.Text
  resultados                String?             @db.Text
  archivoResultado          String?             @map("archivo_resultado")
  precioAplicado            Decimal             @map("precio_aplicado") @db.Decimal(10, 2)
  fechaOrden                DateTime            @default(now()) @map("fecha_orden")
  fechaEjecucion            DateTime?           @map("fecha_ejecucion")
  ejecutadoPor              String?             @map("ejecutado_por") @db.Uuid
  createdAt                 DateTime            @default(now()) @map("created_at")
  updatedAt                 DateTime            @updatedAt @map("updated_at")

  paciente                  Paciente            @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  cita                      Cita?               @relation(fields: [citaId], references: [id])
  admision                  Admision?           @relation(fields: [admisionId], references: [id])
  examenProcedimiento       ExamenProcedimiento @relation(fields: [examenProcedimientoId], references: [id])
  doctor                    Usuario             @relation("OrdenMedicaDoctor", fields: [doctorId], references: [id])
  ejecutador                Usuario?            @relation("OrdenMedicaEjecutor", fields: [ejecutadoPor], references: [id])
  itemsFactura              FacturaItem[]

  @@map("ordenes_medicas")
}

// Órdenes de medicamentos
model OrdenMedicamento {
  id                String                    @id @default(uuid())
  pacienteId        String                    @map("paciente_id")
  citaId            String?                   @map("cita_id")
  admisionId        String?                   @map("admision_id")
  doctorId          String                    @map("doctor_id") @db.Uuid
  estado            EstadoOrdenMedicamento    @default(Pendiente)
  observaciones     String?                   @db.Text
  recetaDigital     String?                   @map("receta_digital") @db.Text // Indicaciones generales
  archivoReceta     String?                   @map("archivo_receta") // URL del PDF de receta
  total             Decimal                   @db.Decimal(10, 2)
  fechaOrden        DateTime                  @default(now()) @map("fecha_orden")
  fechaDespacho     DateTime?                 @map("fecha_despacho")
  despachadoPor     String?                   @map("despachado_por") @db.Uuid
  createdAt         DateTime                  @default(now()) @map("created_at")
  updatedAt         DateTime                  @updatedAt @map("updated_at")

  paciente          Paciente                  @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  cita              Cita?                     @relation(fields: [citaId], references: [id])
  admision          Admision?                 @relation(fields: [admisionId], references: [id])
  doctor            Usuario                   @relation("OrdenMedicamentoDoctor", fields: [doctorId], references: [id])
  despachador       Usuario?                  @relation("OrdenMedicamentoDespachador", fields: [despachadoPor], references: [id])
  items             OrdenMedicamentoItem[]
  itemsFactura      FacturaItem[]

  @@map("ordenes_medicamentos")
}

// Items de una orden de medicamento
model OrdenMedicamentoItem {
  id                    String              @id @default(uuid())
  ordenMedicamentoId    String              @map("orden_medicamento_id")
  productoId            String              @map("producto_id")
  cantidad              Int
  precioUnitario        Decimal             @map("precio_unitario") @db.Decimal(10, 2)
  descuento             Decimal             @default(0) @db.Decimal(10, 2)
  subtotal              Decimal             @db.Decimal(10, 2)
  indicaciones          String?             @db.Text // "1 tableta cada 8 horas por 7 días"
  createdAt             DateTime            @default(now()) @map("created_at")

  ordenMedicamento      OrdenMedicamento    @relation(fields: [ordenMedicamentoId], references: [id], onDelete: Cascade)
  producto              Producto            @relation(fields: [productoId], references: [id])

  @@map("ordenes_medicamentos_items")
}

// Facturas
model Factura {
  id                String          @id @default(uuid())
  numero            String          @unique // Ej: "F-2025-00001"
  pacienteId        String          @map("paciente_id")
  estado            EstadoFactura   @default(Pendiente)
  subtotal          Decimal         @db.Decimal(10, 2)
  descuentos        Decimal         @default(0) @db.Decimal(10, 2)
  impuestos         Decimal         @default(0) @db.Decimal(10, 2)
  total             Decimal         @db.Decimal(10, 2)
  saldoPendiente    Decimal         @map("saldo_pendiente") @db.Decimal(10, 2)
  observaciones     String?         @db.Text
  
  // Información EPS
  cubiertoPorEPS    Boolean         @default(false) @map("cubierto_por_eps")
  epsAutorizacion   String?         @map("eps_autorizacion")
  montoEPS          Decimal?        @map("monto_eps") @db.Decimal(10, 2)
  montoPaciente     Decimal?        @map("monto_paciente") @db.Decimal(10, 2)
  
  fechaEmision      DateTime        @default(now()) @map("fecha_emision")
  fechaVencimiento  DateTime?       @map("fecha_vencimiento")
  creadaPor         String?         @map("creada_por") @db.Uuid
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")

  paciente          Paciente        @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  creador           Usuario?        @relation(fields: [creadaPor], references: [id])
  items             FacturaItem[]
  pagos             Pago[]

  @@map("facturas")
}

// Items de factura
model FacturaItem {
  id                    String              @id @default(uuid())
  facturaId             String              @map("factura_id")
  tipo                  TipoItemFactura
  descripcion           String
  cantidad              Int                 @default(1)
  precioUnitario        Decimal             @map("precio_unitario") @db.Decimal(10, 2)
  descuento             Decimal             @default(0) @db.Decimal(10, 2)
  subtotal              Decimal             @db.Decimal(10, 2)
  
  // Referencias opcionales según tipo
  citaId                String?             @map("cita_id")
  ordenMedicaId         String?             @map("orden_medica_id")
  ordenMedicamentoId    String?             @map("orden_medicamento_id")
  admisionId            String?             @map("admision_id")
  
  createdAt             DateTime            @default(now()) @map("created_at")

  factura               Factura             @relation(fields: [facturaId], references: [id], onDelete: Cascade)
  cita                  Cita?               @relation(fields: [citaId], references: [id])
  ordenMedica           OrdenMedica?        @relation(fields: [ordenMedicaId], references: [id])
  ordenMedicamento      OrdenMedicamento?   @relation(fields: [ordenMedicamentoId], references: [id])
  admision              Admision?           @relation(fields: [admisionId], references: [id])

  @@map("facturas_items")
}

// Pagos
model Pago {
  id                String        @id @default(uuid())
  facturaId         String        @map("factura_id")
  monto             Decimal       @db.Decimal(10, 2)
  metodoPago        MetodoPago    @map("metodo_pago")
  referencia        String?       // Número de transacción, cheque, etc.
  observaciones     String?       @db.Text
  fechaPago         DateTime      @default(now()) @map("fecha_pago")
  registradoPor     String?       @map("registrado_por") @db.Uuid
  createdAt         DateTime      @default(now()) @map("created_at")

  factura           Factura       @relation(fields: [facturaId], references: [id], onDelete: Cascade)
  registrador       Usuario?      @relation(fields: [registradoPor], references: [id])

  @@map("pagos")
}