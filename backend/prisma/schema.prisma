generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Rol {
  SUPER_ADMIN
  ADMIN
  DOCTOR
  NURSE
  RECEPTIONIST
  PATIENT
  PHARMACIST
  LAB_TECHNICIAN
}

enum Genero {
  Masculino
  Femenino
  Otro
}

enum EstadoCita {
  Programada
  Confirmada
  EnConsulta
  Completada
  Cancelada
  NoAsistio
}

enum Estado {
  Activo
  Inactivo
}

model Usuario {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email             String          @unique @db.VarChar(255)
  password          String          @db.VarChar(255)
  nombre            String          @db.VarChar(255)
  apellido          String          @db.VarChar(255)
  rol               String          @db.VarChar(50)
  telefono          String?         @db.VarChar(20)
  cedula            String?         @db.VarChar(50)
  activo            Boolean         @default(true)
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @default(now()) @map("updated_at")
  
  // Relaciones
  citasComoDoctor   Cita[]          @relation("CitasDoctor")
  departamentosResponsable Departamento[] @relation("DepartamentoResponsable")

  @@map("usuarios")
}

model Paciente {
  id                             String    @id @default(uuid())
  nombre                         String
  apellido                       String
  cedula                         String    @unique
  fechaNacimiento                DateTime  @map("fecha_nacimiento") @db.Date
  genero                         Genero?
  telefono                       String?
  email                          String?
  direccion                      String?
  tipoSangre                     String?   @map("tipo_sangre")
  alergias                       String?
  contactoEmergenciaNombre       String?   @map("contacto_emergencia_nombre")
  contactoEmergenciaTelefono     String?   @map("contacto_emergencia_telefono")
  activo                         Boolean   @default(true)
  createdAt                      DateTime  @default(now()) @map("created_at")
  updatedAt                      DateTime  @updatedAt @map("updated_at")
  
  // Relaciones
  citas                          Cita[]

  @@map("pacientes")
}

model Cita {
  id              String       @id @default(uuid())
  pacienteId      String       @map("paciente_id")
  doctorId        String       @map("doctor_id")
  especialidadId  String?      @map("especialidad_id")
  fecha           DateTime     @db.Date
  hora            DateTime     @db.Time
  motivo          String
  estado          EstadoCita   @default(Programada)
  notas           String?
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  
  // Relaciones
  paciente        Paciente     @relation(fields: [pacienteId], references: [id], onDelete: Cascade)
  doctor          Usuario      @relation("CitasDoctor", fields: [doctorId], references: [id], onDelete: Cascade)
  especialidad    Especialidad? @relation(fields: [especialidadId], references: [id])

  @@map("citas")
}

model Departamento {
  id                  String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nombre              String          @unique @db.VarChar(255)
  descripcion         String?
  responsableId       String?         @map("responsable_id") @db.Uuid
  estado              String          @default("Activo") @db.VarChar(20)
  createdAt           DateTime        @default(now()) @map("created_at")
  updatedAt           DateTime        @default(now()) @map("updated_at")
  
  // Relaciones
  responsable         Usuario?        @relation("DepartamentoResponsable", fields: [responsableId], references: [id])
  especialidades      Especialidad[]

  @@map("departamentos")
}

model Especialidad {
  id                    String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  titulo                String        @db.VarChar(255)
  codigo                String?       @db.VarChar(50)
  departamentoId        String        @map("departamento_id") @db.Uuid
  costoCOP              Decimal       @map("costo_cop") @db.Decimal(10, 2)
  duracionMinutos       Int           @map("duracion_minutos")
  duracionExternaMin    Int?          @map("duracion_externa_min")
  duracionInternaMin    Int?          @map("duracion_interna_min")
  descripcion           String?
  estado                String        @default("Activo") @db.VarChar(20)
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @default(now()) @map("updated_at")
  
  // Relaciones
  departamento          Departamento  @relation(fields: [departamentoId], references: [id], onDelete: Cascade)
  citas                 Cita[]

  @@map("especialidades")
}
